---
title: "Â¶Ç‰ΩïÊâìÈÄ†ÂèØË¢´ÊëáÊ†ë‰ºòÂåñÁöÑÂ∫ì"
date: 2021-06-25
tags: [webpack]
categories: [üåè ÁøªËØëÊ†°ÂØπ]
---

![Â¶Ç‰ΩïÊâìÈÄ†ÂèØË¢´ÊëáÊ†ë‰ºòÂåñÁöÑÂ∫ì](https://blog.theodo.com/static/dfae80d02f29938244fa328765a243a9/a79d3/tree-shaking.png)

Âú® [Theodo](https://www.theodo.fr)ÔºåÊàë‰ª¨Ëá¥Âäõ‰∫é‰∏∫Êàë‰ª¨ÁöÑÂÆ¢Êà∑ÊâìÈÄ†ÂèØÈù†„ÄÅÂø´ÈÄüÁöÑÂ∫îÁî®„ÄÇÊàë‰ª¨Êúâ‰∏Ä‰∫õÊîπËøõÁé∞ÊúâÂ∫îÁî®ÁöÑÊÄßËÉΩÁöÑÈ°πÁõÆ„ÄÇÂú®ÂÖ∂‰∏≠‰∏Ä‰∏™È°πÁõÆÈáåÔºå**Êàë‰ª¨ÈÄöËøáÂØπÂÜÖÈÉ®Â∫ìËøõË°åÊëáÊ†ë‰ºòÂåñÔºàtree shakingÔºâÔºåÊàêÂäüÂ∞ÜÊâÄÊúâÈ°µÈù¢ÁöÑ gzip ÂéãÁº©ÂêéÁöÑ bundle ‰ΩìÁßØÂáèÂ∞ë‰∫ÜË∂≥Ë∂≥ 500KB„ÄÇ**

Âú®ÂÅöËøô‰ª∂‰∫ãÁöÑÊó∂ÂÄôÔºåÊàë‰ª¨ÊÑèËØÜÂà∞ÊëáÊ†ë‰ºòÂåñÂπ∂‰∏çÊòØ‰∏ÄÁßçÁÆÄÂçïÂú∞ÂºÄÂêØÊàñÂÖ≥Èó≠Â∞±‰ºöÂ•èÊïàÁöÑÊäÄÊúØ„ÄÇÊúâÂæàÂ§öÂõ†Á¥†‰ºöÂΩ±Âìç‰∏Ä‰∏™Â∫ìÁöÑÊëáÊ†ë‰ºòÂåñÊïàÊûú„ÄÇ

**Êú¨ÊñáÁöÑÁõÆÊ†áÊòØ‰∏∫ÊûÑÂª∫ÈÄÇÈÖçÊëáÊ†ë‰ºòÂåñÁöÑÂ∫ìÊèê‰æõËØ¶ÁªÜÁöÑÊåáÂØº„ÄÇÂÖ∂‰∏≠ÁöÑÊ≠•È™§ÁöÑÊÄªÁªìÂ¶Ç‰∏ãÔºö**

* Âú®‰∏Ä‰∏™ÂèóÊéßÁöÑÁéØÂ¢É‰∏ãÔºåÈíàÂØπ‰∏Ä‰∏™Â∑≤Áü•ÁöÑÂ∫îÁî®Êù•Ê£ÄÊü•Êàë‰ª¨ÁöÑÂ∫ìÊòØÂê¶ÂèØ‰ª•Ë¢´ÊëáÊ†ë‰ºòÂåñ„ÄÇ
* ‰ΩøÁî® ES6 Ê®°ÂùóËÆ©ÊâìÂåÖÂ∑•ÂÖ∑ÔºàbundlerÔºâÂæó‰ª•Ê£ÄÊµãÂà∞Êú™ÂºïÁî®ÁöÑ `export` ËØ≠Âè•„ÄÇ
* ‰ΩøÁî®ÂâØ‰ΩúÁî®Ôºàside effectsÔºâ‰ºòÂåñÔºåËÆ©‰Ω†ÁöÑÂ∫ì‰∏çÂåÖÂê´‰ªª‰ΩïÂâØ‰ΩúÁî®„ÄÇ
* Â∞ÜÂ∫ìÁöÑ‰ª£Á†ÅÈÄªËæëÂàÜÂâ≤Âà∞Ëã•Âπ≤‰∏™Â∞èÁöÑÊ®°Âùó‰∏≠ÔºåÂêåÊó∂‰øùÁïôÂ∫ìÁöÑÊ®°ÂùóÊ†ëÔºàmodule treeÔºâ„ÄÇ
* Âú®ËΩ¨ËØëÔºàtranspileÔºâÂ∫ìÊó∂Ôºå‰∏çË¶Å‰∏¢Â§±Ê®°ÂùóÊ†ëÊàñËÄÖ ES Ê®°ÂùóÁâπÂæÅÔºàES modules characteristicsÔºâ„ÄÇ
* ‰ΩøÁî®ÊúÄÊñ∞ÁâàÁöÑËÉΩÂ§üÊîØÊåÅÊëáÊ†ë‰ºòÂåñÁöÑÊâìÂåÖÂ∑•ÂÖ∑„ÄÇ

## ‰ªÄ‰πàÊòØÊëáÊ†ë‰ºòÂåñÔºü‰∏∫‰ªÄ‰πàÂÆÉÂæàÈáçË¶ÅÔºü

ÂºïÁî® [MDN ÊñáÊ°£](https://developer.mozilla.org/en-US/docs/Glossary/Tree_shaking)Ôºö

> Tree shaking ÊòØ‰∏Ä‰∏™ÈÄöÂ∏∏Áî®‰∫éÊèèËø∞ÁßªÈô§ JavaScript ‰∏ä‰∏ãÊñá‰∏≠ÁöÑÊú™ÂºïÁî®‰ª£Á†ÅÔºàdead codeÔºâË°å‰∏∫ÁöÑÊúØËØ≠„ÄÇ
> 
> ÂÆÉ‰æùËµñ‰∫é ES2015 ‰∏≠ÁöÑ `import` Âíå `export` ËØ≠Âè•ÔºåÁî®Êù•Ê£ÄÊµã‰ª£Á†ÅÊ®°ÂùóÊòØÂê¶Ë¢´ÂØºÂá∫„ÄÅÂØºÂÖ•Ôºå‰∏îË¢´ JavaScript Êñá‰ª∂‰ΩøÁî®„ÄÇ

ÊëáÊ†ë‰ºòÂåñÊòØ‰∏ÄÁßçÂÆûÁé∞[ÁßªÈô§Êú™ÂºïÁî®‰ª£Á†ÅÔºàdead code eliminationÔºâ](https://en.wikipedia.org/wiki/Dead_code_elimination)ÁöÑÊñπÂºèÔºåÂÆûÁé∞ÁöÑÊñπÂºèÊòØÊ£ÄÊµãÂì™‰∫õÂØºÂá∫È°πÔºàexportÔºâÂú®Â∫îÁî®‰ª£Á†ÅÈáåÊú™Ë¢´ÂºïÁî®„ÄÇÂÆÉ‰ºöË¢´Á±ª‰ºº [Webpack](https://webpack.js.org/) Âíå [Rollup](https://rollupjs.org/guide/en/) ËøôÊ†∑ÁöÑÊâìÂåÖÂ∑•ÂÖ∑ÊâßË°åÔºåÊúÄÊó©Áî± Rollup ÂÆûÁé∞„ÄÇ

**ÈÇ£‰πàÔºå‰∏∫‰ªÄ‰πàÂÆÉÂè´ÊëáÊ†ë‰ºòÂåñÔºü** Êàë‰ª¨ÂèØ‰ª•ÊääÂ∫îÁî®ÁöÑÂØºÂá∫È°πÔºàexportsÔºâÂíåÂØºÂÖ•È°πÔºàimportsÔºâÊÉ≥Ë±°Êàê‰∏ÄÊ£µÊ†ëÁöÑÊ†∑Â≠ê„ÄÇÊ†ë‰∏äÂÅ•Â∫∑ÁöÑÂè∂Â≠êÂíåÊ†ëÊûùË°®Á§∫ÂºïÁî®‰∫ÜÁöÑÂØºÂÖ•È°π„ÄÇËÄåÊ≠ª‰∫°ÁöÑÂè∂Â≠êË°®Á§∫Êú™ÂºïÁî®ÁöÑ‰ª£Á†ÅÔºåÂÆÉ‰ª¨ÂíåÊ†ëÁöÑÂÖ∂‰ªñÈÉ®ÂàÜÊòØÂàÜÂºÄÁöÑ„ÄÇËøôÊó∂ÂÄôÊëáÂä®ËøôÊ£µÊ†ëÔºåÈÇ£‰πàÊâÄÊúâÊ≠ª‰∫°ÁöÑÂè∂Â≠ê‰ºöË¢´Êëá‰∏ãÊù•ÔºåÂç≥Êú™ÂºïÁî®ÁöÑ‰ª£Á†Å‰ºöË¢´ÁßªÈô§„ÄÇ

**‰∏∫‰ªÄ‰πàÊëáÊ†ë‰ºòÂåñÂæàÈáçË¶ÅÔºü** ÂÆÉËÉΩÂ§üÂØπ‰Ω†ÁöÑÊµèËßàÂô®Â∫îÁî®‰∫ßÁîüÂ∑®Â§ßÁöÑÂΩ±Âìç„ÄÇÂ¶ÇÊûúÂ∫îÁî®ÊâìÂåÖ‰∫ÜÊõ¥Â§öÁöÑ‰ª£Á†ÅÔºåÈÇ£‰πàÊµèËßàÂô®Â∞ÜËä±Ë¥πÊõ¥Â§öÊó∂Èó¥Âéª‰∏ãËΩΩ„ÄÅËß£Âéã„ÄÅËΩ¨Êç¢ÂíåÊâßË°åÂÆÉ‰ª¨„ÄÇ**Âõ†Ê≠§ÔºåÂØπ‰∫éÊâìÈÄ†ÈÄüÂ∫¶ÊúÄÂø´ÁöÑÂ∫îÁî®ËÄåË®ÄÔºåÁßªÈô§Êú™ÂºïÁî®ÁöÑ‰ª£Á†ÅËá≥ÂÖ≥ÈáçË¶Å„ÄÇ**

ÁΩë‰∏äÊúâÂæàÂ§öËß£ÈáäÊëáÊ†ë‰ºòÂåñÂíåÊú™ÂºïÁî®‰ª£Á†ÅÁßªÈô§ÁöÑÊñáÁ´†ÂíåËµÑÊ∫ê„ÄÇËøôÈáåÊàë‰ª¨‰ºöÈõÜ‰∏≠ËÆ®ËÆ∫ÈÇ£‰∫õÂ∫îÁî®Èáå‰∏≠ÂºïÁî®ÁöÑÂ∫ì„ÄÇÂΩìÂºïÁî®‰∏Ä‰∏™Â∫ìÁöÑÂ∫îÁî®ËÉΩÂ§ü**ÊàêÂäüÂú∞ÁßªÈô§Ëøô‰∏™Â∫ì‰∏≠Êú™Ë¢´ÂºïÁî®ÁöÑÈÉ®ÂàÜ**Êó∂ÔºåËøô‰∏™Â∫ìÊâçËÉΩË¢´ËÆ§‰∏∫ÂÅöÂà∞‰∫ÜÊëáÊ†ë‰ºòÂåñÔºàtree shakeableÔºâ„ÄÇ

 [![‰∏Ä‰∏™ÂèØÊëáÊ†ë‰ºòÂåñÁöÑÂ∫ìÁöÑ‰æãÂ≠ê](https://github.com/darkyzhou/blog/raw/master/static/images/uploads/tree-shaking-1.png) 

Âú®Â∞ùËØïËÆ©‰∏Ä‰∏™Â∫ìÂèòÂæóÂèØË¢´ÊëáÊ†ë‰ºòÂåñ‰πãÂâçÔºåÊàë‰ª¨ÂÖàÊù•ÁúãÁúãÂ¶Ç‰ΩïËØÜÂà´‰∏Ä‰∏™ÂèØÊëáÊ†ë‰ºòÂåñÁöÑÂ∫ì„ÄÇ

## Âú®ÂèóÊéßÁéØÂ¢É‰∏ãËØÜÂà´‰∏Ä‰∏™‰∏çÂèØÊëáÊ†ë‰ºòÂåñÁöÑÂ∫ì

Ëøô‰πçÁúã‰∏äÂéªÂ•ΩÂÉèÂæàÁÆÄÂçïÔºå‰ΩÜÊòØÊàëÊ≥®ÊÑèÂà∞ÂæàÂ§öÂºÄÂèëËÄÖÈÉΩ‰ºöËÆ§‰∏∫‰ªñ‰ª¨ÁöÑÂ∫ìÊòØÂèØÊëáÊ†ë‰ºòÂåñÁöÑÔºå‰ªÖ‰ªÖÊòØÂõ†‰∏∫ÂÆÉ‰ª¨‰ΩøÁî®‰∫Ü ES6 Ê®°ÂùóÔºàÂêéÊñá‰ºöÁªÜËÆ≤ÔºâÔºåÊàñËÄÖÊòØÂõ†‰∏∫ÂÆÉ‰ª¨ÊúâÂØπÊëáÊ†ë‰ºòÂåñÂæàÂèãÂ•ΩÁöÑÈÖçÁΩÆ„ÄÇ‰∏çÂπ∏ÁöÑÊòØÔºåËøôÂπ∂‰∏çÊÑèÂë≥ÁùÄ‰Ω†ÁöÑÂ∫ìÂÆûÈôÖ‰∏äÊòØÂèØÊëáÊ†ë‰ºòÂåñÁöÑÔºÅ

‰∫éÊòØÔºåÊàë‰ª¨Ë¢´Â∏¶Âà∞‰∫ÜËøô‰∏™ÈóÆÈ¢ò‰∏äÔºö**Â¶Ç‰ΩïÈ´òÊïàÂú∞Ê£ÄÊü•‰∏Ä‰∏™Â∫ìÊòØÂê¶ÂèØÊëáÊ†ë‰ºòÂåñÔºü**

Ë¶ÅÂÅöÂà∞Ëøô‰ª∂‰∫ãÔºåÊàë‰ª¨ÈúÄË¶ÅÁêÜËß£‰∏§‰ª∂‰∫ãÊÉÖÔºö

* **ÊúÄÁªàÁßªÈô§Êàë‰ª¨Â∫ì‰∏≠Êú™ÂºïÁî®‰ª£Á†ÅÁöÑÔºåÊòØÂ∫îÁî®Á®ãÂ∫èÁöÑÊâìÂåÖÂ∑•ÂÖ∑ÔºåËÄå‰∏çÊòØÂ∫ìËá™Â∑±ÁöÑÊâìÂåÖÂ∑•ÂÖ∑**ÔºàÂ¶ÇÊûúÂ∫ìÊúâÁöÑËØùÔºâ„ÄÇÊØïÁ´üÔºåÂè™ÊúâÂ∫îÁî®Á®ãÂ∫èËá™Â∑±Áü•ÈÅì‰ΩøÁî®‰∫ÜÂ∫ìÁöÑÂì™ÈÉ®ÂàÜ„ÄÇ
* **Â∫ìÁöÑËÅåË¥£ÊòØÁ°Æ‰øùÂÆÉËá™Â∑±ËÉΩÂ§üË¢´ÊúÄÁªàÁöÑÊâìÂåÖÂ∑•ÂÖ∑ËøõË°åÊëáÊ†ë‰ºòÂåñ**„ÄÇ

Ë¶ÅÊ£ÄÊü•Êàë‰ª¨ÁöÑÂ∫ìÊòØÂê¶ÂèØÊëáÊ†ë‰ºòÂåñÔºåÊàë‰ª¨ÂèØ‰ª•Â∞ÜÂÆÉÊîæÂú®‰∏Ä‰∏™ÂèóÊéßÁöÑÁéØÂ¢É‰∏ãÔºå‰ΩøÁî®‰∏Ä‰∏™ÂºïÁî®‰∫ÜÂÆÉÁöÑÂ∫îÁî®ËøõË°åÊµãËØïÔºö

1. ÂàõÂª∫‰∏Ä‰∏™ÁÆÄÂçïÁöÑÂ∫îÁî®ÔºàÊàë‰ª¨Áß∞ÂÆÉ‰∏∫‚ÄúÂºïÁî®Â∫îÁî®‚ÄùÔºâÔºåÁªôÂÆÉÊê≠ÈÖç‰∏Ä‰∏™‰Ω†‰ºöÈÖçÁΩÆÁöÑÊâìÂåÖÂ∑•ÂÖ∑ÔºåËøô‰∏™ÊâìÂåÖÂ∑•ÂÖ∑ÈúÄË¶ÅÊîØÊåÅÊëáÊ†ë‰ºòÂåñÔºàÊØîÂ¶Ç [Webpack](https://webpack.js.org/) ÊàñËÄÖ [Rollup](https://rollupjs.org/guide/en/)Ôºâ„ÄÇ
2. Â∞ÜË¢´Ê£ÄÊü•ÁöÑÂ∫ìËÆæÁΩÆ‰∏∫Â∫îÁî®ÁöÑ‰æùËµñ„ÄÇ
3. ‰ªÖ‰ªÖÂØºÂÖ•Â∫ìÁöÑ‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÊ£ÄÊü•Â∫îÁî®ÁöÑÊâìÂåÖÂ∑•ÂÖ∑ÁöÑËæìÂá∫„ÄÇ
4. Ê£ÄÊü•ËæìÂá∫‰∏≠ÊòØÂê¶**Âè™ÂåÖÂê´**Ë¢´ÂØºÂÖ•ÁöÑÂÖÉÁ¥†ÂèäÂÖ∂‰æùËµñ„ÄÇ

Ëøô‰∏™Á≠ñÁï•ËÉΩÂ§üÂ∞ÜÊµãËØï‰∏éÊàë‰ª¨Áé∞ÊúâÁöÑÂ∫îÁî®ÈöîÁ¶ª„ÄÇÂÆÉÂèØ‰ª•ËÆ©Êàë‰ª¨ÈöèÊÑèÂú∞ÊëÜÂºÑÂ∫ìËÄå‰∏çÁ†¥Âùè‰ªª‰Ωï‰∏úË•ø„ÄÇÂÆÉËøòËÉΩËÆ©Êàë‰ª¨Á°Æ‰øùÂá∫Áé∞ÁöÑÈóÆÈ¢ò‰∏çÊòØÊù•Ëá™‰∫éÂ∫îÁî®ÊâìÂåÖÂ∑•ÂÖ∑ÁöÑÈÖçÁΩÆ‰∏ä„ÄÇ

Êàë‰ª¨Êé•‰∏ãÊù•‰ºöÂ∞ÜËøôÁßçÁ≠ñÁï•Â∫îÁî®Âà∞‰∏Ä‰∏™Âè´ÂÅö `user-library` ÁöÑÂ∫ì‰∏äÔºå‰ΩøÁî®‰∏Ä‰∏™Áî± [Webpack](https://webpack.js.org/) ËøõË°åÊâìÂåÖÁöÑÂ∫îÁî® `user-app` ËøõË°åÊµãËØï„ÄÇ‰Ω†‰πüÂèØ‰ª•‰ΩøÁî®ÂÖ∂‰ªñ‰Ω†Êõ¥ÂñúÊ¨¢ÁöÑÊâìÂåÖÂ∑•ÂÖ∑„ÄÇ

`user-library` ÁöÑ‰ª£Á†ÅÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö

```js
export const getUserName = () => "John Doe";

export const getUserPhoneNumber = () => "***********";
```

ÂÆÉ‰ªÖ‰ªÖÊòØÂú® `index.js` Êñá‰ª∂ÈáåÂØºÂá∫‰∫Ü‰∏§‰∏™ÂáΩÊï∞ÔºåËøô‰∏§‰∏™ÂáΩÊï∞ÂèØ‰ª•ÈÄöËøá npm ÂåÖÊù•‰ΩøÁî®„ÄÇ

ËÆ©Êàë‰ª¨ÁºñÂÜôÁÆÄÂçïÁöÑ `user-app`Ôºö

`package.json`

```json
{
  "name": "user-app",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "build": "webpack"
  },
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "webpack": "^5.18.0",
    "webpack-cli": "^4.3.1"
  },
  "dependencies": {
    "user-library": "1.0.0"
  }
}
```

Ê≥®ÊÑèÔºåÊàë‰ª¨‰ΩøÁî® `user-library` ‰Ωú‰∏∫‰æùËµñ„ÄÇ

`webpack.config.js`

```js
const path = require("path");

module.exports = {
  entry: "./src/index.js",
  output: {
    filename: "main.js",
    path: path.resolve(__dirname, "dist"),
  },
  mode: "development",
  optimization: {
    usedExports: true,
    innerGraph: true,
    sideEffects: true,
  },
  devtool: false,
};
```

Ë¶ÅÁêÜËß£‰∏äÈù¢ÁöÑ Webpack ÈÖçÁΩÆÔºåÊàë‰ª¨ÈúÄË¶ÅÂÖàÁêÜËß£ Webpack ÊòØÂ¶Ç‰ΩïËøõË°åÊëáÊ†ë‰ºòÂåñÁöÑ„ÄÇÊëáÊ†ë‰ºòÂåñËøõË°åÁöÑÊ≠•È™§Â¶Ç‰∏ãÊâÄÁ§∫Ôºö

* ËØÜÂà´Âá∫Â∫îÁî®ÁöÑÂÖ•Âè£Êñá‰ª∂Ôºàentry fileÔºâÔºàÁî± Webpack ÈÖçÁΩÆÊñá‰ª∂ÊåáÂÆöÔºâ
* ÈÄöËøáÈÅçÂéÜÂÖ•Âè£Êñá‰ª∂ÂØºÂÖ•ÁöÑÊâÄÊúâÁöÑ‰æùËµñÂíåÂÆÉ‰ª¨ÂêÑËá™ÁöÑ‰æùËµñÔºåÊù•ÂàõÂª∫Â∫îÁî®ÁöÑÊ®°ÂùóÊ†ëÔºàmodule treeÔºâ
* ÂØπÊ†ë‰∏≠ÁöÑÊØè‰∏Ä‰∏™Ê®°ÂùóÔºåËØÜÂà´Âá∫ÂÆÉÁöÑÂì™‰∫õ `export` ËØ≠Âè•Ê≤°ÊúâË¢´ÂÖ∂‰ªñÊ®°ÂùóÊâÄÂØºÂÖ•„ÄÇ
* ‰ΩøÁî®ÂÉè UglifyJS ÊàñËÄÖ Terser ËøôÊ†∑ÁöÑ‰ª£Á†ÅÊúÄÂ∞èÂåñÔºàminificationÔºâÂ∑•ÂÖ∑Êù•ÁßªÈô§Êú™ÂºïÁî®ÁöÑÂØºÂá∫È°πÔºå‰ª•ÂèäÂÆÉ‰ª¨ÁöÑÁõ∏ÂÖ≥‰ª£Á†Å„ÄÇ

Ëøô‰∫õÊ≠•È™§‰ªÖÂú® **Áîü‰∫ßÊ®°ÂºèÔºàproduction modeÔºâ** ‰∏ãÊâç‰ºöË¢´ÊâßË°å„ÄÇ

**Áîü‰∫ßÊ®°ÂºèÁöÑÈóÆÈ¢òÂú®‰∫é‰ª£Á†ÅÊúÄÂ∞èÂåñÔºàminificationÔºâ**„ÄÇÂÆÉ‰ºöËÆ©Êàë‰ª¨Èöæ‰ª•ÂàÜËæ®ÊëáÊ†ë‰ºòÂåñÊòØÂê¶ÁîüÊïàÔºåÂõ†‰∏∫Âú®ÊâìÂåÖÂêéÁöÑ‰ª£Á†ÅÈáåÊàë‰ª¨Áúã‰∏çÂà∞ÂéüÊù•ÂëΩÂêçÁöÑÂáΩÊï∞„ÄÇ

‰∏∫‰∫ÜÁªïËøáËøô‰∏™ÈóÆÈ¢òÔºåÊàë‰ª¨‰ºöËÆ© Webpack ËøêË°åÂú®ÂºÄÂèëÊ®°ÂºèÔºàdevelopment modeÔºâ‰∏ãÔºå‰ΩÜ‰ªçÁÑ∂ËÆ©ÂÆÉËØÜÂà´Âì™‰∫õ‰ª£Á†ÅÊú™Ë¢´ÂºïÁî®Âπ∂‰∏î‰ºöÂú®Áîü‰∫ßÊ®°Âºè‰∏ãË¢´ÁßªÈô§„ÄÇÊàë‰ª¨Â∞ÜÈÖçÁΩÆÈáåÁöÑ `optimization` ËÆæÁΩÆÊàêÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö

```js
  optimization: {
    usedExports: true,
    sideEffects: true,
    innerGraph: true,
  }
```

ÂÖ∂‰∏≠ÁöÑ `usedExports` Â±ûÊÄßËÉΩÂ§üËÆ© Webpack ËØÜÂà´Âì™‰∫õÊ®°ÂùóÁöÑÂØºÂá∫È°πÊ≤°ÊúâË¢´ÂÖ∂‰ªñÊ®°ÂùóÂºïÁî®„ÄÇÂÖ∂‰ªñ‰∏§‰∏™Â±ûÊÄß‰ºöÂú®ÂêéÊñáËÆ®ËÆ∫„ÄÇÁé∞Âú®Êàë‰ª¨ÊöÇ‰∏îËÆ§‰∏∫ÂÆÉ‰ª¨ËÉΩÂ§üÊèêÈ´òÊàë‰ª¨ÁöÑÂ∫îÁî®Ë¢´ÊëáÊ†ë‰ºòÂåñÁöÑÊïàÊûú„ÄÇ

Êàë‰ª¨ `user-app` ÁöÑÂÖ•Âè£Êñá‰ª∂Ôºö`src/index.js`

```js
import { getUserName } from "user-library";

console.log(getUserName());
```

ÊâìÂåÖ‰πãÂêéÔºåÊàë‰ª¨Êù•ÂàÜÊûê‰∏Ä‰∏ãËæìÂá∫Ôºö

```js
/***/ "./node_modules/user-library/dist/index.js":
/*!*************************************************!*\
  !*** ./node_modules/user-library/dist/index.js ***!
  \*************************************************/
/***/ ((__unused_webpack_module, exports) => {

var __webpack_unused_export__;

__webpack_unused_export__ = ({ value: true });

const getUserName = () => 'John Doe';

const getUserPhoneNumber = () => '***********';

exports.getUserName = getUserName;
__webpack_unused_export__ = getUserPhoneNumber;
/***/ })
```

Webpack Â∞ÜÊàë‰ª¨ÊâÄÊúâÁöÑ‰ª£Á†ÅÈáçÊñ∞ÁªÑÁªáÂà∞‰∫ÜÂêå‰∏Ä‰∏™Êñá‰ª∂Èáå„ÄÇËØ∑ÁúãÂÖ∂‰∏≠ÁöÑ `getUserPhoneNumer` ÂØºÂá∫È°πÔºåÊ≥®ÊÑèÂà∞ Webpack Â∞ÜÂÆÉÊ†áËÆ∞‰∏∫‰∫ÜÊú™ÂºïÁî®„ÄÇÂÆÉ‰ºöÂú®Áîü‰∫ßÊ®°Âºè‰∏ãË¢´ÁßªÈô§ÔºåËÄå `getUserName` Âàô‰ºöË¢´‰øùÁïôÔºåÂõ†‰∏∫ÂÆÉË¢´Êàë‰ª¨ÁöÑÂÖ•Âè£Êñá‰ª∂ `index.js` ÊâÄ‰ΩøÁî®„ÄÇ

![‰∏Ä‰∏™ÊëáÊ†ë‰ºòÂåñÂêéÁöÑÂ∫ìÂØπÂ∫îÁöÑ‰∏ÄÂº†ÁÆÄÂçïÁöÑÊ®°ÂùóÂõæ](https://github.com/darkyzhou/blog/raw/master/static/images/uploads/tree-shaking-2.svg)

Êàë‰ª¨ÁöÑÂ∫ìË¢´ÊëáÊ†ë‰ºòÂåñ‰∫ÜÔºÅ‰Ω†ÂèØ‰ª•ÂÜçÂÜô‰∏Ä‰∫õÂØºÂÖ•È°πÔºåÈáçÂ§ç‰∏äÈù¢ÁöÑÊ≠•È™§ÂÜçÊü•ÁúãËæìÂá∫ÁöÑ‰ª£Á†Å„ÄÇ**Êàë‰ª¨ÁöÑÁõÆÁöÑÊòØÁü•ÈÅì Webpack ‰ºöÊääÊàë‰ª¨Â∫ìÈáåÊ≤°ÊúâË¢´ÂºïÁî®ÁöÑ‰ª£Á†ÅÊ†áËÆ∞‰∏∫Êú™ÂºïÁî®„ÄÇ**

ÂØπ‰∫éÊàë‰ª¨Ëøô‰∏™ÁÆÄÂçïÁöÑ `user-library` Êù•ËØ¥Ôºå‰∏ÄÂàáÁúã‰∏äÂéªÈÉΩËøò‰∏çÈîô„ÄÇËÆ©Êàë‰ª¨Â∞ÜÂÆÉÂèòÂæóÂ§çÊùÇ‰∏Ä‰∫õÔºå‰∏éÊ≠§ÂêåÊó∂Êàë‰ª¨‰ºöÂÖ≥Ê≥®ÊëáÊ†ë‰ºòÂåñÁöÑ‰∏Ä‰∫õÊù°‰ª∂Âíå‰ºòÂåñÈ°π„ÄÇ

## ‰ΩøÁî® ES6 Ê®°ÂùóÊù•ËÆ©ÊâìÂåÖÂ∑•ÂÖ∑Âæó‰ª•ËØÜÂà´Êú™Ë¢´‰ΩøÁî®ÁöÑ export

ËøôÈ°πË¶ÅÊ±ÇÈùûÂ∏∏Â∏∏ËßÅÔºåËÄå‰∏îÂæàÂ§öÊñáÊ°£ÈÉΩÊúâËØ¶ÁªÜÁöÑËß£ÈáäÔºå‰ΩÜÂú®ÊàëÁúãÊù•ÂÆÉ‰ª¨Âç¥Êúâ‰∫õËØØÂØºÊÄß„ÄÇÊàëÊó∂Â∏∏ËÉΩÂê¨Âà∞‰∏Ä‰∫õÂºÄÂèëËÄÖËØ¥ÔºåÊàë‰ª¨Â∫îËØ•‰ΩøÁî® ES6 Ê®°ÂùóÊù•ËÆ©Êàë‰ª¨ÁöÑÂ∫ìËÉΩÂ§üË¢´ÊëáÊ†ë‰ºòÂåñ„ÄÇËôΩÁÑ∂ËøôÂè•ËØùÊú¨Ë∫´ÊòØÂÆåÂÖ®Ê≠£Á°ÆÁöÑÔºå‰ΩÜ **ÂÖ∂‰∏≠ÂåÖÂê´‰∏ÄÁßçÈîôËØØÁöÑËßÇÂøµÔºåËøôÁßçËßÇÂøµ‰ª•‰∏∫‰ªÖ‰ªÖ‰ΩøÁî® ES6 Ê®°ÂùóÂ∞±Ë∂≥‰ª•ËÆ©ÊëáÊ†ë‰ºòÂåñÂæàÂ•ΩÂú∞Â∑•‰Ωú„ÄÇ** ÂìéÔºåË¶ÅÊòØÁúüÁöÑËøô‰πàÁÆÄÂçïÔºå‰Ω†‰πüÁªù‰∏ç‰ºöÈòÖËØªÊú¨ÊñáËá≥Ê≠§ÔºÅ

‰∏çËøáÔºå‰ΩøÁî® ES6 Ê®°ÂùóÁ°ÆÂÆûÊòØÊëáÊ†ë‰ºòÂåñÁöÑÂøÖË¶ÅÊù°‰ª∂‰πã‰∏Ä„ÄÇ

JavaScript ‰ª£Á†ÅÁöÑÊâìÂåÖÊ†ºÂºèÊúâÂæàÂ§öÁßçÔºöESM„ÄÅCJS„ÄÅUMD„ÄÅIIFE Á≠â„ÄÇ

‰∏∫ÁÆÄÂçïËµ∑ËßÅÔºåÊàë‰ª¨Âè™ËÄÉËôë‰∏§ÁßçÊ†ºÂºèÔºöECMA Script Ê®°ÂùóÔºàESM Êàñ ES6 Ê®°ÂùóÔºâÂíå CommonJS Ê®°ÂùóÔºàCJSÔºâÔºåÂõ†‰∏∫ÂÆÉ‰ª¨Âú®Â∫îÁî®Â∫ì‰∏≠ÂèóÂà∞‰∫ÜÊúÄ‰∏∫ÂπøÊ≥õÁöÑ‰ΩøÁî®„ÄÇÂ§ßÂ§öÊï∞Â∫ì‰ºö‰ΩøÁî® CJS Ê®°ÂùóÔºåÂõ†‰∏∫ËøôÊ†∑ËÉΩÂ§üËÆ©ÂÆÉ‰ª¨ËÉΩÂ§üËøêË°åÂú® Node.js Â∫îÁî®ÈáåÔºà‰∏çËøá [Node.js Áé∞Âú®‰πüÊîØÊåÅ ESM ‰∫Ü](https://nodejs.medium.com/announcing-core-node-js-support-for-ecmascript-modules-c5d6dc29b663)Ôºâ„ÄÇÂú® CJS ËØûÁîüÂæà‰πÖ‰πãÂêéÁöÑ 2015 Âπ¥ÔºåES Ê®°ÂùóÊâç‰º¥Èöè ECMAScript 2015Ôºà‰πüË¢´Áß∞‰Ωú ES6ÔºâÂá∫Áé∞ÔºåË¢´ËÆ§‰∏∫ÊòØ JavaScript ÁöÑÊ†áÂáÜÊ®°ÂùóÁ≥ªÁªü„ÄÇ

CJS Ê†ºÂºèÁöÑ‰æãÂ≠êÔºö

```js
const { userAccount } = require("./userAccount");

const getUserAccount = () => {
  return userAccount;
};

module.exports = { getUserAccount };
```

ESM Ê†ºÂºèÁöÑ‰æãÂ≠êÔºö

```js
import { userAccount } from "./userAccount";

export const getUserAccount = () => {
  return userAccount;
};
```

**Ëøô‰∏§ÁßçÊ†ºÂºèÊúâÁùÄÂæàÂ§ßÁöÑÂå∫Âà´ÔºöESM ÁöÑÂØºÂÖ•ÊòØÈùôÊÄÅÁöÑÔºåËÄå CJS ÁöÑÂØºÂÖ•ÊòØÂä®ÊÄÅÁöÑ„ÄÇ** ËøôÊÑèÂë≥ÁùÄÊàë‰ª¨ÂèØ‰ª•Âú® CJS ‰∏≠ÂÅöÂà∞‰ª•‰∏ãÁöÑ‰∫ãÊÉÖÔºå‰ΩÜÊòØÂú® ESM ‰∏≠‰∏çË°åÔºö

```js
if (someCondition) {
  const { userAccount } = require("./userAccount");
}
```

ËôΩÁÑ∂ËøôÊ†∑Áúã‰∏äÂéªÊõ¥Âä†ÁÅµÊ¥ªÔºå‰ΩÜÂÆÉ‰πüÊÑèÂë≥ÁùÄ**ÊâìÂåÖÂ∑•ÂÖ∑‰∏çËÉΩÂú®ÁºñËØëÊàñÊâìÂåÖÊúüÈó¥ÊûÑÈÄ†Âá∫‰∏ÄÊ£µÊúâÊïàÁöÑÊ®°ÂùóÊ†ë**„ÄÇ`someCondition` Ëøô‰∏™ÂèòÈáèÂè™ÊúâÂú®ËøêË°åÊó∂ÊâçËÉΩÁü•ÈÅìÂÆÉÁöÑÂÄºÔºåÂØºËá¥ÊâìÂåÖÂ∑•ÂÖ∑Âú®ÁºñËØëÊúüÈó¥Êó†ËÆ∫ `someCondition` ÁöÑÂÄºÊòØ‰ªÄ‰πàÈÉΩ‰ºöÊää `userAccount` ÁªôÂØºÂÖ•ËøõÊù•„ÄÇËøô‰πüÂØºËá¥ÊâìÂåÖÂ∑•ÂÖ∑Êó†Ê≥ïÊ£ÄÊü•Ëøô‰∫õÂØºÂÖ•È°πÊòØÂê¶ÁúüÁöÑË¢´‰ΩøÁî®‰∫ÜÔºå‰∫éÊòØÊääÊâÄÊúâ CJS Ê†ºÂºèÁöÑÂØºÂÖ•È°πÊâìÂåÖËøõ bundle Èáå„ÄÇ

ËÆ©Êàë‰ª¨‰øÆÊîπ `user-library` ÁöÑ‰ª£Á†ÅÊù•‰ΩìÁé∞Ëøô‰∏ÄÁÇπ„ÄÇÂêåÊó∂Ôºå‰∏∫‰∫ÜËÆ©Ëøô‰∏™Â∫ìÊòæÂæóÊõ¥Ë¥¥ËøëÁé∞ÂÆûÔºåÂÆÉÁé∞Âú®Êúâ‰∏§‰∏™Êñá‰ª∂Ôºö

`src/userAccount.js`

```js
const userAccount = {
  name: "user account",
};

module.exports = { userAccount };
```

`src/index.js`

```js
const { userAccount } = require("./userAccount");

const getUserName = () => "John Doe";

const getUserPhoneNumber = () => "***********";

const getUserAccount = () => userAccount;

module.exports = {
  getUserName,
  getUserPhoneNumber,
  getUserAccount,
};
```

Êàë‰ª¨‰øùÊåÅ `user-app` ÁöÑÂÖ•Âè£Êñá‰ª∂‰∏çÂèòÔºåËøôÊ†∑Êàë‰ª¨‰æùÁÑ∂‰∏ç‰ºöÁî®Âà∞ `getUserAccount` ÂáΩÊï∞ÂèäÂÖ∂‰æùËµñ„ÄÇ

```js
/*!*************************************************!*\
  !*** ./node_modules/user-library/dist/index.js ***!
  \*************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const { userAccount } = __webpack_require__(/*! ./userAccount */ "./node_modules/user-library/dist/userAccount.js")

const getUserName = () => 'John Doe'

const getUserPhoneNumber = () => '***********'

const getUserAccount = () => userAccount

module.exports = {
  getUserName,
  getUserPhoneNumber,
  getUserAccount
}
/***/ }),

/***/ "./node_modules/user-library/dist/userAccount.js":
/*!*******************************************************!*\
  !*** ./node_modules/user-library/dist/userAccount.js ***!
  \*******************************************************/
/***/ ((module) => {

const userAccount = {
  name: 'user account'
}

module.exports = { userAccount }
/***/ })
```

Ëøô‰∏â‰∏™ÂØºÂá∫È°πÂÖ®ÈÉ®ÈÉΩÂá∫Áé∞Âú®ÊâìÂåÖËæìÂá∫ÈáåÔºåÂπ∂‰∏îÊ≤°ÊúâË¢´ Webpack Ê†áËÆ∞‰∏∫Êú™ÂºïÁî®„ÄÇÂØπ‰∫éÊ∫êÊñá‰ª∂ `userAccount` ‰πüÊòØÂ¶ÇÊ≠§„ÄÇ

Áé∞Âú®ÔºåËÆ©Êàë‰ª¨Êù•ÁúãÁúãÂ∞Ü‰∏äÈù¢ÁöÑ‰æãÂ≠êÊîπÈÄ†Êàê ESM ‰πãÂêéÁöÑÁªìÊûú„ÄÇÊàë‰ª¨ÂÅöÁöÑ‰øÆÊîπÊòØÂ∞Ü `require` Âíå `exports` ÁöÑËØ≠Ê≥ïÂÖ®ÈÉ®ÊîπÊàêÂØπÂ∫îÁöÑ ESM ÁöÑËØ≠Ê≥ï„ÄÇ

```js
/*!*************************************************!*\
  !*** ./node_modules/user-library/dist/index.js ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "getUserName": () => /* binding */ getUserName
/* harmony export */ });
/* unused harmony exports getUserAccount, getUserPhoneNumber */
/* harmony import */ var _userAccount_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./userAccount.js */ "./node_modules/user-library/dist/userAccount.js");

const getUserName = () => 'John Doe';

const getUserPhoneNumber = () => '***********';

const getUserAccount = () => userAccount;

/***/ }),
/***/ "./node_modules/user-library/dist/userAccount.js":
/*!*******************************************************!*\
  !*** ./node_modules/user-library/dist/userAccount.js ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* unused harmony export userAccount */
const userAccount = {
  name: 'user account'
};
/***/ })
```

Ê≥®ÊÑèÔºå`getUserAccount` Âíå `getUserPhoneNumber` ÈÉΩË¢´Ê†áËÆ∞‰∏∫‰∫ÜÊú™ÂºïÁî®„ÄÇËÄå‰∏îÂè¶‰∏Ä‰∏™Êñá‰ª∂ÈáåÁöÑ `userAccount` ‰πüË¢´Ê†áËÆ∞‰∫Ü„ÄÇÂæóÁõä‰∫é `innerGraph` ‰ºòÂåñÔºåWebpack ËÉΩÂ§üÂ∞Ü `index.js` Êñá‰ª∂ÈáåÁöÑ `getUserAccount` ÂØºÂÖ•È°πÈìæÊé•Âà∞ `userAccount` ÂØºÂá∫È°π„ÄÇ**ËøôËÆ© Webpack ÂèØ‰ª•‰ªéÂÖ•Âè£Êñá‰ª∂ÂºÄÂßãÔºåÈÄíÂΩíÈÅçÂéÜÂÆÉÊâÄÊúâÁöÑ‰æùËµñÔºåËøõËÄåÁü•ÈÅìÊØè‰∏Ä‰∏™Ê®°ÂùóÁöÑÂì™‰∫õÂØºÂá∫È°πÊú™Ë¢´ÂºïÁî®„ÄÇ** Âõ†‰∏∫ Webpack Áü•ÈÅì `getUserAccount` Ê≤°ÊúâË¢´‰ΩøÁî®ÔºåÊâÄ‰ª•ÂÆÉÂèØ‰ª•Âà∞ `userAccount` Êñá‰ª∂ÈáåÂØπ `getUserAccount` ÁöÑ‰æùËµñÂÅöÁõ∏ÂêåÁöÑÊ£ÄÊü•„ÄÇ

![‰ΩøÁî® ESM Ê†ºÂºèÁöÑÂ∫ìÁöÑÂØºÂá∫Ê®°ÂùóÂõæ](https://github.com/darkyzhou/blog/raw/master/static/images/uploads/tree-shaking-3.svg)

ES Ê®°ÂùóËÆ©Êàë‰ª¨ÂèØ‰ª•Âú®Â∫îÁî®‰ª£Á†ÅÈáåÂØªÊâæÈÇ£‰∫õË¢´ÂºïÁî®ÁöÑÂíåÊú™Ë¢´ÂºïÁî®ÁöÑÂØºÂá∫È°πÔºåËøô‰πüËß£Èáä‰∫Ü‰∏∫‰ªÄ‰πàËøôÁßçÊ®°ÂùóÁ≥ªÁªüÂØπ‰∫éÊëáÊ†ë‰ºòÂåñÊòØÂ¶ÇÊ≠§ÁöÑÈáçË¶Å„ÄÇÂÆÉËøòËß£Èáä‰∫Ü‰∏∫‰ªÄ‰πàÊàë‰ª¨Â∫îËØ•‰ΩøÁî®ÂÉè [`lodash-es`](https://www.npmjs.com/package/lodash-es) ËøôÊ†∑ÂØºÂá∫‰∫ÜÂÖºÂÆπ ESM ÁöÑÊûÑÂª∫‰∫ßÁâ©ÁöÑ‰æùËµñ„ÄÇËøôÈáå lodash-es Â∫ìÊòØÂæàÂèóÊ¨¢ËøéÁöÑ [`lodash`](https://lodash.com/) Â∫ìÁöÑ ESM ÁâàÊú¨„ÄÇ

ËØùËôΩÂ¶ÇÊ≠§Ôºå**ÈíàÂØπÊëáÊ†ë‰ºòÂåñÔºå‰ªÖ‰ªÖ‰ΩøÁî® ES Ê®°Âùó‰ªçÁÑ∂‰∏çÊòØÊúÄ‰Ω≥ÁöÑÊñπÊ≥ï**„ÄÇÂú®Êàë‰ª¨ÁöÑ‰æãÂ≠êÈáåÔºåÊàë‰ª¨ÂèëÁé∞ Webpack ‰ºöÂú®ÊØè‰∏™Êñá‰ª∂ÈÄíÂΩíÂú∞Ê£ÄÊü•ÂØºÂá∫ÁöÑ‰ª£Á†ÅÊòØÂê¶Ë¢´ÂºïÁî®„ÄÇÂØπ‰∫éÊàë‰ª¨ÁöÑ‰æãÂ≠êÊù•ËØ¥ÔºåWebpack ÂÖ∂ÂÆûÂèØ‰ª•Áõ¥Êé•ÂøΩÁï•Êéâ `userAccount` Êñá‰ª∂ÔºåÂõ†‰∏∫ÂÆÉÂîØ‰∏ÄÁöÑÂØºÂá∫È°πÊòØÊú™ÂºïÁî®ÁöÑÔºÅËøôÂ∞±Â∞ÜÊàë‰ª¨ÂºïÂÖ•Âà∞ÊñáÁ´†Êé•‰∏ãÊù•ÂØπÂâØ‰ΩúÁî®Ôºàside effectÔºâÁöÑËÆ®ËÆ∫„ÄÇ

Êú¨ÊñáËøô‰∏ÄÈÉ®ÂàÜÁöÑÊÄªÁªìÂ¶Ç‰∏ãÔºö

* **ESM ÊòØÊëáÊ†ë‰ºòÂåñÁöÑÊù°‰ª∂‰πã‰∏ÄÔºå‰ΩÜ‰ªÖÂá≠ÂÆÉ‰∏çË∂≥‰ª•ËÆ©ÊëáÊ†ë‰ºòÂåñËææÂà∞ÁêÜÊÉ≥ÊïàÊûú„ÄÇ**
* **Á°Æ‰øù‰Ω†ÁöÑÂ∫ìÊÄªÊòØÊèê‰æõ‰∏Ä‰ªΩ ESM Ê†ºÂºèÁöÑÁºñËØë‰∫ßÁâ©ÔºÅ** Â¶ÇÊûú‰Ω†ÁöÑÂ∫ìÁöÑÁî®Êà∑ÈúÄË¶Å ESM Âíå CJS Ê†ºÂºèÁöÑÁºñËØë‰∫ßÁâ©ÔºåÂèØ‰ª•ÈÄöËøá package.json ‰∏≠ÁöÑ [`main` Âíå `module` Â±ûÊÄß](https://github.com/rollup/rollup/wiki/pkg.module)Êù•ËÆæÁΩÆ„ÄÇ
* Â¶ÇÊûúÂèØ‰ª•ÁöÑËØùÔºå**Á°Æ‰øùÊÄªÊòØ‰ΩøÁî® ESM Ê†ºÂºèÁöÑ‰æùËµñ**ÔºåÂê¶ÂàôÂÆÉ‰ª¨‰∏çËÉΩË¢´ÊëáÊ†ë‰ºòÂåñ„ÄÇ

## ‰ΩøÁî®ÂâØ‰ΩúÁî®‰ºòÂåñÊù•ËÆ©‰Ω†ÁöÑÂ∫ì‰∏çÂåÖÂê´ÂâØ‰ΩúÁî®

Ê†πÊçÆ [Webpack](https://webpack.js.org/) ÁöÑÊñáÊ°£ÔºåÊëáÊ†ë‰ºòÂåñÂèØ‰ª•Ë¢´ÂàÜ‰∏∫‰ª•‰∏ã‰∏§Áßç‰ºòÂåñÊé™ÊñΩÔºö

* **ÂºïÁî®ÂØºÂá∫ÔºàusedExportsÔºâ**ÔºöÂà§ÂÆö‰∏Ä‰∏™Ê®°ÂùóÁöÑÂì™‰∫õÂØºÂá∫È°πÊòØË¢´ÂºïÁî®ÁöÑÊàñÊú™Ë¢´ÂºïÁî®„ÄÇ
* **ÂâØ‰ΩúÁî®ÔºàsideEffectsÔºâ**ÔºöÁï•ËøáÈÇ£‰∫õ‰∏çÂåÖÂê´‰ªª‰ΩïË¢´ÂºïÁî®ÁöÑÂØºÂá∫È°πÂπ∂‰∏î‰∏çÂåÖÂê´ÂâØ‰ΩúÁî®ÁöÑÊ®°Âùó„ÄÇ

‰∏∫‰∫ÜÈòêÈáäÂâØ‰ΩúÁî®ÁöÑÂê´‰πâÔºåËÆ©Êàë‰ª¨ÁúãÁúã‰πãÂâçÁî®Âà∞ÁöÑ‰æãÂ≠êÔºö

```js
import { userAccount } from "./userAccount";

function getUserAccount() {
  return userAccount;
}
```

Â¶ÇÊûú `getUserAccount` Ê≤°ÊúâË¢´‰ΩøÁî®ÔºåÊâìÂåÖÂ∑•ÂÖ∑ÊòØÂê¶ÂèØ‰ª•ËÆ§‰∏∫ `userAccount` Ê®°ÂùóÂèØ‰ª•‰ªéÊâìÂåÖËæìÂá∫‰∏≠ÁßªÈô§Âë¢ÔºüÁ≠îÊ°àÊòØÂê¶ÂÆöÁöÑÔºÅ`userAccount` ÂèØ‰ª•ÂÅöÂêÑÁßçËÉΩÂ§üÂΩ±ÂìçÂ∫îÁî®ÁöÑÂÖ∂‰ªñÈÉ®ÂàÜÁöÑ‰∫ãÊÉÖ„ÄÇÂÆÉÂèØ‰ª•ÂêëÂÖ®Â±ÄÂèØËÆøÈóÆÁöÑÂÄºÈáåÊ≥®ÂÖ•‰∏Ä‰∫õÂèòÈáèÔºåÊØîÂ¶Ç DOM„ÄÇÂÆÉËøòÂèØ‰ª•ÊòØ‰∏Ä‰∏™ CSS Ê®°ÂùóÔºå‰ºöÂêë `document` ÈáåÊ≥®ÂÖ•Ê†∑Âºè„ÄÇ‰∏çËøáÊàëËßâÂæóÊúÄÂ•ΩÁöÑ‰æãÂ≠êÊòØ polyfill„ÄÇÊàë‰ª¨ÈÄöÂ∏∏‰ºöÂÉè‰∏ãÈù¢ËøôÊ†∑ÂºïÂÖ•ÂÆÉ‰ª¨Ôºö

```js
import "myPolyfill";
```

Áé∞Âú®Ëøô‰∏™Ê®°Âùó‰∏ÄÂÆöÊúâÂâØ‰ΩúÁî®‰∫ÜÔºåÂõ†‰∏∫‰∏ÄÊó¶ÂÆÉË¢´ÂØºÂÖ•Âà∞ÂÖ∂‰ªñÊ®°ÂùóÔºåÂÆÉÂ∞±‰ºöÂΩ±ÂìçÂà∞Êï¥‰∏™Â∫îÁî®ÁöÑ‰ª£Á†Å„ÄÇÊâìÂåÖÂ∑•ÂÖ∑‰ºöÂ∞ÜËøô‰∏™Ê®°ÂùóËßÜ‰∏∫ÂèØËÉΩË¢´Âà†Èô§ÁöÑÂÄôÈÄâËÄÖÔºåÊØïÁ´üÊàë‰ª¨Ê≤°Êúâ‰ΩøÁî®ÂÆÉÁöÑ‰ªª‰ΩïÂØºÂá∫È°π„ÄÇ‰∏çËøáÁßªÈô§ÂÆÉ‰ºöÁ†¥ÂùèÊàë‰ª¨Â∫îÁî®ÁöÑÊ≠£Â∏∏ËøêË°å„ÄÇ

**ÂÉè [Webpack](https://webpack.js.org/) Âíå [Rollup](https://rollupjs.org/guide/en/#treeshake) ËøôÊ†∑ÁöÑÊâìÂåÖÂ∑•ÂÖ∑‰πüÂõ†Ê≠§‰ºöÈªòËÆ§Âú∞Â∞ÜÊàë‰ª¨Â∫ì‰∏≠ÁöÑÊâÄÊúâÊ®°ÂùóËßÜ‰∏∫ÂåÖÂê´ÂâØ‰ΩúÁî®„ÄÇ**

‰ΩÜÊòØÂú®ÂâçÈù¢ÁöÑ‰æãÂ≠êÈáåÔºåÊàë‰ª¨Áü•ÈÅìÊàë‰ª¨ÁöÑÂ∫ì‰∏çÂåÖÂê´‰ªª‰ΩïÂâØ‰ΩúÁî®ÔºÅÂõ†Ê≠§ÔºåÊàë‰ª¨ÂèØ‰ª•ÂëäËØâÊâìÂåÖÂ∑•ÂÖ∑Ëøô‰∏ÄÁÇπ„ÄÇÂ§ßÂ§öÊï∞ÊâìÂåÖÂ∑•ÂÖ∑[ÂèØ‰ª•ËØªÂèñ `package.json` Êñá‰ª∂ÈáåÁöÑ `sideEffects` Â±ûÊÄß](https://webpack.js.org/guides/tree-shaking/#mark-the-file-as-side-effect-free)„ÄÇËøô‰∏™Â±ûÊÄßÂ¶ÇÊûúÊ≤°ÊúâÊåáÂÆöÔºåÈÇ£‰πàÂÆÉÈªòËÆ§‰ºöË¢´ËÆæ‰∏∫ `true`ÔºàË°®Á§∫Ëøô‰∏™ÂåÖÈáåÊâÄÊúâÁöÑÊ®°ÂùóÈÉΩÂê´ÊúâÂâØ‰ΩúÁî®Ôºâ„ÄÇÊàë‰ª¨ÂèØ‰ª•Â∞ÜÂÆÉËÆæ‰∏∫ `false`ÔºàË°®Á§∫ÊâÄÊúâÊ®°ÂùóÈÉΩ‰∏çÂåÖÂê´ÂâØ‰ΩúÁî®ÔºâÊàñËÄÖ‰πüÂèØ‰ª•ÊåáÂÆö‰∏Ä‰∏™Êï∞ÁªÑÔºåÂàó‰∏æÂá∫Âê´ÊúâÂâØ‰ΩúÁî®ÁöÑÊ∫êÊñá‰ª∂„ÄÇ

Êàë‰ª¨Â∞ÜËøô‰∏™Â±ûÊÄßÊ∑ªÂä†Âà∞ `user-library` Â∫ìÁöÑ `package.json` ‰∏≠Ôºö

```json
{
  "name": "user-library",
  "version": "1.0.0",
  "description": "",
  "sideEffects": false,
  "main": "dist/index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "",
  "license": "ISC"
}
```

ÁÑ∂ÂêéÈáçÊñ∞ËøêË°å Webpack ËøõË°åÊâìÂåÖÔºö

```js
/*!*************************************************!*\
  !*** ./node_modules/user-library/dist/index.js ***!
  \*************************************************/
/***/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
  /* harmony export */ __webpack_require__.d(__webpack_exports__, {
    /* harmony export */ getUserName: () => /* binding */ getUserName,
    /* harmony export */
  });
  /* unused harmony exports getUserAccount, getUserPhoneNumber */

  const getUserName = () => "John Doe";

  const getUserPhoneNumber = () => "***********";

  const getUserAccount = () => userAccount;
  /***/
};
```

Êàë‰ª¨ÂèëÁé∞ÔºåÊ∫êÊñá‰ª∂ `userAccount` Â∑≤ÁªèÂú®ÊâìÂåÖËæìÂá∫‰∏≠Ë¢´ÁßªÈô§‰∫Ü„ÄÇÊàë‰ª¨‰ªçÁÑ∂ËÉΩÂ§üÁúãÂà∞ `getUserAccount` ÂáΩÊï∞Âú®ÂºïÁî® `userAccount`Ôºå‰∏çËøáÊ≠§ÂáΩÊï∞Â∑≤ÁªèË¢´ Webpack Ê†áËÆ∞‰∏∫‰∫ÜÊú™ÂºïÁî®‰ª£Á†ÅÔºåÂÆÉ‰ºöÂú®‰ª£Á†ÅÊúÄÂ∞èÂåñÁöÑËøáÁ®ã‰∏≠Ë¢´ÁßªÈô§„ÄÇ

![ÂâØ‰ΩúÁî®‰ºòÂåñ‰∏ãÁöÑÊ®°ÂùóÂõæ](https://github.com/darkyzhou/blog/raw/master/static/images/uploads/tree-shaking-4.svg)

** `sideEffects` ÈÄâÈ°πÂØπ‰∫éÈÇ£‰∫õÈÄöËøá‰∏Ä‰∏™ index Êñá‰ª∂‰ªéÂÖ∂‰ªñÂÜÖÈÉ®Ê∫êÊñá‰ª∂ÂØºÂá∫ API ÁöÑÂ∫ìÂ∞§ÂÖ∂ÈáçË¶Å„ÄÇ** Â¶ÇÊûúÊ≤°ÊúâÂâØ‰ΩúÁî®‰ºòÂåñÔºåÊâìÂåÖÂ∑•ÂÖ∑Â∞±ÂøÖÈ°ªËß£ÊûêÊâÄÊúâÂåÖÂê´ÂØºÂá∫È°πÁöÑÊ∫êÊñá‰ª∂„ÄÇ

Ê≠£Â¶Ç [Webpack ÁöÑÊèêÁ§∫](https://webpack.js.org/guides/tree-shaking/#clarifying-tree-shaking-and-sideeffects)Ôºö**‚Äú`sideEffects` ÈùûÂ∏∏Âú∞È´òÊïàÔºåÂõ†‰∏∫ÂÆÉËÉΩÂ§üËÆ©ÊâìÂåÖÂ∑•ÂÖ∑Áï•ËøáÊï¥‰∏™ÁöÑÊ®°ÂùóÊàñÊ∫êÊñá‰ª∂Ôºå‰ª•ÂèäÂÆÉÁöÑÊï¥‰∏™Â≠êÊ†ë‚Äù**

ÂØπ‰∫éÂâçÊñá‰ªãÁªçÁöÑ‰∏§Áßç‰ºòÂåñÊé™ÊñΩÂú®‰ªãÂÖ•ÊâìÂåÖËøáÁ®ã‰∏äÁöÑ‰∏çÂêå‰πãÂ§ÑÔºåÁÆÄÂçïÊù•ËØ¥Â¶Ç‰∏ãÊâÄËø∞Ôºö

* `sideEffects` ËÆ©ÊâìÂåÖÂ∑•ÂÖ∑Áï•Ëøá‰∏Ä‰∏™Ë¢´ÂØºÂÖ•ÁöÑÊ®°ÂùóÔºåÂ¶ÇÊûú‰ªéËøô‰∏™Ê®°ÂùóÂØºÂÖ•ÁöÑ‰∏úË•øÂÖ®ÈÉ®ÈÉΩÊ≤°ÊúâË¢´‰ΩøÁî®ÁöÑËØù„ÄÇ
* `usedExports` ËÆ©ÊâìÂåÖÂ∑•ÂÖ∑ÁßªÈô§Âú®‰∏Ä‰∏™Ê®°ÂùóÈáåÊú™Ë¢´ÂºïÁî®ÁöÑÂØºÂá∫È°π„ÄÇ

ÈÇ£‰πàÔºå‰∏äÈù¢‰∏§ÁßçÊé™ÊñΩÔºå‰∏Ä‰∏™ÊòØ‚ÄúÁï•ËøáÊñá‰ª∂‚ÄùÔºå‰∏Ä‰∏™ÊòØ‚ÄúÂ∞ÜÂØºÂá∫È°πÊ†áËÆ∞‰∏∫Êú™Ë¢´‰ΩøÁî®‚Äù„ÄÇ**ÂâçËÄÖÂΩ±Âìç‰∏ãÁöÑÊâìÂåÖËæìÂá∫ÂèàÂíåÂêéËÄÖÊúâ‰ªÄ‰πà‰∏çÂêå‰πãÂ§ÑÂë¢Ôºü**

Â§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ãÔºåÂØπ‰∏Ä‰∏™Â∫ìËøõË°åÊëáÊ†ë‰ºòÂåñÔºåÊúâÂíåÊ≤°ÊúâÂâØ‰ΩúÁî®‰ºòÂåñÂÖ∂ÂÆû‰ºö‰∫ßÁîü‰∏ÄÊ®°‰∏ÄÊ†∑ÁöÑËæìÂá∫„ÄÇÊúÄÁªàÁöÑ bundle ÈáåÂåÖÂê´ÁöÑ‰ª£Á†ÅÈáèÊòØ‰∏ÄÊ†∑ÁöÑ„ÄÇ‰∏çËøáÂú®Êüê‰∫õÊÉÖÂÜµ‰∏ãÔºåÂ¶ÇÊûúÂàÜÊûêÊú™ÂºïÁî®ÁöÑÂØºÂá∫È°πÁöÑÁõ∏ÂÖ≥‰ª£Á†ÅÁöÑËøáÁ®ãËøá‰∫éÂ§çÊùÇÔºåÈÇ£‰πàÊúâÂíåÊ≤°ÊúâÂâØ‰ΩúÁî®‰ºòÂåñÁöÑÁªìÊûúÂ∞±‰∏ç‰∏ÄÊ†∑‰∫Ü„ÄÇÊú¨ÊñáÊé•‰∏ãÊù•ÁöÑÈÉ®ÂàÜÂ∞ÜÂåÖÂê´Ëøô‰∏§ÁßçÊÉÖÂÜµÁöÑ‰æãÂ≠êÔºåÊàë‰ª¨Â∞ÜÁúãÂà∞Âè™ÊúâÂ∞èÁöÑÊ®°ÂùóÂíåÂºÄÂêØÂâØ‰ΩúÁî®‰ºòÂåñÁöÑÁªÑÂêà‰∫ßÁîü‰∫ÜÊúÄÂ•ΩÁöÑÊâìÂåÖ‰∫ßÁâ©„ÄÇ

**Ëøô‰∏ÄÈÉ®ÂàÜÁöÑÊÄªÁªìÂ¶Ç‰∏ãÔºö**

* ÊëáÊ†ë‰ºòÂåñÂåÖÂê´‰∏§‰∏™ÈÉ®ÂàÜÔºö**ÂºïÁî®ÂØºÂá∫Ôºàused exportsÔºâ‰ºòÂåñ**Âíå**ÂâØ‰ΩúÁî®Ôºàside effectsÔºâ‰ºòÂåñ**„ÄÇ
* side effects ‰ºòÂåñÁõ∏ÊØîËµ∑Ê£ÄÊµãÊØè‰∏™Ê®°Âùó‰∏≠Êú™Ë¢´‰ΩøÁî®ÁöÑÂØºÂá∫È°πÔºå**ÊúâÊõ¥È´òÁöÑÊïàÁéá**„ÄÇ
* ‰∏çË¶ÅÂú®‰Ω†ÁöÑÂ∫ìÈáåÂºïÂÖ•‰ªª‰ΩïÂâØ‰ΩúÁî®„ÄÇ
* ‰∏ÄÂÆöË¶ÅÈÄöËøá `package.json` Êñá‰ª∂ÈáåÁöÑ `sideEffects` Â±ûÊÄßÂëäËØâÊâìÂåÖÂ∑•ÂÖ∑Ôºö‰Ω†ÁöÑÂ∫ì‰∏çÂåÖÂê´‰ªª‰ΩïÂâØ‰ΩúÁî®„ÄÇ

## ÈÄöËøá‰øùÁïôÂ∫ìÁöÑÊ®°ÂùóÊ†ëÂπ∂Â∞Ü‰ª£Á†ÅÂàÜÂâ≤Âà∞Â∞èÁöÑÊ®°Âùó‰∏≠ÔºåÊù•ËÆ©‰Ω†ÁöÑÂ∫ì‰ªé `side effects` ‰ºòÂåñ‰∏≠ÂÖÖÂàÜËé∑Áõä„ÄÇ

‰Ω†ÂèØËÉΩÊ≥®ÊÑèÂà∞Êàë‰ª¨Âú®Êú¨ÊñáÂÖàÂâçÁöÑ‰æãÂ≠êÈáåÁöÑ `user-library` Âπ∂Ê≤°ÊúâË¢´ÊâìÂåÖÂà∞‰∏Ä‰∏™ÂçïÁã¨ÁöÑÊñá‰ª∂ÈáåÔºåËÄåÊòØÁõ¥Êé•Êö¥Èú≤ÊâãÂä®Âä†ÂÖ•ÁöÑ `.js` Ê∫êÊñá‰ª∂„ÄÇ

ÈÄöÂ∏∏Ôºå‰∏Ä‰∏™Â∫ì‰ºöÁî±‰∫é‰ª•‰∏ãÂéüÂõ†Ë¢´ÊâìÂåÖÔºö

* ‰ΩøÁî®‰∫Ü‰∏Ä‰∫õËá™ÂÆö‰πâÁöÑ `import` Ë∑ØÂæÑ„ÄÇ
* ‰ΩøÁî®ÁöÑÊòØÂÉè Sass ÊàñËÄÖ TypeScript ËøôÊ†∑ÁöÑËØ≠Ë®ÄÔºåÂÆÉ‰ª¨ÈúÄË¶ÅËΩ¨Êç¢Âà∞ÊØîÂ¶Ç CSS ÊàñËÄÖ JavaScript ËøôÊ†∑ÁöÑËØ≠Ë®Ä„ÄÇ
* ÈúÄË¶ÅÊª°Ë∂≥‰∫éÊèê‰æõÂ§öÁßçÊ®°ÂùóÊ†ºÂºèÔºàESM„ÄÅCJS„ÄÅIIFE Á≠âÔºâÁöÑÈúÄÊ±Ç„ÄÇ

ÂÉè [Webpack](https://webpack.js.org/)„ÄÅ[Rollup](https://rollupjs.org/guide/en/)„ÄÅ[Parcel](https://parceljs.org/) Âíå [ESBuild](https://esbuild.github.io/) ËøôÊ†∑ÁöÑÊµÅË°åÁöÑÊâìÂåÖÂ∑•ÂÖ∑Ë¢´ËÆæËÆ°‰∏∫Áî®Êù•Êèê‰æõ‰∏Ä‰∏™ËÉΩÂ§ü‰º†ËæìÁªôÊµèËßàÂô®‰ΩøÁî®ÁöÑ bundle„ÄÇÂÆÉ‰ª¨‰πüÂõ†Ê≠§ÂÄæÂêë‰∫éÂàõÂª∫‰∏Ä‰∏™ÂçïÁã¨ÁöÑÁöÑÊñá‰ª∂ÔºåÁÑ∂ÂêéÂ∞Ü‰Ω†ÁöÑÊâÄÊúâ‰ª£Á†ÅÈáçÊñ∞ÁªÑÂêàÂπ∂ËæìÂá∫Âà∞Ëøô‰∏™Êñá‰ª∂ÈáåÔºå‰ªéËÄåÂè™Êúâ‰∏Ä‰∏™ÂçïÁã¨ÁöÑ `.js` Êñá‰ª∂ÈúÄË¶ÅÈÄöËøáÁΩëÁªúËøõË°å‰º†Ëæì„ÄÇ

‰ªéÊëáÊ†ë‰ºòÂåñÁöÑËßíÂ∫¶Êù•ËØ¥ÔºåËøôÂØºËá¥‰∫Ü‰∏Ä‰∏™ÈóÆÈ¢òÔºö**ÂâØ‰ΩúÁî®‰ºòÂåñ‰∏çÂ§çÂ≠òÂú®‰∫Ü**ÔºåÂõ†‰∏∫Ê≤°ÊúâÊ®°ÂùóËÉΩÂ§üË¢´Áï•Ëøá„ÄÇ

Êàë‰ª¨Â∞ÜÂàó‰∏æ‰∏§ÁßçÊÉÖÂÜµÊù•ËØ¥ÊòéÔºöÂØπÊëáÊ†ë‰ºòÂåñÊù•ËØ¥ÔºåÂàÜÂâ≤Ê®°ÂùóÊê≠ÈÖçÂâØ‰ΩúÁî®‰ºòÂåñÊòØÂøÖÈ°ªÁöÑ„ÄÇ

#### ‰∏Ä‰∏™Â∫ìÊ®°ÂùóÂØºÂÖ•‰∏Ä‰∏™ CJS Ê†ºÂºèÁöÑ‰æùËµñ

‰∏∫‰∫ÜÊºîÁ§∫Ëøô‰∏™ÈóÆÈ¢òÔºåÊàë‰ª¨Â∞Ü‰ΩøÁî® [Rollup](https://rollupjs.org/guide/en/) Êù•ÊâìÂåÖÊàë‰ª¨ÁöÑÂ∫ì„ÄÇÂêåÊó∂ÔºåÊàë‰ª¨Â∞ÜËÆ©Â∫ìÁöÑÂÖ∂‰∏≠‰∏Ä‰∏™Ê®°ÂùóÂØºÂÖ•‰∏Ä‰∏™ CJS Ê†ºÂºèÁöÑ‰æùËµñÔºö[Lodash](https://lodash.com)„ÄÇ

`rollup.config.js`

```js
export default {
  input: "src/index.js",
  output: {
    file: "dist/index.js",
    format: "esm",
  },
};
```

`userAccount.js`

```js
import { isNil } from "lodash";

export const checkExistance = (variable) => !isNil(variable);

export const userAccount = {
  name: "user account",
};
```

Ê≥®ÊÑèÔºåÊàë‰ª¨Áé∞Âú®Â∞ÜÂØºÂá∫ `checkExistance`ÔºåÁÑ∂ÂêéÂ∞ÜÂÆÉÂØºÂÖ•Âà∞Êàë‰ª¨Â∫ìÁöÑ `index.js` Êñá‰ª∂Èáå„ÄÇ

‰ª•‰∏ãÊòØÊâìÂåÖËæìÂá∫ÁöÑÊñá‰ª∂ `dist/index.js`Ôºö

```js
import { isNil } from "lodash";

const checkExistance = (variable) => !isNil(variable);

const userAccount = {
  name: "user account",
};

const getUserAccount = () => {
  return userAccount;
};

const getUserPhoneNumber = () => "***********";

const getUserName = () => "John Doe";

export { checkExistance, getUserName, getUserPhoneNumber, getUserAccount };
```

ÊâÄÊúâÊñá‰ª∂ÈÉΩË¢´ÊâìÂåÖÂà∞‰∫Ü‰∏Ä‰∏™ÂçïÁã¨ÁöÑÊñá‰ª∂Èáå„ÄÇÊ≥®ÊÑè Lodash ‰πüÂú®Ê≠§Êñá‰ª∂ÁöÑÈ°∂ÈÉ®Ë¢´ÂØºÂÖ•„ÄÇÊàë‰ª¨Âú® `user-app` Èáå‰ªçÁÑ∂ÂØºÂÖ•Âíå‰ª•Ââç‰∏ÄÊ†∑ÁöÑÂáΩÊï∞ÔºåËøôÊÑèÂë≥ÁùÄ `checkExistance` ÂáΩÊï∞‰æùÁÑ∂Êú™Ë¢´ÂºïÁî®„ÄÇÁÑ∂ËÄåÔºåÂú®ËøêË°å Webpack ÊâìÂåÖ `user-app` ‰πãÂêéÔºåÊàë‰ª¨ÂèëÁé∞Âç≥‰Ωø `checkExistance` ÂáΩÊï∞Ë¢´Ê†áËÆ∞‰∏∫‰∫ÜÊú™ÂºïÁî®ÔºåÊï¥‰∏™ Lodash Â∫ì‰ªçÁÑ∂Ë¢´ÂØºÂÖ•‰∫ÜÔºö

```js
/***/ "./node_modules/user-library/dist/index.js":
/*!*************************************************!*\
  !*** ./node_modules/user-library/dist/index.js ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "getUserName": () => (/* binding */ getUserName)
/* harmony export */ });
/* unused harmony exports checkExistance, userAccount, getUserPhoneNumber, getUserAccount */
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ "./node_modules/user-library/node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);

const checkExistance = (variable) => !isNil(variable);

const userAccount = {
  name: "user account",
};

const getUserPhoneNumber = {
  number: '***********'
};

const getUserAccount = () => {
  return userAccount
};

const getUserName = () => 'John Doe';

/***/ }),

/***/ "./node_modules/user-library/node_modules/lodash/lodash.js":
/*!*****************************************************************!*\
  !*** ./node_modules/user-library/node_modules/lodash/lodash.js ***!
  \*****************************************************************/
/***/ (function(module, exports, __webpack_require__) {

/* module decorator */ module = __webpack_require__.nmd(module);
var __WEBPACK_AMD_DEFINE_RESULT__;/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
// ...
```

Webpack Êó†Ê≥ïÂØπ Lodash ËøõË°åÊëáÊ†ë‰ºòÂåñÔºåÂõ†‰∏∫ÂÆÉÁöÑÊ®°ÂùóÊ†ºÂºèÊòØ CJS„ÄÇËøôÊå∫ËÆ©‰∫∫Â§±ÊúõÁöÑÔºåÊØïÁ´üÊàë‰ª¨ÈÉΩÂæàÊòéÊòæÂú∞ÁªÑÁªáÂ•Ω‰∫ÜÊàë‰ª¨ÁöÑÂ∫ìÔºåËÆ© Lodash ‰ªÖÂú® `userAccount` Ê®°ÂùóÈáåË¢´ÂØºÂÖ•ÔºåËÄå‰∏îËøô‰∏™Ê®°Âùó‰πüÊ≤°ÊúâË¢´Êàë‰ª¨ÁöÑÂ∫îÁî®ÊâÄÂºïÁî®„ÄÇÂ¶ÇÊûúÊ®°ÂùóÁªìÊûÑËÉΩÂ§ü‰øùÁïôÔºåWebpack Â∞±ËÉΩÂèóÁõä‰∫éÂâØ‰ΩúÁî®‰ºòÂåñÔºå‰ªéËÄåËÉΩÂ§üÊ£ÄÊµãÂà∞ `userAccount` ÁöÑÂØºÂá∫È°πÈÉΩÊú™Ë¢´ÂºïÁî®ÁÑ∂ÂêéÁõ¥Êé•Áï•ËøáËøô‰∏™Ê®°ÂùóÔºåËøôÊ†∑ÁöÑËØù Lodash Â∞±‰∏ç‰ºöË¢´ÊâìÂåÖ‰∫Ü„ÄÇ

Âú® Rollup ‰∏≠ÔºåÊàë‰ª¨ÂèØ‰ª•[‰ΩøÁî® `preserveModules` ÈÄâÈ°πÊù•‰øùÁïôÂ∫ìÁöÑÊ®°ÂùóÁªìÊûÑ](https://rollupjs.org/guide/en/#outputpreservemodules)„ÄÇÂÖ∂‰ªñÊâìÂåÖÂ∑•ÂÖ∑‰πüÊúâÁ±ª‰ººÁöÑÈÄâÈ°π„ÄÇ


```js
export default {
  input: "src/index.js",
  output: {
    dir: "dist",
    format: "esm",
    preserveModules: true,
  },
};
```

[Rollup](https://rollupjs.org/guide/en/) Áé∞Âú®ËÉΩÂ§ü‰øùÁïôÂéüÊú¨ÁöÑÊñá‰ª∂ÁªìÊûÑ‰∫ÜÔºåÊàë‰ª¨ÂÜçÊ¨°ËøêË°å WebpackÔºåÂæóÂà∞‰ª•‰∏ãÁöÑÊâìÂåÖËæìÂá∫Ôºö

```js
/***/ "./node_modules/user-library/dist/index.js":
/*!*************************************************!*\
  !*** ./node_modules/user-library/dist/index.js ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "getUserName": () => (/* binding */ getUserName)
/* harmony export */ });
/* unused harmony export getUserAccount */

const getUserAccount = () => {
  return userAccount
};

const getUserName = () => 'John Doe';

/***/ })
```

[Lodash](https://lodash.com/) Áé∞Âú®Âíå `userAccount` Ê®°Âùó‰∏ÄËµ∑Ë¢´Áï•Ëøá‰∫Ü„ÄÇ

![Âú®‰ΩøÁî® CJS Ê†ºÂºèÁöÑ‰æùËµñÊó∂Ôºå‰øùÁïôÊ®°ÂùóÁªìÊûÑËÉΩÂ§üÊîπÂñÑÊëáÊ†ë‰ºòÂåñÊïàÊûú](https://raw.githubusercontent.com/darkyzhou/blog/master/static/images/uploads/tree-shaking-5.svg)

#### ‰ª£Á†ÅÂàÜÂâ≤

‰øùÁïôÂàÜÂâ≤ÂêéÁöÑÊ®°ÂùóÁªìÊûÑ‰ª•ÂèäÂºÄÂêØÂâØ‰ΩúÁî®‰ºòÂåñ‰πüÊúâÂä©‰∫é [Webpack ÁöÑ‰ª£Á†ÅÂàÜÂâ≤](https://webpack.js.org/guides/code-splitting/)„ÄÇÂÆÉÂØπ‰∫éÂ§ßÂûãÂ∫îÁî®Êù•ËØ¥ÊòØ‰∏Ä‰∏™ÂÖ≥ÈîÆÁöÑ‰ºòÂåñÊé™ÊñΩÔºåË¢´ÂπøÊ≥õÂ∫îÁî®‰∫éÈÇ£‰∫õÂê´ÊúâÂ§ö‰∏™È°µÈù¢ÁöÑ Web Â∫îÁî®„ÄÇÂÉè [Nuxt](https://nuxtjs.org/) Âíå [Next](https://nextjs.org/) ËøôÊ†∑ÁöÑÊ°ÜÊû∂ÈÉΩ‰ºöÁªôÂêÑ‰∏™È°µÈù¢ÈÖçÁΩÆ‰ª£Á†ÅÂàÜÂâ≤„ÄÇ

‰∏∫‰∫ÜÊºîÁ§∫‰ª£Á†ÅÂàÜÂâ≤Â∏¶Êù•ÁöÑÂ•ΩÂ§ÑÔºåÊàë‰ª¨ÂÖàÊù•ÁúãÁúãÂ¶ÇÊûúÊàë‰ª¨ÁöÑÂ∫ìË¢´ÊâìÂåÖÂà∞‰∫Ü‰∏Ä‰∏™ÂçïÁã¨ÁöÑÊñá‰ª∂Êó∂‰ºöÂèëÁîü‰ªÄ‰πà„ÄÇ

`user-library/src/userAccount.js`

```js
export const userAccount = {
  name: "user account",
};
```

`user-library/src/userPhoneNumber.js`

```js
export const userPhoneNumber = {
  number: "***********",
};
```

`user-library/src/index.js`

```js
import { userAccount } from "./userAccount";
import { userPhoneNumber } from "./userPhoneNumber";

const getUserName = () => "John Doe";

export { userAccount, getUserName, userPhoneNumber };
```

‰∏∫‰∫ÜÂØπÊàë‰ª¨ÁöÑÂ∫îÁî®ËøõË°å‰ª£Á†ÅÂàÜÂâ≤ÔºåÊàë‰ª¨‰ºö‰ΩøÁî® [Webpack ÁöÑ `import` ËØ≠Ê≥ï](https://webpack.js.org/api/module-methods/#import-1)„ÄÇ

`user-app/src/userService1.js`

```js
import { userAccount } from "user-library";

export const logUserAccount = () => {
  console.log(userAccount);
};
```

`user-app/src/userService2.js`

```js
import { userPhoneNumber } from "user-library";

export const logUserPhoneNumber = () => {
  console.log(userPhoneNumber);
};
```

`user-app/src/index.js`

```js
const main = async () => {
  const { logUserPhoneNumber } = await import("./userService2");
  const { logUserAccount } = await import("./userService1");

  logUserAccount();
  logUserPhoneNumber();
};

main();
```

ÊâìÂåÖ‰∫ßÁîüÁöÑÊñá‰ª∂Áé∞Âú®Êúâ‰∏â‰∏™Ôºö`main.js`„ÄÅ`src_userService1_js.main.js` Âíå `src_userService2_js.main.js`„ÄÇ‰ªîÁªÜÊü•Áúã `src_userService1_js.main.js` ÁöÑÂÜÖÂÆπÔºåÊàë‰ª¨ÂèØ‰ª•ÂèëÁé∞Êï¥‰∏™ `user-library` ÈÉΩË¢´ÊâìÂåÖ‰∫ÜÔºö

```js
(self["webpackChunkuser_app"] = self["webpackChunkuser_app"] || []).push([
  ["src_userService1_js"],
  {
    /***/ "./node_modules/user-library/dist/index.js":
      /*!*************************************************!*\
  !*** ./node_modules/user-library/dist/index.js ***!
  \*************************************************/
      /***/ (
        __unused_webpack_module,
        __webpack_exports__,
        __webpack_require__
      ) => {
        "use strict";
        /* harmony export */ __webpack_require__.d(__webpack_exports__, {
          /* harmony export */ userAccount: () => /* binding */ userAccount,
          /* harmony export */ userPhoneNumber: () =>
            /* binding */ userPhoneNumber,
          /* harmony export */
        });
        /* unused harmony export getUserName */
        const userAccount = {
          name: "user account",
        };

        const userPhoneNumber = {
          number: "***********",
        };

        const getUserName = () => "John Doe";

        /***/
      },

    /***/ "./src/userService1.js":
      /*!*****************************!*\
  !*** ./src/userService1.js ***!
  \*****************************/
      /***/ (
        __unused_webpack_module,
        __webpack_exports__,
        __webpack_require__
      ) => {
        "use strict";
        __webpack_require__.r(__webpack_exports__);
        /* harmony export */ __webpack_require__.d(__webpack_exports__, {
          /* harmony export */ logUserAccount: () =>
            /* binding */ logUserAccount,
          /* harmony export */
        });
        /* harmony import */ var user_library__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(
          /*! user-library */ "./node_modules/user-library/dist/index.js"
        );

        const logUserAccount = () => {
          console.log(user_library__WEBPACK_IMPORTED_MODULE_0__.userAccount);
        };

        /***/
      },
  },
]);
```

ËôΩÁÑ∂ `getUserName` Ë¢´Ê†áËÆ∞‰∏∫‰∫ÜÊú™ÂºïÁî®Ôºå‰ΩÜ `userAccount` Âπ∂Ê≤°ÊúâË¢´Ê†áËÆ∞ÔºåÂç≥‰Ωø `userService2` ‰ªÖ‰ªÖ‰ΩøÁî®‰∫Ü `userPhoneNumber`„ÄÇ‰∏∫‰ªÄ‰πà‰ºöËøôÊ†∑Âë¢ÔºüÔºàËØëÊ≥®ÔºöÂéüÊñá‰∏≠‰∏äÈù¢ÁöÑ‰ª£Á†ÅÊòØ `userService1` ÁöÑËÄå‰∏çÊòØ `userService2`Ôºâ

Êàë‰ª¨ÈúÄË¶ÅËÆ∞‰ΩèÔºåÂºïÁî®ÂØºÂá∫Ôºàused exportsÔºâ‰ºòÂåñÂú®Ê£ÄÊü•ÂØºÂá∫È°πÊòØÂê¶Ë¢´ÂºïÁî®ÁöÑÊó∂ÂÄôÔºåÊòØÂú®Ê®°ÂùóÂ±ÇÈù¢‰∏äÊ£ÄÊü•ÁöÑ„ÄÇÂè™Êúâ‰ªéËøô‰∏™Â±ÇÈù¢‰∏ä Webpack ÊâçËÉΩÁßªÈô§ÈÇ£‰∫õÊú™Ë¢´‰ΩøÁî®ÁöÑ‰ª£Á†Å„ÄÇÂØπ‰∫éÊàë‰ª¨ÁöÑÂ∫ìÊ®°ÂùóÊù•ËØ¥Ôºå`userAccount` Âíå `userPhoneNumber` ÂÖ∂ÂÆûÈÉΩË¢´‰ΩøÁî®‰∫Ü„ÄÇÂú®Ëøô‰∏™ÊÉÖÂÜµ‰∏ãÔºåWebpack Âπ∂‰∏çËÉΩÂå∫ÂàÜÊ∏Ö `userService1` Âíå `userService2` Âú®ÂØºÂÖ•È°π‰∏äÁöÑÂå∫Âà´ÔºåÊ≠£Â¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºà‰Ω†‰ºöÂèëÁé∞ `userAccount` Âíå `userPhoneNumber` ÈÉΩË¢´Ê†áÊ≥®‰∏∫ÁªøËâ≤ÔºâÔºö

![‰ª£Á†ÅÂàÜÂâ≤ÂØºËá¥ÊëáÊ†ë‰ºòÂåñÂá∫Áé∞ÁöÑÈóÆÈ¢ò](https://raw.githubusercontent.com/darkyzhou/blog/master/static/images/uploads/tree-shaking-6.svg)

**ËøôÊÑèÂë≥ÁùÄ [Webpack](https://webpack.js.org/) Âú®‰ªÖ‰æùÈù†ÂºïÁî®ÂØºÂá∫‰ºòÂåñÁöÑÊù°‰ª∂‰∏ãÔºåÂπ∂‰∏çËÉΩÁã¨Á´ãÂú∞ÈíàÂØπÊØè‰∏™ chunk ËøõË°åÊëáÊ†ë‰ºòÂåñ„ÄÇ**

Áé∞Âú®ÔºåËÆ©Êàë‰ª¨Âú®ÊâìÂåÖÂ∫ìÊó∂‰øùÁïôÊ®°ÂùóÁªìÊûÑÔºåËøôÊ†∑ÂâØ‰ΩúÁî®‰ºòÂåñÂ∞±ËÉΩÂ∑•‰ΩúÔºö

[Webpack](https://webpack.js.org/) ‰ªçÁÑ∂ËæìÂá∫‰∫Ü 3 ‰∏™Êñá‰ª∂Ôºå‰∏çËøáËøô‰∏ÄÊ¨° `src_userService2_js.main.js` ‰ªÖ‰ªÖÂåÖÂê´‰∫Ü `userPhoneNumber` ÈáåÁöÑ‰ª£Á†ÅÔºö

```js
(self["webpackChunkuser_app"] = self["webpackChunkuser_app"] || []).push([
  ["src_userService2_js"],
  {
    /***/ "./node_modules/user-library/dist/userPhoneNumber.js":
      /*!***********************************************************!*\
  !*** ./node_modules/user-library/dist/userPhoneNumber.js ***!
  \***********************************************************/
      /***/ (
        __unused_webpack_module,
        __webpack_exports__,
        __webpack_require__
      ) => {
        "use strict";
        /* harmony export */ __webpack_require__.d(__webpack_exports__, {
          /* harmony export */ userPhoneNumber: () =>
            /* binding */ userPhoneNumber,
          /* harmony export */
        });
        const userPhoneNumber = {
          number: "***********",
        };

        /***/
      },

    /***/ "./src/userService2.js":
      /*!*****************************!*\
  !*** ./src/userService2.js ***!
  \*****************************/
      /***/ (
        __unused_webpack_module,
        __webpack_exports__,
        __webpack_require__
      ) => {
        "use strict";
        __webpack_require__.r(__webpack_exports__);
        /* harmony export */ __webpack_require__.d(__webpack_exports__, {
          /* harmony export */ logUserPhoneNumber: () =>
            /* binding */ logUserPhoneNumber,
          /* harmony export */
        });
        /* harmony import */ var user_library__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(
          /*! user-library */ "./node_modules/user-library/dist/userPhoneNumber.js"
        );

        const logUserPhoneNumber = () => {
          console.log(
            user_library__WEBPACK_IMPORTED_MODULE_0__.userPhoneNumber
          );
        };

        /***/
      },
  },
]);
```

`src_userService1_js.main.js` ‰πüÂíå‰∏äÈù¢Á±ª‰ººÔºå‰ªÖ‰ªÖÂåÖÂê´‰∫ÜÊàë‰ª¨Â∫ìÈáåÁöÑ `userAccount` Ê®°Âùó„ÄÇ

![‰øùÁïôÊ®°ÂùóÊ†ëÂèØ‰ª•ËÆ© Webpack Áã¨Á´ãÂú∞ÂØπÂàÜÂâ≤ÁöÑ chunk ËøõË°åÊëáÊ†ë‰ºòÂåñ](https://raw.githubusercontent.com/darkyzhou/blog/master/static/images/uploads/tree-shaking-7.svg)

Âú®‰∏äÂõæ‰∏≠Êàë‰ª¨ÁúãÂà∞Ôºå`userAccount` Âíå `userPhoneNumber` ‰ªçÁÑ∂Ë¢´ËØÜÂà´‰∏∫**Ë¢´ÂºïÁî®ÁöÑÂØºÂá∫È°π**ÔºåÊØïÁ´üÂÆÉ‰ª¨ÈÉΩÂú®Â∫îÁî®ÈáåË¢´ÂºïÁî®‰∫ÜËá≥Â∞ë‰∏ÄÊ¨°„ÄÇ‰∏çËøáÔºåËøô‰∏ÄÊ¨°ÂâØ‰ΩúÁî®‰ºòÂåñËÆ© Webpack Âæó‰ª•Áï•Ëøá `userAccount` Ê®°ÂùóÔºåÂõ†‰∏∫ÂÆÉ‰ªéÊú™Ë¢´ `userService2` ÊâÄÂØºÂÖ•„ÄÇÂêåÊ†∑ÁöÑ‰∫ãÊÉÖ‰πüÂèëÁîüÂú®‰∫Ü `userPhoneNumber` Âíå `userService1` ‰πãÈó¥„ÄÇ

Êàë‰ª¨Áé∞Âú®ÁêÜËß£‰∫ÜÔºö‰øùÁïôÂ∫ì‰∏≠ÂéüÂßãÁöÑÊ®°ÂùóÁªìÊûÑÊòØÂæàÈáçË¶ÅÁöÑ„ÄÇ‰∏çËøáÔºåÂ¶ÇÊûúÂéüÂßãÊ®°ÂùóÁªìÊûÑÈáåÂè™Êúâ‰∏Ä‰∏™Ê®°ÂùóÔºåÊØîÂ¶Ç `index.js` Êñá‰ª∂ÔºåÂπ∂‰∏îÂÖ∂‰∏≠ÂåÖÂê´ÁùÄÊâÄÊúâÁöÑ‰ª£Á†ÅÁöÑËØùÔºåÈÇ£‰πà‰øùÁïôËøôÁßçÊ®°ÂùóÁªìÊûÑÊòØÊØ´Êó†Áî®Â§ÑÁöÑ„ÄÇ**Ë¶ÅÊâìÈÄ†‰∏Ä‰∏™ÂØπÊëáÊ†ë‰ºòÂåñÊúâÁùÄËâØÂ•ΩÈÄÇÈÖçÁöÑÂ∫ìÔºåÊàë‰ª¨ÂøÖÈ°ªÂ∞ÜÂ∫ìÁöÑ‰ª£Á†ÅÂàíÂàÜÂà∞Ëã•Âπ≤‰∏™Â∞èÁöÑÊ®°Âùó‰∏≠ÔºåÂêåÊó∂ÊØè‰∏™Ê®°ÂùóË¥üË¥£Êàë‰ª¨‰ª£Á†ÅÈÄªËæëÁöÑ‰∏ÄÈÉ®ÂàÜ„ÄÇ**

Â¶ÇÊûúË¶Å‰ΩøÁî®‚ÄúÊ†ë‚ÄùÁöÑÊØîÂñªÔºåÊàë‰ª¨ÈúÄË¶ÅÂ∞ÜÊ†ë‰∏äÊØèÁâáÂè∂Â≠êËßÜ‰∏∫‰∏Ä‰∏™Ê®°Âùó„ÄÇÊõ¥Â∞è„ÄÅÊõ¥Âº±ÁöÑÂè∂Â≠êÂú®Ê†ëË¢´ÊëáÂä®ÁöÑÊó∂ÂÄôÊõ¥ÂÆπÊòìÊéâËêΩÔºÅÂ¶ÇÊûúÊ†ë‰∏äÁöÑÂè∂Â≠êÊõ¥Â∞ë„ÄÅÊõ¥Âº∫ÔºåÈÇ£‰πàÊëáÊ†ëÁöÑÁªìÊûúÂèØËÉΩÂ∞±‰∏ç‰∏ÄÊ†∑‰∫Ü„ÄÇ

Êú¨ÈÉ®ÂàÜÁöÑÊÄªÁªìÂ¶Ç‰∏ãÔºö

* ‰∏∫‰∫ÜËÉΩÂ§üÂÖÖÂàÜÂà©Áî®ÂâØ‰ΩúÁî®‰ºòÂåñÔºå**Êàë‰ª¨Â∫îËØ•‰øùÁïôÂ∫ìÁöÑÊ®°ÂùóÁªìÊûÑ**„ÄÇ
* **Â∫ìÂ∫îËØ•Ë¢´ÂàíÂàÜ‰∏∫Â§ö‰∏™Â∞èÁöÑÊ®°Âùó**ÔºåÊØè‰∏™Ê®°Âùó‰ªÖÂØºÂá∫Êï¥‰∏™Â∫ìÁöÑ‰ª£Á†ÅÈÄªËæëÁöÑ‰∏ÄÂ∞èÈÉ®ÂàÜ„ÄÇ
* Âè™ÊúâÂú®ÂâØ‰ΩúÁî®‰ºòÂåñÁöÑÂ∏ÆÂä©‰∏ãÔºåÊàë‰ª¨Âú®Â∫îÁî®ÈáåÊâçËÉΩÂØπÂºïÁî®ÁöÑÂ∫ìËøõË°åÊëáÊ†ë‰ºòÂåñ„ÄÇ

## Âú®ËΩ¨ËØëÂ∫ì‰ª£Á†ÅÊó∂‰∏çË¶Å‰∏¢Â§±Ê®°ÂùóÊ†ë‰ª•Âèä ES Ê®°ÂùóÁöÑÁâπÂæÅ

**ÊâìÂåÖÂ∑•ÂÖ∑Âπ∂‰∏çÊòØÂîØ‰∏ÄËÉΩÂ§üÂΩ±Âìç‰Ω†ÁöÑÂ∫ìË¢´ÊëáÊ†ë‰ºòÂåñÁöÑ‰∏úË•ø„ÄÇ**ËΩ¨ËØëÂ∑•ÂÖ∑‰πü‰ºöÂØπÊëáÊ†ë‰ºòÂåñÈÄ†ÊàêË¥üÈù¢ÂΩ±ÂìçÔºåÂõ†‰∏∫ÂÆÉ‰ª¨‰ºöÁßªÈô§ ES Ê®°ÂùóÔºåÊàñËÄÖ‰∏¢Â§±Ê®°ÂùóÊ†ë„ÄÇ

ËΩ¨ËØëÂ∑•ÂÖ∑ÁöÑÁõÆÁöÑ‰πã‰∏ÄÊòØËÆ©‰Ω†ÁöÑ‰ª£Á†ÅËÉΩÂ§üÂú®ÈÇ£‰∫õ‰∏çÊîØÊåÅ ES Ê®°ÂùóÁöÑÊµèËßàÂô®‰∏≠Â∑•‰Ωú„ÄÇ‰∏çËøáÔºåÊàë‰ª¨‰πüÈúÄË¶ÅËÆ∞‰ΩèÔºö**Êàë‰ª¨ÁöÑÂ∫ìÂπ∂‰∏çÊÄª‰ºöÁõ¥Êé•Âú∞Ë¢´ÊµèËßàÂô®ÊâÄÂä†ËΩΩ**ÔºåËÄåÊòØ‰ºöË¢´Â∫îÁî®ÊâÄÂØºÂÖ•„ÄÇÊâÄ‰ª•ÔºåÈâ¥‰∫é‰ª•‰∏ã‰∏§Êù°ÁêÜÁî±ÔºåÊàë‰ª¨‰∏çËÉΩÈíàÂØπÁâπÂÆöÊµèËßàÂô®Êù•ËΩ¨ËØëÊàë‰ª¨ÁöÑÂ∫ì‰ª£Á†ÅÔºö

* Âú®ÁºñÂÜôÂ∫ì‰ª£Á†ÅÁöÑÊó∂ÂÄôÔºåÊàë‰ª¨Âπ∂‰∏çÁü•ÈÅìÊàë‰ª¨ÁöÑÂ∫ì‰ºöË¢´Áî®Âà∞Âì™‰∫õÊµèËßàÂô®ÈáåÔºåÂè™Êúâ‰ΩøÁî®Â∫ìÁöÑÂ∫îÁî®ÊâçÁü•ÈÅì„ÄÇ
* ËΩ¨ËØëÊàë‰ª¨ÁöÑÂ∫ì‰ª£Á†Å‰ºöËÆ©ÂÆÉ‰ª¨ÂèòÂæó‰∏çÂèØË¢´ÊëáÊ†ë‰ºòÂåñ„ÄÇ

Â¶ÇÊûú‰Ω†ÁöÑÂ∫ìÁî±‰∫éÊüê‰∫õÂéüÂõ†Á°ÆÂÆûÈúÄË¶ÅË¢´ËΩ¨ËØëÔºåÈÇ£‰πà‰Ω†ÈúÄË¶Å‰øùËØÅËΩ¨ËØëÂ∑•ÂÖ∑‰∏ç‰ºöÁßªÈô§ ES Ê®°ÂùóÁöÑËØ≠Ê≥ïÔºå‰ª•Âèä‰∏ç‰ºöÁßªÈô§ÂéüÊú¨ÁöÑÊ®°ÂùóÁªìÊûÑÔºåÂéüÂõ†Ê≠£Â¶ÇÂâçÊñáÊâÄËø∞„ÄÇ

ÊçÆÊàëÊâÄÁü•ÔºåÊúâ‰∏§‰∏™ËΩ¨ËØëÂ∑•ÂÖ∑‰ºöÁßªÈô§Êéâ‰∏äËø∞ÁöÑ‰∏§‰∏™ÂÜÖÂÆπ„ÄÇ

#### Babel

Babel ËÉΩÂ§ü‰ΩøÁî® [Babel preset-env](https://babeljs.io/docs/en/babel-preset-env) Êù•ËÆ©‰Ω†ÁöÑ‰ª£Á†ÅÂÖºÂÆπÊåáÂÆöÁöÑÁõÆÊ†áÊµèËßàÂô®Ôºàtarget browsersÔºâ„ÄÇËøô‰∏™Êèí‰ª∂ÈªòËÆ§‰ºöÂ∞ÜÂ∫ì‰ª£Á†ÅÈáåÁöÑ ES Ê®°ÂùóÁßªÈô§„ÄÇ‰∏∫‰∫ÜÈÅøÂÖçÂÆÉÁöÑÂèëÁîüÔºåÊàë‰ª¨ÈúÄË¶ÅÊää [`modules` ÈÄâÈ°π](https://babeljs.io/docs/en/babel-preset-env#modules)ËÆæ‰∏∫ `false`Ôºö

```js
module.exports = {
  env: {
    esm: {
      presets: [
        [
          "@babel/preset-env",
          {
            modules: false,
          },
        ],
      ],
    },
  },
};
```

#### TypeScript

Âú®ÁºñËØë‰Ω†ÁöÑ‰ª£Á†ÅÊó∂ÔºåTypeScript ‰ºöÊ†πÊçÆ `tsconfig.json` Êñá‰ª∂ÈáåÁöÑ `target` Âíå `module` ÈÄâÈ°πÊù•ËΩ¨Êç¢‰Ω†ÁöÑÊ®°Âùó„ÄÇ

‰∏∫‰∫ÜÈÅøÂÖçÂÆÉÁöÑÂèëÁîüÔºåÊàë‰ª¨Ë¶Å[Â∞Ü `target` Âíå `module` ÈÄâÈ°πËÆæÁΩÆÂà∞Ëá≥Â∞ë `ES2015` Êàñ `ES6`](https://www.typescriptlang.org/tsconfig#module)„ÄÇ

**Ê≠§ÈÉ®ÂàÜÁöÑÊÄªÁªìÂ¶Ç‰∏ãÔºö**

* **Á°Æ‰øù‰Ω†ÁöÑËΩ¨ËØëÂ∑•ÂÖ∑ÂíåÁºñËØëÂô®‰∏ç‰ºöÂ∞ÜÂ∫ì‰ª£Á†ÅÈáåÁöÑ ES Ê®°ÂùóËØ≠Ê≥ïÁßªÈô§„ÄÇ**
* Â¶ÇÊûúÈúÄË¶ÅÊ£ÄÊü•‰∏äËø∞ÈóÆÈ¢òÊòØÂê¶Â≠òÂú®ÔºåÂèØ‰ª•Êü•ÁúãÂ∫ìÁöÑËΩ¨ËØë/ÁºñËØë‰∫ßÁâ©ÈáåÊúâÊ≤°Êúâ ES Ê®°ÂùóÁöÑÂØºÂÖ•ËØ≠Ê≥ï„ÄÇ

## ‰ΩøÁî®ÊúÄÊñ∞ÁâàÁöÑÂèØËøõË°åÊëáÊ†ë‰ºòÂåñÁöÑÊâìÂåÖÂ∑•ÂÖ∑

JavaScript ÁöÑÊëáÊ†ë‰ºòÂåñÂú® [Rollup](https://rollupjs.org/guide/en/) ÁöÑÂ∏¶Âä®‰∏ãÊµÅË°å‰∫ÜËµ∑Êù•„ÄÇ[Webpack Ëá™‰ªé v2 ‰ª•Êù•Â∞±ÊîØÊåÅ‰∫ÜÊëáÊ†ë‰ºòÂåñ„ÄÇ](https://webpack.js.org/guides/tree-shaking/)ÂêÑÊâìÂåÖÂ∑•ÂÖ∑ÈÉΩÂú®ÊëáÊ†ë‰ºòÂåñ‰∏äÂÅöÂæóË∂äÊù•Ë∂äÂ•Ω„ÄÇ

ËøòËÆ∞ÂæóÊàë‰ª¨Âú®‰∏äÊñáËÆ≤Âà∞ÁöÑ `innerGraph` ‰ºòÂåñÂêóÔºüÂÆÉËÉΩÂ§üËÆ© Webpack Â∞ÜÊ®°ÂùóÁöÑÂØºÂá∫È°πÂíåÂÖ∂‰ªñÊ®°ÂùóÁöÑÂØºÂÖ•È°πÂÖ≥ËÅîËµ∑Êù•„ÄÇËøôÈ°π‰ºòÂåñÊòØÂú® Webpack 5 ‰∏≠Ë¢´ÂºïÂÖ•ÁöÑ„ÄÇÊàë‰ª¨Âú®Êú¨ÊñáÈáåËôΩÁÑ∂‰∏ÄÁõ¥Âú®‰ΩøÁî® Webpack 5Ôºå‰∏çËøáËøòÊòØÊúâÂøÖË¶ÅËÆ§ËØÜÂà∞ËøôÈ°π‰ºòÂåñÊîπÂèò‰∫ÜÊï¥‰∏™‰∏öÁïå„ÄÇÂÆÉËÉΩÂ§üËÆ© Webpack ÈÄíÂΩíÂú∞ÂØªÊâæÊú™Ë¢´‰ΩøÁî®ÁöÑÂØºÂá∫È°πÔºÅ

‰∏∫‰∫ÜÂ±ïÁ§∫ÂÆÉÂà∞Â∫ïÊòØÊÄé‰πàÂÅöÁöÑÔºåËÄÉËôë `user-library` ‰∏≠ÁöÑ `index.js` Êñá‰ª∂Ôºö

```js
import { userAccount } from "./userAccount";

const getUserAccount = () => {
  return userAccount;
};

const getUserName = () => "John Doe";

export { getUserName, getUserAccount };
```

Êàë‰ª¨ÁöÑ `user-app` ‰ªÖ‰ΩøÁî®‰∫ÜÂÖ∂‰∏≠ÁöÑ `getUserName`Ôºö

```js
import { getUserName } from "user-library";

console.log(getUserName());
```

Áé∞Âú®ÔºåÊàë‰ª¨ÂØπÊØî‰∏Ä‰∏ãÂú®ÊúâÂíåÊ≤°Êúâ `innerGraph` ‰ºòÂåñÁöÑÊÉÖÂÜµ‰∏ãÔºåÊâìÂåÖËæìÂá∫Êúâ‰ªÄ‰πà‰∏çÂêå„ÄÇÊ≥®ÊÑèÔºåËøôÈáå `usedExports` Âíå `sideEffects` ‰ºòÂåñÈÉΩÊòØÂºÄÂêØÁöÑ„ÄÇ

Ê≤°Êúâ `innerGraph` ‰ºòÂåñÔºàÊØîÂ¶Ç‰ΩøÁî® Webpack 4ÔºâÔºö

```js
/*!*************************************************!*\
  !*** ./node_modules/user-library/dist/index.js ***!
  \*************************************************/
/*! exports provided: userAccount, userPhoneNumber, getUserName, getUserAccount */
/*! exports used: getUserName */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return getUserName; });
/* unused harmony export getUserAccount */
/* harmony import */ var _userAccount_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./userAccount.js */ "./node_modules/user-library/dist/userAccount.js");

const getUserAccount = () => {
  return _userAccount_js__WEBPACK_IMPORTED_MODULE_0__[/* userAccount */ "a"]
};

const getUserName = () => 'John Doe';

/***/ }),

/***/ "./node_modules/user-library/dist/userAccount.js":
/*!*******************************************************!*\
  !*** ./node_modules/user-library/dist/userAccount.js ***!
  \*******************************************************/
/*! exports provided: userAccount */
/*! exports used: userAccount */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return userAccount; });
const userAccount = {
  name: 'user account'
};

/***/ }),
```

Êúâ `innerGraph` ‰ºòÂåñÔºàÊØîÂ¶Ç‰ΩøÁî® Webpack 5ÔºâÔºö

```js
/***/ "./node_modules/user-library/dist/index.js":
/*!*************************************************!*\
  !*** ./node_modules/user-library/dist/index.js ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "getUserName": () => (/* binding */ getUserName)
/* harmony export */ });
/* unused harmony export getUserAccount */

const getUserAccount = () => {
  return userAccount
};

const getUserName = () => 'John Doe';

/***/ })
```

![WebpackÁöÑ innerGraph ‰ºòÂåñÁ§∫‰æã](https://raw.githubusercontent.com/darkyzhou/blog/master/static/images/uploads/tree-shaking-8.svg)

Webpack 5 ËÉΩÂ§üÂÆåÂÖ®ÁßªÈô§ `userAccount` Ê®°ÂùóÔºå‰ΩÜÊòØ Webpack 4 ‰∏çË°åÔºåÂç≥‰Ωø `getUserAccount` Ë¢´Ê†áËÆ∞‰∏∫‰∫ÜÊú™ÂºïÁî®„ÄÇËøôÊòØÂõ†‰∏∫ `inngerGraph` ‰ºòÂåñÁöÑÁÆóÊ≥ïËÉΩÂ§üËÆ© Webpack 5 Â∞ÜÊ®°Âùó‰∏≠Êú™ÂºïÁî®ÁöÑÂØºÂá∫È°πÂíåÂÆÉÂØπÂ∫îÁöÑÂØºÂÖ•È°πÈìæÊé•Ëµ∑Êù•„ÄÇÂú®Êàë‰ª¨ÁöÑ‰æãÂ≠êÈáåÔºå`userAccount` Ê®°Âùó‰ªÖË¢´ `getUserAccount` ÂáΩÊï∞ÊâÄ‰ΩøÁî®ÔºåÂõ†Ê≠§ÂèØ‰ª•Ë¢´Áõ¥Êé•Áï•Ëøá„ÄÇ

Webpack 4 ÂàôÊ≤°ÊúâËøôÈ°π‰ºòÂåñ„ÄÇ**ÂºÄÂèëËÄÖÂú®‰ΩøÁî®Ëøô‰∏™ÁâàÊú¨ÁöÑ Webpack ÁöÑÊó∂ÂÄôÂõ†Ê≠§Â∫îËØ•ÊèêÈ´òË≠¶ÊÉïÔºåÈôêÂà∂Âçï‰∏™Ê∫êÊñá‰ª∂ÈáåÁöÑÂØºÂá∫È°πÊï∞Èáè„ÄÇ** Â¶ÇÊûú‰∏Ä‰∏™Ê∫êÊñá‰ª∂ÂåÖÂê´Â§ö‰∏™ÂØºÂá∫È°πÔºåWebpack ‰ºöÂåÖÂê´ÊâÄÊúâÂØπÂ∫îÁöÑÂØºÂÖ•È°πÔºåÂç≥‰ΩøÂØπ‰∫éÁúüÊ≠£Ë¢´ÈúÄË¶ÅÁöÑÂØºÂá∫È°πÊù•ËØ¥Êúâ‰∫õÂØºÂÖ•È°πÊòØÂ§ö‰ΩôÁöÑ„ÄÇ

ÊÄªÁöÑÊù•ËØ¥ÔºåÊàë‰ª¨Â∫îËØ•Á°Æ‰øùÊÄªÊòØ‰ΩøÁî®ÊúÄÊñ∞ÁâàÁöÑÊâìÂåÖÂ∑•ÂÖ∑ÔºåËøôÊ†∑Êàë‰ª¨Â∞±ËÉΩ‰ªéÊúÄÊñ∞ÁöÑÊëáÊ†ë‰ºòÂåñ‰∏≠Ëé∑Áõä„ÄÇ

## ÊÄªÁªì

ÂØπ‰∏Ä‰∏™Â∫ìËøõË°åÁöÑÊëáÊ†ë‰ºòÂåñÔºåÂπ∂‰∏çÊòØÂú®ÈÖçÁΩÆÊñá‰ª∂ÈáåÈöè‰æøÂä†‰∏ÄË°åÊù•ÂêØÁî®Â∞±ËÉΩËé∑ÂæóÂæàÂ•ΩÁöÑÊïàÊûú„ÄÇÂÆÉÁöÑ‰ºòÂåñË¥®ÈáèÂèñÂÜ≥‰∫éÂ§ö‰∏™Âõ†Á¥†ÔºåÊú¨Êñá‰ªÖ‰ªÖÂàóÂá∫‰∫ÜÂÖ∂‰∏≠ÁöÑ‰∏ÄÂ∞èÈÉ®ÂàÜ„ÄÇ‰∏çËøáÔºåÊó†ËÆ∫Êàë‰ª¨ÈÅáÂà∞ÁöÑÈóÆÈ¢òÊòØ‰ªÄ‰πàÔºåÊú¨ÊñáÈáåÂÅöËøáÁöÑ‰ª•‰∏ã‰∏§‰ª∂‰∫ãÊÉÖÊòØÂØπ‰ªª‰ΩïÊÉ≥Ë¶ÅÂØπÂ∫ìËøõË°åÊëáÊ†ë‰ºòÂåñÁöÑ‰∫∫ÂæàÈáçË¶ÅÁöÑÔºö

* **‰∏∫‰∫ÜÁ°ÆÂÆöÊàë‰ª¨Â∫ìÁöÑÊëáÊ†ë‰ºòÂåñÊïàÊûúÁ®ãÂ∫¶ÔºåÊàë‰ª¨ÈúÄË¶ÅÂú®‰∏Ä‰∏™ÂèóÊéßÁöÑÁéØÂ¢É‰∏ã‰ΩøÁî®Êàë‰ª¨‰∫ÜËß£ÁöÑÊâìÂåÖÂ∑•ÂÖ∑Êù•ËøõË°åÊµãËØï„ÄÇ**
* **‰∏∫‰∫ÜÊ£ÄÊü•Êàë‰ª¨Â∫ìÁöÑÈÖçÁΩÆÊúâÊ≤°ÊúâÈóÆÈ¢òÔºåÊàë‰ª¨‰∏ç‰ªÖ‰ªÖÊòØÈúÄË¶ÅÊ£ÄÊü•ÂêÑÁßçÈÖçÁΩÆÊñá‰ª∂ÔºåËøòË¶ÅÊ£ÄÊü•ÊâìÂåÖËæìÂá∫„ÄÇ** Êàë‰ª¨Âú®Êú¨ÊñáÈáå‰∏ÄÁõ¥ÈÉΩÂú®ÂØπ `user-library` Âíå `user-app` ÁöÑ‰æãÂ≠êÂÅöËøôÁßç‰∫ãÊÉÖ„ÄÇ

ÊàëÁúüÂàáÂú∞Â∏åÊúõÊú¨ÊñáËÉΩÂ§ü‰∏∫‰Ω†Êèê‰æõÂ∏ÆÂä©ÔºåËÆ©‰Ω†Ê≠£Âú®ËøõË°åÁöÑÊûÑÂª∫Êã•‰ºòÂåñÁ®ãÂ∫¶ÊúÄÈ´òÁöÑÂ∫ìÁöÑ‰ªªÂä°ÂèòÂæóÂèØËÉΩÔºÅ

### Âª∂Áî≥ÈòÖËØª

* [Tree-shaking versus dead code elimination](https://medium.com/@Rich_Harris/tree-shaking-versus-dead-code-elimination-d3765df85c80)
* [Webpack 5 release](https://webpack.js.org/blog/2020-10-10-webpack-5-release/)
* [Tree shaking in JavaScript](https://ageek.dev/tree-shaking)

> * ÂéüÊñáÂú∞ÂùÄÔºö[How To Make Tree Shakeable Libraries](https://blog.theodo.com/2021/04/library-tree-shaking/)
> * ÂéüÊñá‰ΩúËÄÖÔºö[Fran√ßois Hendriks](https://blog.theodo.com/fran%C3%A7ois-hendriks)
> * ËØëÊñáÂá∫Ëá™Ôºö[ÊéòÈáëÁøªËØëËÆ°Âàí](https://github.com/xitu/gold-miner)
> * Êú¨ÊñáÊ∞∏‰πÖÈìæÊé•Ôºö[https://github.com/xitu/gold-miner/blob/master/article/2021/library-tree-shaking.md](https://github.com/xitu/gold-miner/blob/master/article/2021/library-tree-shaking.md)
> * ËØëËÄÖÔºö[darkyzhou](https://github.com/darkyzhou)
> * Ê†°ÂØπËÄÖÔºö[Usualminds](https://github.com/Usualminds)„ÄÅ[Kim Yang](https://github.com/KimYangOfCat)