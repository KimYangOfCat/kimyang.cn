---
title: "å¦‚ä½•æ‰“é€ å¯è¢«æ‘‡æ ‘ä¼˜åŒ–çš„åº“"
date: 2021-06-25
tags: [webpack]
categories: [ğŸŒ ç¿»è¯‘æ ¡å¯¹]
---

![å¦‚ä½•æ‰“é€ å¯è¢«æ‘‡æ ‘ä¼˜åŒ–çš„åº“](https://picbed.kimyang.cn/202109050832928.png)

åœ¨ [Theodo](https://www.theodo.fr)ï¼Œæˆ‘ä»¬è‡´åŠ›äºä¸ºæˆ‘ä»¬çš„å®¢æˆ·æ‰“é€ å¯é ã€å¿«é€Ÿçš„åº”ç”¨ã€‚æˆ‘ä»¬æœ‰ä¸€äº›æ”¹è¿›ç°æœ‰åº”ç”¨çš„æ€§èƒ½çš„é¡¹ç›®ã€‚åœ¨å…¶ä¸­ä¸€ä¸ªé¡¹ç›®é‡Œï¼Œ**æˆ‘ä»¬é€šè¿‡å¯¹å†…éƒ¨åº“è¿›è¡Œæ‘‡æ ‘ä¼˜åŒ–ï¼ˆtree shakingï¼‰ï¼ŒæˆåŠŸå°†æ‰€æœ‰é¡µé¢çš„ gzip å‹ç¼©åçš„ bundle ä½“ç§¯å‡å°‘äº†è¶³è¶³ 500KBã€‚**

<!-- more -->

åœ¨åšè¿™ä»¶äº‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ„è¯†åˆ°æ‘‡æ ‘ä¼˜åŒ–å¹¶ä¸æ˜¯ä¸€ç§ç®€å•åœ°å¼€å¯æˆ–å…³é—­å°±ä¼šå¥æ•ˆçš„æŠ€æœ¯ã€‚æœ‰å¾ˆå¤šå› ç´ ä¼šå½±å“ä¸€ä¸ªåº“çš„æ‘‡æ ‘ä¼˜åŒ–æ•ˆæœã€‚

**æœ¬æ–‡çš„ç›®æ ‡æ˜¯ä¸ºæ„å»ºé€‚é…æ‘‡æ ‘ä¼˜åŒ–çš„åº“æä¾›è¯¦ç»†çš„æŒ‡å¯¼ã€‚å…¶ä¸­çš„æ­¥éª¤çš„æ€»ç»“å¦‚ä¸‹ï¼š**

- åœ¨ä¸€ä¸ªå—æ§çš„ç¯å¢ƒä¸‹ï¼Œé’ˆå¯¹ä¸€ä¸ªå·²çŸ¥çš„åº”ç”¨æ¥æ£€æŸ¥æˆ‘ä»¬çš„åº“æ˜¯å¦å¯ä»¥è¢«æ‘‡æ ‘ä¼˜åŒ–ã€‚
- ä½¿ç”¨ ES6 æ¨¡å—è®©æ‰“åŒ…å·¥å…·ï¼ˆbundlerï¼‰å¾—ä»¥æ£€æµ‹åˆ°æœªå¼•ç”¨çš„ `export` è¯­å¥ã€‚
- ä½¿ç”¨å‰¯ä½œç”¨ï¼ˆside effectsï¼‰ä¼˜åŒ–ï¼Œè®©ä½ çš„åº“ä¸åŒ…å«ä»»ä½•å‰¯ä½œç”¨ã€‚
- å°†åº“çš„ä»£ç é€»è¾‘åˆ†å‰²åˆ°è‹¥å¹²ä¸ªå°çš„æ¨¡å—ä¸­ï¼ŒåŒæ—¶ä¿ç•™åº“çš„æ¨¡å—æ ‘ï¼ˆmodule treeï¼‰ã€‚
- åœ¨è½¬è¯‘ï¼ˆtranspileï¼‰åº“æ—¶ï¼Œä¸è¦ä¸¢å¤±æ¨¡å—æ ‘æˆ–è€… ES æ¨¡å—ç‰¹å¾ï¼ˆES modules characteristicsï¼‰ã€‚
- ä½¿ç”¨æœ€æ–°ç‰ˆçš„èƒ½å¤Ÿæ”¯æŒæ‘‡æ ‘ä¼˜åŒ–çš„æ‰“åŒ…å·¥å…·ã€‚

## ä»€ä¹ˆæ˜¯æ‘‡æ ‘ä¼˜åŒ–ï¼Ÿä¸ºä»€ä¹ˆå®ƒå¾ˆé‡è¦ï¼Ÿ

å¼•ç”¨ [MDN æ–‡æ¡£](https://developer.mozilla.org/en-US/docs/Glossary/Tree_shaking)ï¼š

> Tree shaking æ˜¯ä¸€ä¸ªé€šå¸¸ç”¨äºæè¿°ç§»é™¤ JavaScript ä¸Šä¸‹æ–‡ä¸­çš„æœªå¼•ç”¨ä»£ç ï¼ˆdead codeï¼‰è¡Œä¸ºçš„æœ¯è¯­ã€‚
>
> å®ƒä¾èµ–äº ES2015 ä¸­çš„ `import` å’Œ `export` è¯­å¥ï¼Œç”¨æ¥æ£€æµ‹ä»£ç æ¨¡å—æ˜¯å¦è¢«å¯¼å‡ºã€å¯¼å…¥ï¼Œä¸”è¢« JavaScript æ–‡ä»¶ä½¿ç”¨ã€‚

æ‘‡æ ‘ä¼˜åŒ–æ˜¯ä¸€ç§å®ç°[ç§»é™¤æœªå¼•ç”¨ä»£ç ï¼ˆdead code eliminationï¼‰](https://en.wikipedia.org/wiki/Dead_code_elimination)çš„æ–¹å¼ï¼Œå®ç°çš„æ–¹å¼æ˜¯æ£€æµ‹å“ªäº›å¯¼å‡ºé¡¹ï¼ˆexportï¼‰åœ¨åº”ç”¨ä»£ç é‡Œæœªè¢«å¼•ç”¨ã€‚å®ƒä¼šè¢«ç±»ä¼¼ [Webpack](https://webpack.js.org/) å’Œ [Rollup](https://rollupjs.org/guide/en/) è¿™æ ·çš„æ‰“åŒ…å·¥å…·æ‰§è¡Œï¼Œæœ€æ—©ç”± Rollup å®ç°ã€‚

**é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆå®ƒå«æ‘‡æ ‘ä¼˜åŒ–ï¼Ÿ** æˆ‘ä»¬å¯ä»¥æŠŠåº”ç”¨çš„å¯¼å‡ºé¡¹ï¼ˆexportsï¼‰å’Œå¯¼å…¥é¡¹ï¼ˆimportsï¼‰æƒ³è±¡æˆä¸€æ£µæ ‘çš„æ ·å­ã€‚æ ‘ä¸Šå¥åº·çš„å¶å­å’Œæ ‘æè¡¨ç¤ºå¼•ç”¨äº†çš„å¯¼å…¥é¡¹ã€‚è€Œæ­»äº¡çš„å¶å­è¡¨ç¤ºæœªå¼•ç”¨çš„ä»£ç ï¼Œå®ƒä»¬å’Œæ ‘çš„å…¶ä»–éƒ¨åˆ†æ˜¯åˆ†å¼€çš„ã€‚è¿™æ—¶å€™æ‘‡åŠ¨è¿™æ£µæ ‘ï¼Œé‚£ä¹ˆæ‰€æœ‰æ­»äº¡çš„å¶å­ä¼šè¢«æ‘‡ä¸‹æ¥ï¼Œå³æœªå¼•ç”¨çš„ä»£ç ä¼šè¢«ç§»é™¤ã€‚

**ä¸ºä»€ä¹ˆæ‘‡æ ‘ä¼˜åŒ–å¾ˆé‡è¦ï¼Ÿ** å®ƒèƒ½å¤Ÿå¯¹ä½ çš„æµè§ˆå™¨åº”ç”¨äº§ç”Ÿå·¨å¤§çš„å½±å“ã€‚å¦‚æœåº”ç”¨æ‰“åŒ…äº†æ›´å¤šçš„ä»£ç ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°†èŠ±è´¹æ›´å¤šæ—¶é—´å»ä¸‹è½½ã€è§£å‹ã€è½¬æ¢å’Œæ‰§è¡Œå®ƒä»¬ã€‚**å› æ­¤ï¼Œå¯¹äºæ‰“é€ é€Ÿåº¦æœ€å¿«çš„åº”ç”¨è€Œè¨€ï¼Œç§»é™¤æœªå¼•ç”¨çš„ä»£ç è‡³å…³é‡è¦ã€‚**

ç½‘ä¸Šæœ‰å¾ˆå¤šè§£é‡Šæ‘‡æ ‘ä¼˜åŒ–å’Œæœªå¼•ç”¨ä»£ç ç§»é™¤çš„æ–‡ç« å’Œèµ„æºã€‚è¿™é‡Œæˆ‘ä»¬ä¼šé›†ä¸­è®¨è®ºé‚£äº›åº”ç”¨é‡Œä¸­å¼•ç”¨çš„åº“ã€‚å½“å¼•ç”¨ä¸€ä¸ªåº“çš„åº”ç”¨èƒ½å¤Ÿ**æˆåŠŸåœ°ç§»é™¤è¿™ä¸ªåº“ä¸­æœªè¢«å¼•ç”¨çš„éƒ¨åˆ†**æ—¶ï¼Œè¿™ä¸ªåº“æ‰èƒ½è¢«è®¤ä¸ºåšåˆ°äº†æ‘‡æ ‘ä¼˜åŒ–ï¼ˆtree shakeableï¼‰ã€‚

[![ä¸€ä¸ªå¯æ‘‡æ ‘ä¼˜åŒ–çš„åº“çš„ä¾‹å­](https://picbed.kimyang.cn/202109050832922.png)

åœ¨å°è¯•è®©ä¸€ä¸ªåº“å˜å¾—å¯è¢«æ‘‡æ ‘ä¼˜åŒ–ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å¦‚ä½•è¯†åˆ«ä¸€ä¸ªå¯æ‘‡æ ‘ä¼˜åŒ–çš„åº“ã€‚

## åœ¨å—æ§ç¯å¢ƒä¸‹è¯†åˆ«ä¸€ä¸ªä¸å¯æ‘‡æ ‘ä¼˜åŒ–çš„åº“

è¿™ä¹çœ‹ä¸Šå»å¥½åƒå¾ˆç®€å•ï¼Œä½†æ˜¯æˆ‘æ³¨æ„åˆ°å¾ˆå¤šå¼€å‘è€…éƒ½ä¼šè®¤ä¸ºä»–ä»¬çš„åº“æ˜¯å¯æ‘‡æ ‘ä¼˜åŒ–çš„ï¼Œä»…ä»…æ˜¯å› ä¸ºå®ƒä»¬ä½¿ç”¨äº† ES6 æ¨¡å—ï¼ˆåæ–‡ä¼šç»†è®²ï¼‰ï¼Œæˆ–è€…æ˜¯å› ä¸ºå®ƒä»¬æœ‰å¯¹æ‘‡æ ‘ä¼˜åŒ–å¾ˆå‹å¥½çš„é…ç½®ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™å¹¶ä¸æ„å‘³ç€ä½ çš„åº“å®é™…ä¸Šæ˜¯å¯æ‘‡æ ‘ä¼˜åŒ–çš„ï¼

äºæ˜¯ï¼Œæˆ‘ä»¬è¢«å¸¦åˆ°äº†è¿™ä¸ªé—®é¢˜ä¸Šï¼š**å¦‚ä½•é«˜æ•ˆåœ°æ£€æŸ¥ä¸€ä¸ªåº“æ˜¯å¦å¯æ‘‡æ ‘ä¼˜åŒ–ï¼Ÿ**

è¦åšåˆ°è¿™ä»¶äº‹ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£ä¸¤ä»¶äº‹æƒ…ï¼š

- **æœ€ç»ˆç§»é™¤æˆ‘ä»¬åº“ä¸­æœªå¼•ç”¨ä»£ç çš„ï¼Œæ˜¯åº”ç”¨ç¨‹åºçš„æ‰“åŒ…å·¥å…·ï¼Œè€Œä¸æ˜¯åº“è‡ªå·±çš„æ‰“åŒ…å·¥å…·**ï¼ˆå¦‚æœåº“æœ‰çš„è¯ï¼‰ã€‚æ¯•ç«Ÿï¼Œåªæœ‰åº”ç”¨ç¨‹åºè‡ªå·±çŸ¥é“ä½¿ç”¨äº†åº“çš„å“ªéƒ¨åˆ†ã€‚
- **åº“çš„èŒè´£æ˜¯ç¡®ä¿å®ƒè‡ªå·±èƒ½å¤Ÿè¢«æœ€ç»ˆçš„æ‰“åŒ…å·¥å…·è¿›è¡Œæ‘‡æ ‘ä¼˜åŒ–**ã€‚

è¦æ£€æŸ¥æˆ‘ä»¬çš„åº“æ˜¯å¦å¯æ‘‡æ ‘ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒæ”¾åœ¨ä¸€ä¸ªå—æ§çš„ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨ä¸€ä¸ªå¼•ç”¨äº†å®ƒçš„åº”ç”¨è¿›è¡Œæµ‹è¯•ï¼š

1. åˆ›å»ºä¸€ä¸ªç®€å•çš„åº”ç”¨ï¼ˆæˆ‘ä»¬ç§°å®ƒä¸ºâ€œå¼•ç”¨åº”ç”¨â€ï¼‰ï¼Œç»™å®ƒæ­é…ä¸€ä¸ªä½ ä¼šé…ç½®çš„æ‰“åŒ…å·¥å…·ï¼Œè¿™ä¸ªæ‰“åŒ…å·¥å…·éœ€è¦æ”¯æŒæ‘‡æ ‘ä¼˜åŒ–ï¼ˆæ¯”å¦‚ [Webpack](https://webpack.js.org/) æˆ–è€… [Rollup](https://rollupjs.org/guide/en/)ï¼‰ã€‚
2. å°†è¢«æ£€æŸ¥çš„åº“è®¾ç½®ä¸ºåº”ç”¨çš„ä¾èµ–ã€‚
3. ä»…ä»…å¯¼å…¥åº“çš„ä¸€ä¸ªå…ƒç´ ï¼Œæ£€æŸ¥åº”ç”¨çš„æ‰“åŒ…å·¥å…·çš„è¾“å‡ºã€‚
4. æ£€æŸ¥è¾“å‡ºä¸­æ˜¯å¦**åªåŒ…å«**è¢«å¯¼å…¥çš„å…ƒç´ åŠå…¶ä¾èµ–ã€‚

è¿™ä¸ªç­–ç•¥èƒ½å¤Ÿå°†æµ‹è¯•ä¸æˆ‘ä»¬ç°æœ‰çš„åº”ç”¨éš”ç¦»ã€‚å®ƒå¯ä»¥è®©æˆ‘ä»¬éšæ„åœ°æ‘†å¼„åº“è€Œä¸ç ´åä»»ä½•ä¸œè¥¿ã€‚å®ƒè¿˜èƒ½è®©æˆ‘ä»¬ç¡®ä¿å‡ºç°çš„é—®é¢˜ä¸æ˜¯æ¥è‡ªäºåº”ç”¨æ‰“åŒ…å·¥å…·çš„é…ç½®ä¸Šã€‚

æˆ‘ä»¬æ¥ä¸‹æ¥ä¼šå°†è¿™ç§ç­–ç•¥åº”ç”¨åˆ°ä¸€ä¸ªå«åš `user-library` çš„åº“ä¸Šï¼Œä½¿ç”¨ä¸€ä¸ªç”± [Webpack](https://webpack.js.org/) è¿›è¡Œæ‰“åŒ…çš„åº”ç”¨ `user-app` è¿›è¡Œæµ‹è¯•ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ä½ æ›´å–œæ¬¢çš„æ‰“åŒ…å·¥å…·ã€‚

`user-library` çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```js
export const getUserName = () => "John Doe";

export const getUserPhoneNumber = () => "***********";
```

å®ƒä»…ä»…æ˜¯åœ¨ `index.js` æ–‡ä»¶é‡Œå¯¼å‡ºäº†ä¸¤ä¸ªå‡½æ•°ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°å¯ä»¥é€šè¿‡ npm åŒ…æ¥ä½¿ç”¨ã€‚

è®©æˆ‘ä»¬ç¼–å†™ç®€å•çš„ `user-app`ï¼š

`package.json`

```json
{
  "name": "user-app",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "build": "webpack"
  },
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "webpack": "^5.18.0",
    "webpack-cli": "^4.3.1"
  },
  "dependencies": {
    "user-library": "1.0.0"
  }
}
```

æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨ `user-library` ä½œä¸ºä¾èµ–ã€‚

`webpack.config.js`

```js
const path = require("path");

module.exports = {
  entry: "./src/index.js",
  output: {
    filename: "main.js",
    path: path.resolve(__dirname, "dist"),
  },
  mode: "development",
  optimization: {
    usedExports: true,
    innerGraph: true,
    sideEffects: true,
  },
  devtool: false,
};
```

è¦ç†è§£ä¸Šé¢çš„ Webpack é…ç½®ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†è§£ Webpack æ˜¯å¦‚ä½•è¿›è¡Œæ‘‡æ ‘ä¼˜åŒ–çš„ã€‚æ‘‡æ ‘ä¼˜åŒ–è¿›è¡Œçš„æ­¥éª¤å¦‚ä¸‹æ‰€ç¤ºï¼š

- è¯†åˆ«å‡ºåº”ç”¨çš„å…¥å£æ–‡ä»¶ï¼ˆentry fileï¼‰ï¼ˆç”± Webpack é…ç½®æ–‡ä»¶æŒ‡å®šï¼‰
- é€šè¿‡éå†å…¥å£æ–‡ä»¶å¯¼å…¥çš„æ‰€æœ‰çš„ä¾èµ–å’Œå®ƒä»¬å„è‡ªçš„ä¾èµ–ï¼Œæ¥åˆ›å»ºåº”ç”¨çš„æ¨¡å—æ ‘ï¼ˆmodule treeï¼‰
- å¯¹æ ‘ä¸­çš„æ¯ä¸€ä¸ªæ¨¡å—ï¼Œè¯†åˆ«å‡ºå®ƒçš„å“ªäº› `export` è¯­å¥æ²¡æœ‰è¢«å…¶ä»–æ¨¡å—æ‰€å¯¼å…¥ã€‚
- ä½¿ç”¨åƒ UglifyJS æˆ–è€… Terser è¿™æ ·çš„ä»£ç æœ€å°åŒ–ï¼ˆminificationï¼‰å·¥å…·æ¥ç§»é™¤æœªå¼•ç”¨çš„å¯¼å‡ºé¡¹ï¼Œä»¥åŠå®ƒä»¬çš„ç›¸å…³ä»£ç ã€‚

è¿™äº›æ­¥éª¤ä»…åœ¨ **ç”Ÿäº§æ¨¡å¼ï¼ˆproduction modeï¼‰** ä¸‹æ‰ä¼šè¢«æ‰§è¡Œã€‚

**ç”Ÿäº§æ¨¡å¼çš„é—®é¢˜åœ¨äºä»£ç æœ€å°åŒ–ï¼ˆminificationï¼‰**ã€‚å®ƒä¼šè®©æˆ‘ä»¬éš¾ä»¥åˆ†è¾¨æ‘‡æ ‘ä¼˜åŒ–æ˜¯å¦ç”Ÿæ•ˆï¼Œå› ä¸ºåœ¨æ‰“åŒ…åçš„ä»£ç é‡Œæˆ‘ä»¬çœ‹ä¸åˆ°åŸæ¥å‘½åçš„å‡½æ•°ã€‚

ä¸ºäº†ç»•è¿‡è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¼šè®© Webpack è¿è¡Œåœ¨å¼€å‘æ¨¡å¼ï¼ˆdevelopment modeï¼‰ä¸‹ï¼Œä½†ä»ç„¶è®©å®ƒè¯†åˆ«å“ªäº›ä»£ç æœªè¢«å¼•ç”¨å¹¶ä¸”ä¼šåœ¨ç”Ÿäº§æ¨¡å¼ä¸‹è¢«ç§»é™¤ã€‚æˆ‘ä»¬å°†é…ç½®é‡Œçš„ `optimization` è®¾ç½®æˆå¦‚ä¸‹æ‰€ç¤ºï¼š

```js
  optimization: {
    usedExports: true,
    sideEffects: true,
    innerGraph: true,
  }
```

å…¶ä¸­çš„ `usedExports` å±æ€§èƒ½å¤Ÿè®© Webpack è¯†åˆ«å“ªäº›æ¨¡å—çš„å¯¼å‡ºé¡¹æ²¡æœ‰è¢«å…¶ä»–æ¨¡å—å¼•ç”¨ã€‚å…¶ä»–ä¸¤ä¸ªå±æ€§ä¼šåœ¨åæ–‡è®¨è®ºã€‚ç°åœ¨æˆ‘ä»¬æš‚ä¸”è®¤ä¸ºå®ƒä»¬èƒ½å¤Ÿæé«˜æˆ‘ä»¬çš„åº”ç”¨è¢«æ‘‡æ ‘ä¼˜åŒ–çš„æ•ˆæœã€‚

æˆ‘ä»¬ `user-app` çš„å…¥å£æ–‡ä»¶ï¼š`src/index.js`

```js
import { getUserName } from "user-library";

console.log(getUserName());
```

æ‰“åŒ…ä¹‹åï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¾“å‡ºï¼š

```js
/***/ "./node_modules/user-library/dist/index.js":
/*!*************************************************!*\
  !*** ./node_modules/user-library/dist/index.js ***!
  \*************************************************/
/***/ ((__unused_webpack_module, exports) => {

var __webpack_unused_export__;

__webpack_unused_export__ = ({ value: true });

const getUserName = () => 'John Doe';

const getUserPhoneNumber = () => '***********';

exports.getUserName = getUserName;
__webpack_unused_export__ = getUserPhoneNumber;
/***/ })
```

Webpack å°†æˆ‘ä»¬æ‰€æœ‰çš„ä»£ç é‡æ–°ç»„ç»‡åˆ°äº†åŒä¸€ä¸ªæ–‡ä»¶é‡Œã€‚è¯·çœ‹å…¶ä¸­çš„ `getUserPhoneNumer` å¯¼å‡ºé¡¹ï¼Œæ³¨æ„åˆ° Webpack å°†å®ƒæ ‡è®°ä¸ºäº†æœªå¼•ç”¨ã€‚å®ƒä¼šåœ¨ç”Ÿäº§æ¨¡å¼ä¸‹è¢«ç§»é™¤ï¼Œè€Œ `getUserName` åˆ™ä¼šè¢«ä¿ç•™ï¼Œå› ä¸ºå®ƒè¢«æˆ‘ä»¬çš„å…¥å£æ–‡ä»¶ `index.js` æ‰€ä½¿ç”¨ã€‚

![ä½¿ç”¨ ESM æ ¼å¼çš„åº“çš„å¯¼å‡ºæ¨¡å—å›¾](https://picbed.kimyang.cn/202111060227679.jpeg)

æˆ‘ä»¬çš„åº“è¢«æ‘‡æ ‘ä¼˜åŒ–äº†ï¼ä½ å¯ä»¥å†å†™ä¸€äº›å¯¼å…¥é¡¹ï¼Œé‡å¤ä¸Šé¢çš„æ­¥éª¤å†æŸ¥çœ‹è¾“å‡ºçš„ä»£ç ã€‚**æˆ‘ä»¬çš„ç›®çš„æ˜¯çŸ¥é“ Webpack ä¼šæŠŠæˆ‘ä»¬åº“é‡Œæ²¡æœ‰è¢«å¼•ç”¨çš„ä»£ç æ ‡è®°ä¸ºæœªå¼•ç”¨ã€‚**

å¯¹äºæˆ‘ä»¬è¿™ä¸ªç®€å•çš„ `user-library` æ¥è¯´ï¼Œä¸€åˆ‡çœ‹ä¸Šå»éƒ½è¿˜ä¸é”™ã€‚è®©æˆ‘ä»¬å°†å®ƒå˜å¾—å¤æ‚ä¸€äº›ï¼Œä¸æ­¤åŒæ—¶æˆ‘ä»¬ä¼šå…³æ³¨æ‘‡æ ‘ä¼˜åŒ–çš„ä¸€äº›æ¡ä»¶å’Œä¼˜åŒ–é¡¹ã€‚

## ä½¿ç”¨ ES6 æ¨¡å—æ¥è®©æ‰“åŒ…å·¥å…·å¾—ä»¥è¯†åˆ«æœªè¢«ä½¿ç”¨çš„ export

è¿™é¡¹è¦æ±‚éå¸¸å¸¸è§ï¼Œè€Œä¸”å¾ˆå¤šæ–‡æ¡£éƒ½æœ‰è¯¦ç»†çš„è§£é‡Šï¼Œä½†åœ¨æˆ‘çœ‹æ¥å®ƒä»¬å´æœ‰äº›è¯¯å¯¼æ€§ã€‚æˆ‘æ—¶å¸¸èƒ½å¬åˆ°ä¸€äº›å¼€å‘è€…è¯´ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ ES6 æ¨¡å—æ¥è®©æˆ‘ä»¬çš„åº“èƒ½å¤Ÿè¢«æ‘‡æ ‘ä¼˜åŒ–ã€‚è™½ç„¶è¿™å¥è¯æœ¬èº«æ˜¯å®Œå…¨æ­£ç¡®çš„ï¼Œä½† **å…¶ä¸­åŒ…å«ä¸€ç§é”™è¯¯çš„è§‚å¿µï¼Œè¿™ç§è§‚å¿µä»¥ä¸ºä»…ä»…ä½¿ç”¨ ES6 æ¨¡å—å°±è¶³ä»¥è®©æ‘‡æ ‘ä¼˜åŒ–å¾ˆå¥½åœ°å·¥ä½œã€‚** å“ï¼Œè¦æ˜¯çœŸçš„è¿™ä¹ˆç®€å•ï¼Œä½ ä¹Ÿç»ä¸ä¼šé˜…è¯»æœ¬æ–‡è‡³æ­¤ï¼

ä¸è¿‡ï¼Œä½¿ç”¨ ES6 æ¨¡å—ç¡®å®æ˜¯æ‘‡æ ‘ä¼˜åŒ–çš„å¿…è¦æ¡ä»¶ä¹‹ä¸€ã€‚

JavaScript ä»£ç çš„æ‰“åŒ…æ ¼å¼æœ‰å¾ˆå¤šç§ï¼šESMã€CJSã€UMDã€IIFE ç­‰ã€‚

ä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬åªè€ƒè™‘ä¸¤ç§æ ¼å¼ï¼šECMA Script æ¨¡å—ï¼ˆESM æˆ– ES6 æ¨¡å—ï¼‰å’Œ CommonJS æ¨¡å—ï¼ˆCJSï¼‰ï¼Œå› ä¸ºå®ƒä»¬åœ¨åº”ç”¨åº“ä¸­å—åˆ°äº†æœ€ä¸ºå¹¿æ³›çš„ä½¿ç”¨ã€‚å¤§å¤šæ•°åº“ä¼šä½¿ç”¨ CJS æ¨¡å—ï¼Œå› ä¸ºè¿™æ ·èƒ½å¤Ÿè®©å®ƒä»¬èƒ½å¤Ÿè¿è¡Œåœ¨ Node.js åº”ç”¨é‡Œï¼ˆä¸è¿‡ [Node.js ç°åœ¨ä¹Ÿæ”¯æŒ ESM äº†](https://nodejs.medium.com/announcing-core-node-js-support-for-ecmascript-modules-c5d6dc29b663)ï¼‰ã€‚åœ¨ CJS è¯ç”Ÿå¾ˆä¹…ä¹‹åçš„ 2015 å¹´ï¼ŒES æ¨¡å—æ‰ä¼´éš ECMAScript 2015ï¼ˆä¹Ÿè¢«ç§°ä½œ ES6ï¼‰å‡ºç°ï¼Œè¢«è®¤ä¸ºæ˜¯ JavaScript çš„æ ‡å‡†æ¨¡å—ç³»ç»Ÿã€‚

CJS æ ¼å¼çš„ä¾‹å­ï¼š

```js
const { userAccount } = require("./userAccount");

const getUserAccount = () => {
  return userAccount;
};

module.exports = { getUserAccount };
```

ESM æ ¼å¼çš„ä¾‹å­ï¼š

```js
import { userAccount } from "./userAccount";

export const getUserAccount = () => {
  return userAccount;
};
```

**è¿™ä¸¤ç§æ ¼å¼æœ‰ç€å¾ˆå¤§çš„åŒºåˆ«ï¼šESM çš„å¯¼å…¥æ˜¯é™æ€çš„ï¼Œè€Œ CJS çš„å¯¼å…¥æ˜¯åŠ¨æ€çš„ã€‚** è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨ CJS ä¸­åšåˆ°ä»¥ä¸‹çš„äº‹æƒ…ï¼Œä½†æ˜¯åœ¨ ESM ä¸­ä¸è¡Œï¼š

```js
if (someCondition) {
  const { userAccount } = require("./userAccount");
}
```

è™½ç„¶è¿™æ ·çœ‹ä¸Šå»æ›´åŠ çµæ´»ï¼Œä½†å®ƒä¹Ÿæ„å‘³ç€**æ‰“åŒ…å·¥å…·ä¸èƒ½åœ¨ç¼–è¯‘æˆ–æ‰“åŒ…æœŸé—´æ„é€ å‡ºä¸€æ£µæœ‰æ•ˆçš„æ¨¡å—æ ‘**ã€‚`someCondition` è¿™ä¸ªå˜é‡åªæœ‰åœ¨è¿è¡Œæ—¶æ‰èƒ½çŸ¥é“å®ƒçš„å€¼ï¼Œå¯¼è‡´æ‰“åŒ…å·¥å…·åœ¨ç¼–è¯‘æœŸé—´æ— è®º `someCondition` çš„å€¼æ˜¯ä»€ä¹ˆéƒ½ä¼šæŠŠ `userAccount` ç»™å¯¼å…¥è¿›æ¥ã€‚è¿™ä¹Ÿå¯¼è‡´æ‰“åŒ…å·¥å…·æ— æ³•æ£€æŸ¥è¿™äº›å¯¼å…¥é¡¹æ˜¯å¦çœŸçš„è¢«ä½¿ç”¨äº†ï¼Œäºæ˜¯æŠŠæ‰€æœ‰ CJS æ ¼å¼çš„å¯¼å…¥é¡¹æ‰“åŒ…è¿› bundle é‡Œã€‚

è®©æˆ‘ä»¬ä¿®æ”¹ `user-library` çš„ä»£ç æ¥ä½“ç°è¿™ä¸€ç‚¹ã€‚åŒæ—¶ï¼Œä¸ºäº†è®©è¿™ä¸ªåº“æ˜¾å¾—æ›´è´´è¿‘ç°å®ï¼Œå®ƒç°åœ¨æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š

`src/userAccount.js`

```js
const userAccount = {
  name: "user account",
};

module.exports = { userAccount };
```

`src/index.js`

```js
const { userAccount } = require("./userAccount");

const getUserName = () => "John Doe";

const getUserPhoneNumber = () => "***********";

const getUserAccount = () => userAccount;

module.exports = {
  getUserName,
  getUserPhoneNumber,
  getUserAccount,
};
```

æˆ‘ä»¬ä¿æŒ `user-app` çš„å…¥å£æ–‡ä»¶ä¸å˜ï¼Œè¿™æ ·æˆ‘ä»¬ä¾ç„¶ä¸ä¼šç”¨åˆ° `getUserAccount` å‡½æ•°åŠå…¶ä¾èµ–ã€‚

```js
/*!*************************************************!*\
  !*** ./node_modules/user-library/dist/index.js ***!
  \*************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const { userAccount } = __webpack_require__(/*! ./userAccount */ "./node_modules/user-library/dist/userAccount.js")

const getUserName = () => 'John Doe'

const getUserPhoneNumber = () => '***********'

const getUserAccount = () => userAccount

module.exports = {
  getUserName,
  getUserPhoneNumber,
  getUserAccount
}
/***/ }),

/***/ "./node_modules/user-library/dist/userAccount.js":
/*!*******************************************************!*\
  !*** ./node_modules/user-library/dist/userAccount.js ***!
  \*******************************************************/
/***/ ((module) => {

const userAccount = {
  name: 'user account'
}

module.exports = { userAccount }
/***/ })
```

è¿™ä¸‰ä¸ªå¯¼å‡ºé¡¹å…¨éƒ¨éƒ½å‡ºç°åœ¨æ‰“åŒ…è¾“å‡ºé‡Œï¼Œå¹¶ä¸”æ²¡æœ‰è¢« Webpack æ ‡è®°ä¸ºæœªå¼•ç”¨ã€‚å¯¹äºæºæ–‡ä»¶ `userAccount` ä¹Ÿæ˜¯å¦‚æ­¤ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å°†ä¸Šé¢çš„ä¾‹å­æ”¹é€ æˆ ESM ä¹‹åçš„ç»“æœã€‚æˆ‘ä»¬åšçš„ä¿®æ”¹æ˜¯å°† `require` å’Œ `exports` çš„è¯­æ³•å…¨éƒ¨æ”¹æˆå¯¹åº”çš„ ESM çš„è¯­æ³•ã€‚

```js
/*!*************************************************!*\
  !*** ./node_modules/user-library/dist/index.js ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "getUserName": () => /* binding */ getUserName
/* harmony export */ });
/* unused harmony exports getUserAccount, getUserPhoneNumber */
/* harmony import */ var _userAccount_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./userAccount.js */ "./node_modules/user-library/dist/userAccount.js");

const getUserName = () => 'John Doe';

const getUserPhoneNumber = () => '***********';

const getUserAccount = () => userAccount;

/***/ }),
/***/ "./node_modules/user-library/dist/userAccount.js":
/*!*******************************************************!*\
  !*** ./node_modules/user-library/dist/userAccount.js ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* unused harmony export userAccount */
const userAccount = {
  name: 'user account'
};
/***/ })
```

æ³¨æ„ï¼Œ`getUserAccount` å’Œ `getUserPhoneNumber` éƒ½è¢«æ ‡è®°ä¸ºäº†æœªå¼•ç”¨ã€‚è€Œä¸”å¦ä¸€ä¸ªæ–‡ä»¶é‡Œçš„ `userAccount` ä¹Ÿè¢«æ ‡è®°äº†ã€‚å¾—ç›Šäº `innerGraph` ä¼˜åŒ–ï¼ŒWebpack èƒ½å¤Ÿå°† `index.js` æ–‡ä»¶é‡Œçš„ `getUserAccount` å¯¼å…¥é¡¹é“¾æ¥åˆ° `userAccount` å¯¼å‡ºé¡¹ã€‚**è¿™è®© Webpack å¯ä»¥ä»å…¥å£æ–‡ä»¶å¼€å§‹ï¼Œé€’å½’éå†å®ƒæ‰€æœ‰çš„ä¾èµ–ï¼Œè¿›è€ŒçŸ¥é“æ¯ä¸€ä¸ªæ¨¡å—çš„å“ªäº›å¯¼å‡ºé¡¹æœªè¢«å¼•ç”¨ã€‚** å› ä¸º Webpack çŸ¥é“ `getUserAccount` æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œæ‰€ä»¥å®ƒå¯ä»¥åˆ° `userAccount` æ–‡ä»¶é‡Œå¯¹ `getUserAccount` çš„ä¾èµ–åšç›¸åŒçš„æ£€æŸ¥ã€‚

![ä½¿ç”¨ ESM æ ¼å¼çš„åº“çš„å¯¼å‡ºæ¨¡å—å›¾](https://picbed.kimyang.cn/202111060235702.jpeg)

ES æ¨¡å—è®©æˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ä»£ç é‡Œå¯»æ‰¾é‚£äº›è¢«å¼•ç”¨çš„å’Œæœªè¢«å¼•ç”¨çš„å¯¼å‡ºé¡¹ï¼Œè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆè¿™ç§æ¨¡å—ç³»ç»Ÿå¯¹äºæ‘‡æ ‘ä¼˜åŒ–æ˜¯å¦‚æ­¤çš„é‡è¦ã€‚å®ƒè¿˜è§£é‡Šäº†ä¸ºä»€ä¹ˆæˆ‘ä»¬åº”è¯¥ä½¿ç”¨åƒ [`lodash-es`](https://www.npmjs.com/package/lodash-es) è¿™æ ·å¯¼å‡ºäº†å…¼å®¹ ESM çš„æ„å»ºäº§ç‰©çš„ä¾èµ–ã€‚è¿™é‡Œ lodash-es åº“æ˜¯å¾ˆå—æ¬¢è¿çš„ [`lodash`](https://lodash.com/) åº“çš„ ESM ç‰ˆæœ¬ã€‚

è¯è™½å¦‚æ­¤ï¼Œ**é’ˆå¯¹æ‘‡æ ‘ä¼˜åŒ–ï¼Œä»…ä»…ä½¿ç”¨ ES æ¨¡å—ä»ç„¶ä¸æ˜¯æœ€ä½³çš„æ–¹æ³•**ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­é‡Œï¼Œæˆ‘ä»¬å‘ç° Webpack ä¼šåœ¨æ¯ä¸ªæ–‡ä»¶é€’å½’åœ°æ£€æŸ¥å¯¼å‡ºçš„ä»£ç æ˜¯å¦è¢«å¼•ç”¨ã€‚å¯¹äºæˆ‘ä»¬çš„ä¾‹å­æ¥è¯´ï¼ŒWebpack å…¶å®å¯ä»¥ç›´æ¥å¿½ç•¥æ‰ `userAccount` æ–‡ä»¶ï¼Œå› ä¸ºå®ƒå”¯ä¸€çš„å¯¼å‡ºé¡¹æ˜¯æœªå¼•ç”¨çš„ï¼è¿™å°±å°†æˆ‘ä»¬å¼•å…¥åˆ°æ–‡ç« æ¥ä¸‹æ¥å¯¹å‰¯ä½œç”¨ï¼ˆside effectï¼‰çš„è®¨è®ºã€‚

æœ¬æ–‡è¿™ä¸€éƒ¨åˆ†çš„æ€»ç»“å¦‚ä¸‹ï¼š

- **ESM æ˜¯æ‘‡æ ‘ä¼˜åŒ–çš„æ¡ä»¶ä¹‹ä¸€ï¼Œä½†ä»…å‡­å®ƒä¸è¶³ä»¥è®©æ‘‡æ ‘ä¼˜åŒ–è¾¾åˆ°ç†æƒ³æ•ˆæœã€‚**
- **ç¡®ä¿ä½ çš„åº“æ€»æ˜¯æä¾›ä¸€ä»½ ESM æ ¼å¼çš„ç¼–è¯‘äº§ç‰©ï¼** å¦‚æœä½ çš„åº“çš„ç”¨æˆ·éœ€è¦ ESM å’Œ CJS æ ¼å¼çš„ç¼–è¯‘äº§ç‰©ï¼Œå¯ä»¥é€šè¿‡ package.json ä¸­çš„ [`main` å’Œ `module` å±æ€§](https://github.com/rollup/rollup/wiki/pkg.module)æ¥è®¾ç½®ã€‚
- å¦‚æœå¯ä»¥çš„è¯ï¼Œ**ç¡®ä¿æ€»æ˜¯ä½¿ç”¨ ESM æ ¼å¼çš„ä¾èµ–**ï¼Œå¦åˆ™å®ƒä»¬ä¸èƒ½è¢«æ‘‡æ ‘ä¼˜åŒ–ã€‚

## ä½¿ç”¨å‰¯ä½œç”¨ä¼˜åŒ–æ¥è®©ä½ çš„åº“ä¸åŒ…å«å‰¯ä½œç”¨

æ ¹æ® [Webpack](https://webpack.js.org/) çš„æ–‡æ¡£ï¼Œæ‘‡æ ‘ä¼˜åŒ–å¯ä»¥è¢«åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§ä¼˜åŒ–æªæ–½ï¼š

- **å¼•ç”¨å¯¼å‡ºï¼ˆusedExportsï¼‰**ï¼šåˆ¤å®šä¸€ä¸ªæ¨¡å—çš„å“ªäº›å¯¼å‡ºé¡¹æ˜¯è¢«å¼•ç”¨çš„æˆ–æœªè¢«å¼•ç”¨ã€‚
- **å‰¯ä½œç”¨ï¼ˆsideEffectsï¼‰**ï¼šç•¥è¿‡é‚£äº›ä¸åŒ…å«ä»»ä½•è¢«å¼•ç”¨çš„å¯¼å‡ºé¡¹å¹¶ä¸”ä¸åŒ…å«å‰¯ä½œç”¨çš„æ¨¡å—ã€‚

ä¸ºäº†é˜é‡Šå‰¯ä½œç”¨çš„å«ä¹‰ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä¹‹å‰ç”¨åˆ°çš„ä¾‹å­ï¼š

```js
import { userAccount } from "./userAccount";

function getUserAccount() {
  return userAccount;
}
```

å¦‚æœ `getUserAccount` æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œæ‰“åŒ…å·¥å…·æ˜¯å¦å¯ä»¥è®¤ä¸º `userAccount` æ¨¡å—å¯ä»¥ä»æ‰“åŒ…è¾“å‡ºä¸­ç§»é™¤å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ï¼`userAccount` å¯ä»¥åšå„ç§èƒ½å¤Ÿå½±å“åº”ç”¨çš„å…¶ä»–éƒ¨åˆ†çš„äº‹æƒ…ã€‚å®ƒå¯ä»¥å‘å…¨å±€å¯è®¿é—®çš„å€¼é‡Œæ³¨å…¥ä¸€äº›å˜é‡ï¼Œæ¯”å¦‚ DOMã€‚å®ƒè¿˜å¯ä»¥æ˜¯ä¸€ä¸ª CSS æ¨¡å—ï¼Œä¼šå‘ `document` é‡Œæ³¨å…¥æ ·å¼ã€‚ä¸è¿‡æˆ‘è§‰å¾—æœ€å¥½çš„ä¾‹å­æ˜¯ polyfillã€‚æˆ‘ä»¬é€šå¸¸ä¼šåƒä¸‹é¢è¿™æ ·å¼•å…¥å®ƒä»¬ï¼š

```js
import "myPolyfill";
```

ç°åœ¨è¿™ä¸ªæ¨¡å—ä¸€å®šæœ‰å‰¯ä½œç”¨äº†ï¼Œå› ä¸ºä¸€æ—¦å®ƒè¢«å¯¼å…¥åˆ°å…¶ä»–æ¨¡å—ï¼Œå®ƒå°±ä¼šå½±å“åˆ°æ•´ä¸ªåº”ç”¨çš„ä»£ç ã€‚æ‰“åŒ…å·¥å…·ä¼šå°†è¿™ä¸ªæ¨¡å—è§†ä¸ºå¯èƒ½è¢«åˆ é™¤çš„å€™é€‰è€…ï¼Œæ¯•ç«Ÿæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨å®ƒçš„ä»»ä½•å¯¼å‡ºé¡¹ã€‚ä¸è¿‡ç§»é™¤å®ƒä¼šç ´åæˆ‘ä»¬åº”ç”¨çš„æ­£å¸¸è¿è¡Œã€‚

**åƒ [Webpack](https://webpack.js.org/) å’Œ [Rollup](https://rollupjs.org/guide/en/#treeshake) è¿™æ ·çš„æ‰“åŒ…å·¥å…·ä¹Ÿå› æ­¤ä¼šé»˜è®¤åœ°å°†æˆ‘ä»¬åº“ä¸­çš„æ‰€æœ‰æ¨¡å—è§†ä¸ºåŒ…å«å‰¯ä½œç”¨ã€‚**

ä½†æ˜¯åœ¨å‰é¢çš„ä¾‹å­é‡Œï¼Œæˆ‘ä»¬çŸ¥é“æˆ‘ä»¬çš„åº“ä¸åŒ…å«ä»»ä½•å‰¯ä½œç”¨ï¼å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å‘Šè¯‰æ‰“åŒ…å·¥å…·è¿™ä¸€ç‚¹ã€‚å¤§å¤šæ•°æ‰“åŒ…å·¥å…·[å¯ä»¥è¯»å– `package.json` æ–‡ä»¶é‡Œçš„ `sideEffects` å±æ€§](https://webpack.js.org/guides/tree-shaking/#mark-the-file-as-side-effect-free)ã€‚è¿™ä¸ªå±æ€§å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé‚£ä¹ˆå®ƒé»˜è®¤ä¼šè¢«è®¾ä¸º `true`ï¼ˆè¡¨ç¤ºè¿™ä¸ªåŒ…é‡Œæ‰€æœ‰çš„æ¨¡å—éƒ½å«æœ‰å‰¯ä½œç”¨ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥å°†å®ƒè®¾ä¸º `false`ï¼ˆè¡¨ç¤ºæ‰€æœ‰æ¨¡å—éƒ½ä¸åŒ…å«å‰¯ä½œç”¨ï¼‰æˆ–è€…ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªæ•°ç»„ï¼Œåˆ—ä¸¾å‡ºå«æœ‰å‰¯ä½œç”¨çš„æºæ–‡ä»¶ã€‚

æˆ‘ä»¬å°†è¿™ä¸ªå±æ€§æ·»åŠ åˆ° `user-library` åº“çš„ `package.json` ä¸­ï¼š

```json
{
  "name": "user-library",
  "version": "1.0.0",
  "description": "",
  "sideEffects": false,
  "main": "dist/index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "",
  "license": "ISC"
}
```

ç„¶åé‡æ–°è¿è¡Œ Webpack è¿›è¡Œæ‰“åŒ…ï¼š

```js
/*!*************************************************!*\
  !*** ./node_modules/user-library/dist/index.js ***!
  \*************************************************/
/***/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
  /* harmony export */ __webpack_require__.d(__webpack_exports__, {
    /* harmony export */ getUserName: () => /* binding */ getUserName,
    /* harmony export */
  });
  /* unused harmony exports getUserAccount, getUserPhoneNumber */

  const getUserName = () => "John Doe";

  const getUserPhoneNumber = () => "***********";

  const getUserAccount = () => userAccount;
  /***/
};
```

æˆ‘ä»¬å‘ç°ï¼Œæºæ–‡ä»¶ `userAccount` å·²ç»åœ¨æ‰“åŒ…è¾“å‡ºä¸­è¢«ç§»é™¤äº†ã€‚æˆ‘ä»¬ä»ç„¶èƒ½å¤Ÿçœ‹åˆ° `getUserAccount` å‡½æ•°åœ¨å¼•ç”¨ `userAccount`ï¼Œä¸è¿‡æ­¤å‡½æ•°å·²ç»è¢« Webpack æ ‡è®°ä¸ºäº†æœªå¼•ç”¨ä»£ç ï¼Œå®ƒä¼šåœ¨ä»£ç æœ€å°åŒ–çš„è¿‡ç¨‹ä¸­è¢«ç§»é™¤ã€‚

![å‰¯ä½œç”¨ä¼˜åŒ–ä¸‹çš„æ¨¡å—å›¾](https://picbed.kimyang.cn/202111060236300.jpeg)

** `sideEffects` é€‰é¡¹å¯¹äºé‚£äº›é€šè¿‡ä¸€ä¸ª index æ–‡ä»¶ä»å…¶ä»–å†…éƒ¨æºæ–‡ä»¶å¯¼å‡º API çš„åº“å°¤å…¶é‡è¦ã€‚** å¦‚æœæ²¡æœ‰å‰¯ä½œç”¨ä¼˜åŒ–ï¼Œæ‰“åŒ…å·¥å…·å°±å¿…é¡»è§£ææ‰€æœ‰åŒ…å«å¯¼å‡ºé¡¹çš„æºæ–‡ä»¶ã€‚

æ­£å¦‚ [Webpack çš„æç¤º](https://webpack.js.org/guides/tree-shaking/#clarifying-tree-shaking-and-sideeffects)ï¼š**â€œ`sideEffects` éå¸¸åœ°é«˜æ•ˆï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿè®©æ‰“åŒ…å·¥å…·ç•¥è¿‡æ•´ä¸ªçš„æ¨¡å—æˆ–æºæ–‡ä»¶ï¼Œä»¥åŠå®ƒçš„æ•´ä¸ªå­æ ‘â€**

å¯¹äºå‰æ–‡ä»‹ç»çš„ä¸¤ç§ä¼˜åŒ–æªæ–½åœ¨ä»‹å…¥æ‰“åŒ…è¿‡ç¨‹ä¸Šçš„ä¸åŒä¹‹å¤„ï¼Œç®€å•æ¥è¯´å¦‚ä¸‹æ‰€è¿°ï¼š

- `sideEffects` è®©æ‰“åŒ…å·¥å…·ç•¥è¿‡ä¸€ä¸ªè¢«å¯¼å…¥çš„æ¨¡å—ï¼Œå¦‚æœä»è¿™ä¸ªæ¨¡å—å¯¼å…¥çš„ä¸œè¥¿å…¨éƒ¨éƒ½æ²¡æœ‰è¢«ä½¿ç”¨çš„è¯ã€‚
- `usedExports` è®©æ‰“åŒ…å·¥å…·ç§»é™¤åœ¨ä¸€ä¸ªæ¨¡å—é‡Œæœªè¢«å¼•ç”¨çš„å¯¼å‡ºé¡¹ã€‚

é‚£ä¹ˆï¼Œä¸Šé¢ä¸¤ç§æªæ–½ï¼Œä¸€ä¸ªæ˜¯â€œç•¥è¿‡æ–‡ä»¶â€ï¼Œä¸€ä¸ªæ˜¯â€œå°†å¯¼å‡ºé¡¹æ ‡è®°ä¸ºæœªè¢«ä½¿ç”¨â€ã€‚**å‰è€…å½±å“ä¸‹çš„æ‰“åŒ…è¾“å‡ºåˆå’Œåè€…æœ‰ä»€ä¹ˆä¸åŒä¹‹å¤„å‘¢ï¼Ÿ**

å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹ä¸€ä¸ªåº“è¿›è¡Œæ‘‡æ ‘ä¼˜åŒ–ï¼Œæœ‰å’Œæ²¡æœ‰å‰¯ä½œç”¨ä¼˜åŒ–å…¶å®ä¼šäº§ç”Ÿä¸€æ¨¡ä¸€æ ·çš„è¾“å‡ºã€‚æœ€ç»ˆçš„ bundle é‡ŒåŒ…å«çš„ä»£ç é‡æ˜¯ä¸€æ ·çš„ã€‚ä¸è¿‡åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¦‚æœåˆ†ææœªå¼•ç”¨çš„å¯¼å‡ºé¡¹çš„ç›¸å…³ä»£ç çš„è¿‡ç¨‹è¿‡äºå¤æ‚ï¼Œé‚£ä¹ˆæœ‰å’Œæ²¡æœ‰å‰¯ä½œç”¨ä¼˜åŒ–çš„ç»“æœå°±ä¸ä¸€æ ·äº†ã€‚æœ¬æ–‡æ¥ä¸‹æ¥çš„éƒ¨åˆ†å°†åŒ…å«è¿™ä¸¤ç§æƒ…å†µçš„ä¾‹å­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°åªæœ‰å°çš„æ¨¡å—å’Œå¼€å¯å‰¯ä½œç”¨ä¼˜åŒ–çš„ç»„åˆäº§ç”Ÿäº†æœ€å¥½çš„æ‰“åŒ…äº§ç‰©ã€‚

**è¿™ä¸€éƒ¨åˆ†çš„æ€»ç»“å¦‚ä¸‹ï¼š**

- æ‘‡æ ‘ä¼˜åŒ–åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼š**å¼•ç”¨å¯¼å‡ºï¼ˆused exportsï¼‰ä¼˜åŒ–**å’Œ**å‰¯ä½œç”¨ï¼ˆside effectsï¼‰ä¼˜åŒ–**ã€‚
- side effects ä¼˜åŒ–ç›¸æ¯”èµ·æ£€æµ‹æ¯ä¸ªæ¨¡å—ä¸­æœªè¢«ä½¿ç”¨çš„å¯¼å‡ºé¡¹ï¼Œ**æœ‰æ›´é«˜çš„æ•ˆç‡**ã€‚
- ä¸è¦åœ¨ä½ çš„åº“é‡Œå¼•å…¥ä»»ä½•å‰¯ä½œç”¨ã€‚
- ä¸€å®šè¦é€šè¿‡ `package.json` æ–‡ä»¶é‡Œçš„ `sideEffects` å±æ€§å‘Šè¯‰æ‰“åŒ…å·¥å…·ï¼šä½ çš„åº“ä¸åŒ…å«ä»»ä½•å‰¯ä½œç”¨ã€‚

## é€šè¿‡ä¿ç•™åº“çš„æ¨¡å—æ ‘å¹¶å°†ä»£ç åˆ†å‰²åˆ°å°çš„æ¨¡å—ä¸­ï¼Œæ¥è®©ä½ çš„åº“ä» `side effects` ä¼˜åŒ–ä¸­å……åˆ†è·ç›Šã€‚

ä½ å¯èƒ½æ³¨æ„åˆ°æˆ‘ä»¬åœ¨æœ¬æ–‡å…ˆå‰çš„ä¾‹å­é‡Œçš„ `user-library` å¹¶æ²¡æœ‰è¢«æ‰“åŒ…åˆ°ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶é‡Œï¼Œè€Œæ˜¯ç›´æ¥æš´éœ²æ‰‹åŠ¨åŠ å…¥çš„ `.js` æºæ–‡ä»¶ã€‚

é€šå¸¸ï¼Œä¸€ä¸ªåº“ä¼šç”±äºä»¥ä¸‹åŸå› è¢«æ‰“åŒ…ï¼š

- ä½¿ç”¨äº†ä¸€äº›è‡ªå®šä¹‰çš„ `import` è·¯å¾„ã€‚
- ä½¿ç”¨çš„æ˜¯åƒ Sass æˆ–è€… TypeScript è¿™æ ·çš„è¯­è¨€ï¼Œå®ƒä»¬éœ€è¦è½¬æ¢åˆ°æ¯”å¦‚ CSS æˆ–è€… JavaScript è¿™æ ·çš„è¯­è¨€ã€‚
- éœ€è¦æ»¡è¶³äºæä¾›å¤šç§æ¨¡å—æ ¼å¼ï¼ˆESMã€CJSã€IIFE ç­‰ï¼‰çš„éœ€æ±‚ã€‚

åƒ [Webpack](https://webpack.js.org/)ã€[Rollup](https://rollupjs.org/guide/en/)ã€[Parcel](https://parceljs.org/) å’Œ [ESBuild](https://esbuild.github.io/) è¿™æ ·çš„æµè¡Œçš„æ‰“åŒ…å·¥å…·è¢«è®¾è®¡ä¸ºç”¨æ¥æä¾›ä¸€ä¸ªèƒ½å¤Ÿä¼ è¾“ç»™æµè§ˆå™¨ä½¿ç”¨çš„ bundleã€‚å®ƒä»¬ä¹Ÿå› æ­¤å€¾å‘äºåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„çš„æ–‡ä»¶ï¼Œç„¶åå°†ä½ çš„æ‰€æœ‰ä»£ç é‡æ–°ç»„åˆå¹¶è¾“å‡ºåˆ°è¿™ä¸ªæ–‡ä»¶é‡Œï¼Œä»è€Œåªæœ‰ä¸€ä¸ªå•ç‹¬çš„ `.js` æ–‡ä»¶éœ€è¦é€šè¿‡ç½‘ç»œè¿›è¡Œä¼ è¾“ã€‚

ä»æ‘‡æ ‘ä¼˜åŒ–çš„è§’åº¦æ¥è¯´ï¼Œè¿™å¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜ï¼š**å‰¯ä½œç”¨ä¼˜åŒ–ä¸å¤å­˜åœ¨äº†**ï¼Œå› ä¸ºæ²¡æœ‰æ¨¡å—èƒ½å¤Ÿè¢«ç•¥è¿‡ã€‚

æˆ‘ä»¬å°†åˆ—ä¸¾ä¸¤ç§æƒ…å†µæ¥è¯´æ˜ï¼šå¯¹æ‘‡æ ‘ä¼˜åŒ–æ¥è¯´ï¼Œåˆ†å‰²æ¨¡å—æ­é…å‰¯ä½œç”¨ä¼˜åŒ–æ˜¯å¿…é¡»çš„ã€‚

#### ä¸€ä¸ªåº“æ¨¡å—å¯¼å…¥ä¸€ä¸ª CJS æ ¼å¼çš„ä¾èµ–

ä¸ºäº†æ¼”ç¤ºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ [Rollup](https://rollupjs.org/guide/en/) æ¥æ‰“åŒ…æˆ‘ä»¬çš„åº“ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å°†è®©åº“çš„å…¶ä¸­ä¸€ä¸ªæ¨¡å—å¯¼å…¥ä¸€ä¸ª CJS æ ¼å¼çš„ä¾èµ–ï¼š[Lodash](https://lodash.com)ã€‚

`rollup.config.js`

```js
export default {
  input: "src/index.js",
  output: {
    file: "dist/index.js",
    format: "esm",
  },
};
```

`userAccount.js`

```js
import { isNil } from "lodash";

export const checkExistance = (variable) => !isNil(variable);

export const userAccount = {
  name: "user account",
};
```

æ³¨æ„ï¼Œæˆ‘ä»¬ç°åœ¨å°†å¯¼å‡º `checkExistance`ï¼Œç„¶åå°†å®ƒå¯¼å…¥åˆ°æˆ‘ä»¬åº“çš„ `index.js` æ–‡ä»¶é‡Œã€‚

ä»¥ä¸‹æ˜¯æ‰“åŒ…è¾“å‡ºçš„æ–‡ä»¶ `dist/index.js`ï¼š

```js
import { isNil } from "lodash";

const checkExistance = (variable) => !isNil(variable);

const userAccount = {
  name: "user account",
};

const getUserAccount = () => {
  return userAccount;
};

const getUserPhoneNumber = () => "***********";

const getUserName = () => "John Doe";

export { checkExistance, getUserName, getUserPhoneNumber, getUserAccount };
```

æ‰€æœ‰æ–‡ä»¶éƒ½è¢«æ‰“åŒ…åˆ°äº†ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶é‡Œã€‚æ³¨æ„ Lodash ä¹Ÿåœ¨æ­¤æ–‡ä»¶çš„é¡¶éƒ¨è¢«å¯¼å…¥ã€‚æˆ‘ä»¬åœ¨ `user-app` é‡Œä»ç„¶å¯¼å…¥å’Œä»¥å‰ä¸€æ ·çš„å‡½æ•°ï¼Œè¿™æ„å‘³ç€ `checkExistance` å‡½æ•°ä¾ç„¶æœªè¢«å¼•ç”¨ã€‚ç„¶è€Œï¼Œåœ¨è¿è¡Œ Webpack æ‰“åŒ… `user-app` ä¹‹åï¼Œæˆ‘ä»¬å‘ç°å³ä½¿ `checkExistance` å‡½æ•°è¢«æ ‡è®°ä¸ºäº†æœªå¼•ç”¨ï¼Œæ•´ä¸ª Lodash åº“ä»ç„¶è¢«å¯¼å…¥äº†ï¼š

```js
/***/ "./node_modules/user-library/dist/index.js":
/*!*************************************************!*\
  !*** ./node_modules/user-library/dist/index.js ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "getUserName": () => (/* binding */ getUserName)
/* harmony export */ });
/* unused harmony exports checkExistance, userAccount, getUserPhoneNumber, getUserAccount */
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ "./node_modules/user-library/node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);

const checkExistance = (variable) => !isNil(variable);

const userAccount = {
  name: "user account",
};

const getUserPhoneNumber = {
  number: '***********'
};

const getUserAccount = () => {
  return userAccount
};

const getUserName = () => 'John Doe';

/***/ }),

/***/ "./node_modules/user-library/node_modules/lodash/lodash.js":
/*!*****************************************************************!*\
  !*** ./node_modules/user-library/node_modules/lodash/lodash.js ***!
  \*****************************************************************/
/***/ (function(module, exports, __webpack_require__) {

/* module decorator */ module = __webpack_require__.nmd(module);
var __WEBPACK_AMD_DEFINE_RESULT__;/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
// ...
```

Webpack æ— æ³•å¯¹ Lodash è¿›è¡Œæ‘‡æ ‘ä¼˜åŒ–ï¼Œå› ä¸ºå®ƒçš„æ¨¡å—æ ¼å¼æ˜¯ CJSã€‚è¿™æŒºè®©äººå¤±æœ›çš„ï¼Œæ¯•ç«Ÿæˆ‘ä»¬éƒ½å¾ˆæ˜æ˜¾åœ°ç»„ç»‡å¥½äº†æˆ‘ä»¬çš„åº“ï¼Œè®© Lodash ä»…åœ¨ `userAccount` æ¨¡å—é‡Œè¢«å¯¼å…¥ï¼Œè€Œä¸”è¿™ä¸ªæ¨¡å—ä¹Ÿæ²¡æœ‰è¢«æˆ‘ä»¬çš„åº”ç”¨æ‰€å¼•ç”¨ã€‚å¦‚æœæ¨¡å—ç»“æ„èƒ½å¤Ÿä¿ç•™ï¼ŒWebpack å°±èƒ½å—ç›Šäºå‰¯ä½œç”¨ä¼˜åŒ–ï¼Œä»è€Œèƒ½å¤Ÿæ£€æµ‹åˆ° `userAccount` çš„å¯¼å‡ºé¡¹éƒ½æœªè¢«å¼•ç”¨ç„¶åç›´æ¥ç•¥è¿‡è¿™ä¸ªæ¨¡å—ï¼Œè¿™æ ·çš„è¯ Lodash å°±ä¸ä¼šè¢«æ‰“åŒ…äº†ã€‚

åœ¨ Rollup ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥[ä½¿ç”¨ `preserveModules` é€‰é¡¹æ¥ä¿ç•™åº“çš„æ¨¡å—ç»“æ„](https://rollupjs.org/guide/en/#outputpreservemodules)ã€‚å…¶ä»–æ‰“åŒ…å·¥å…·ä¹Ÿæœ‰ç±»ä¼¼çš„é€‰é¡¹ã€‚

```js
export default {
  input: "src/index.js",
  output: {
    dir: "dist",
    format: "esm",
    preserveModules: true,
  },
};
```

[Rollup](https://rollupjs.org/guide/en/) ç°åœ¨èƒ½å¤Ÿä¿ç•™åŸæœ¬çš„æ–‡ä»¶ç»“æ„äº†ï¼Œæˆ‘ä»¬å†æ¬¡è¿è¡Œ Webpackï¼Œå¾—åˆ°ä»¥ä¸‹çš„æ‰“åŒ…è¾“å‡ºï¼š

```js
/***/ "./node_modules/user-library/dist/index.js":
/*!*************************************************!*\
  !*** ./node_modules/user-library/dist/index.js ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "getUserName": () => (/* binding */ getUserName)
/* harmony export */ });
/* unused harmony export getUserAccount */

const getUserAccount = () => {
  return userAccount
};

const getUserName = () => 'John Doe';

/***/ })
```

[Lodash](https://lodash.com/) ç°åœ¨å’Œ `userAccount` æ¨¡å—ä¸€èµ·è¢«ç•¥è¿‡äº†ã€‚

![åœ¨ä½¿ç”¨ CJS æ ¼å¼çš„ä¾èµ–æ—¶ï¼Œä¿ç•™æ¨¡å—ç»“æ„èƒ½å¤Ÿæ”¹å–„æ‘‡æ ‘ä¼˜åŒ–æ•ˆæœ](https://picbed.kimyang.cn/202111060239769.jpeg)

#### ä»£ç åˆ†å‰²

ä¿ç•™åˆ†å‰²åçš„æ¨¡å—ç»“æ„ä»¥åŠå¼€å¯å‰¯ä½œç”¨ä¼˜åŒ–ä¹Ÿæœ‰åŠ©äº [Webpack çš„ä»£ç åˆ†å‰²](https://webpack.js.org/guides/code-splitting/)ã€‚å®ƒå¯¹äºå¤§å‹åº”ç”¨æ¥è¯´æ˜¯ä¸€ä¸ªå…³é”®çš„ä¼˜åŒ–æªæ–½ï¼Œè¢«å¹¿æ³›åº”ç”¨äºé‚£äº›å«æœ‰å¤šä¸ªé¡µé¢çš„ Web åº”ç”¨ã€‚åƒ [Nuxt](https://nuxtjs.org/) å’Œ [Next](https://nextjs.org/) è¿™æ ·çš„æ¡†æ¶éƒ½ä¼šç»™å„ä¸ªé¡µé¢é…ç½®ä»£ç åˆ†å‰²ã€‚

ä¸ºäº†æ¼”ç¤ºä»£ç åˆ†å‰²å¸¦æ¥çš„å¥½å¤„ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å¦‚æœæˆ‘ä»¬çš„åº“è¢«æ‰“åŒ…åˆ°äº†ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚

`user-library/src/userAccount.js`

```js
export const userAccount = {
  name: "user account",
};
```

`user-library/src/userPhoneNumber.js`

```js
export const userPhoneNumber = {
  number: "***********",
};
```

`user-library/src/index.js`

```js
import { userAccount } from "./userAccount";
import { userPhoneNumber } from "./userPhoneNumber";

const getUserName = () => "John Doe";

export { userAccount, getUserName, userPhoneNumber };
```

ä¸ºäº†å¯¹æˆ‘ä»¬çš„åº”ç”¨è¿›è¡Œä»£ç åˆ†å‰²ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ [Webpack çš„ `import` è¯­æ³•](https://webpack.js.org/api/module-methods/#import-1)ã€‚

`user-app/src/userService1.js`

```js
import { userAccount } from "user-library";

export const logUserAccount = () => {
  console.log(userAccount);
};
```

`user-app/src/userService2.js`

```js
import { userPhoneNumber } from "user-library";

export const logUserPhoneNumber = () => {
  console.log(userPhoneNumber);
};
```

`user-app/src/index.js`

```js
const main = async () => {
  const { logUserPhoneNumber } = await import("./userService2");
  const { logUserAccount } = await import("./userService1");

  logUserAccount();
  logUserPhoneNumber();
};

main();
```

æ‰“åŒ…äº§ç”Ÿçš„æ–‡ä»¶ç°åœ¨æœ‰ä¸‰ä¸ªï¼š`main.js`ã€`src_userService1_js.main.js` å’Œ `src_userService2_js.main.js`ã€‚ä»”ç»†æŸ¥çœ‹ `src_userService1_js.main.js` çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æ•´ä¸ª `user-library` éƒ½è¢«æ‰“åŒ…äº†ï¼š

```js
(self["webpackChunkuser_app"] = self["webpackChunkuser_app"] || []).push([
  ["src_userService1_js"],
  {
    /***/ "./node_modules/user-library/dist/index.js":
      /*!*************************************************!*\
  !*** ./node_modules/user-library/dist/index.js ***!
  \*************************************************/
      /***/ (
        __unused_webpack_module,
        __webpack_exports__,
        __webpack_require__
      ) => {
        "use strict";
        /* harmony export */ __webpack_require__.d(__webpack_exports__, {
          /* harmony export */ userAccount: () => /* binding */ userAccount,
          /* harmony export */ userPhoneNumber: () =>
            /* binding */ userPhoneNumber,
          /* harmony export */
        });
        /* unused harmony export getUserName */
        const userAccount = {
          name: "user account",
        };

        const userPhoneNumber = {
          number: "***********",
        };

        const getUserName = () => "John Doe";

        /***/
      },

    /***/ "./src/userService1.js":
      /*!*****************************!*\
  !*** ./src/userService1.js ***!
  \*****************************/
      /***/ (
        __unused_webpack_module,
        __webpack_exports__,
        __webpack_require__
      ) => {
        "use strict";
        __webpack_require__.r(__webpack_exports__);
        /* harmony export */ __webpack_require__.d(__webpack_exports__, {
          /* harmony export */ logUserAccount: () =>
            /* binding */ logUserAccount,
          /* harmony export */
        });
        /* harmony import */ var user_library__WEBPACK_IMPORTED_MODULE_0__ =
          __webpack_require__(
            /*! user-library */ "./node_modules/user-library/dist/index.js"
          );

        const logUserAccount = () => {
          console.log(user_library__WEBPACK_IMPORTED_MODULE_0__.userAccount);
        };

        /***/
      },
  },
]);
```

è™½ç„¶ `getUserName` è¢«æ ‡è®°ä¸ºäº†æœªå¼•ç”¨ï¼Œä½† `userAccount` å¹¶æ²¡æœ‰è¢«æ ‡è®°ï¼Œå³ä½¿ `userService2` ä»…ä»…ä½¿ç”¨äº† `userPhoneNumber`ã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿï¼ˆè¯‘æ³¨ï¼šåŸæ–‡ä¸­ä¸Šé¢çš„ä»£ç æ˜¯ `userService1` çš„è€Œä¸æ˜¯ `userService2`ï¼‰

æˆ‘ä»¬éœ€è¦è®°ä½ï¼Œå¼•ç”¨å¯¼å‡ºï¼ˆused exportsï¼‰ä¼˜åŒ–åœ¨æ£€æŸ¥å¯¼å‡ºé¡¹æ˜¯å¦è¢«å¼•ç”¨çš„æ—¶å€™ï¼Œæ˜¯åœ¨æ¨¡å—å±‚é¢ä¸Šæ£€æŸ¥çš„ã€‚åªæœ‰ä»è¿™ä¸ªå±‚é¢ä¸Š Webpack æ‰èƒ½ç§»é™¤é‚£äº›æœªè¢«ä½¿ç”¨çš„ä»£ç ã€‚å¯¹äºæˆ‘ä»¬çš„åº“æ¨¡å—æ¥è¯´ï¼Œ`userAccount` å’Œ `userPhoneNumber` å…¶å®éƒ½è¢«ä½¿ç”¨äº†ã€‚åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼ŒWebpack å¹¶ä¸èƒ½åŒºåˆ†æ¸… `userService1` å’Œ `userService2` åœ¨å¯¼å…¥é¡¹ä¸Šçš„åŒºåˆ«ï¼Œæ­£å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆä½ ä¼šå‘ç° `userAccount` å’Œ `userPhoneNumber` éƒ½è¢«æ ‡æ³¨ä¸ºç»¿è‰²ï¼‰ï¼š

![ä»£ç åˆ†å‰²å¯¼è‡´æ‘‡æ ‘ä¼˜åŒ–å‡ºç°çš„é—®é¢˜](https://picbed.kimyang.cn/202111060242009.jpeg)

**è¿™æ„å‘³ç€ [Webpack](https://webpack.js.org/) åœ¨ä»…ä¾é å¼•ç”¨å¯¼å‡ºä¼˜åŒ–çš„æ¡ä»¶ä¸‹ï¼Œå¹¶ä¸èƒ½ç‹¬ç«‹åœ°é’ˆå¯¹æ¯ä¸ª chunk è¿›è¡Œæ‘‡æ ‘ä¼˜åŒ–ã€‚**

ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨æ‰“åŒ…åº“æ—¶ä¿ç•™æ¨¡å—ç»“æ„ï¼Œè¿™æ ·å‰¯ä½œç”¨ä¼˜åŒ–å°±èƒ½å·¥ä½œï¼š

[Webpack](https://webpack.js.org/) ä»ç„¶è¾“å‡ºäº† 3 ä¸ªæ–‡ä»¶ï¼Œä¸è¿‡è¿™ä¸€æ¬¡ `src_userService2_js.main.js` ä»…ä»…åŒ…å«äº† `userPhoneNumber` é‡Œçš„ä»£ç ï¼š

```js
(self["webpackChunkuser_app"] = self["webpackChunkuser_app"] || []).push([
  ["src_userService2_js"],
  {
    /***/ "./node_modules/user-library/dist/userPhoneNumber.js":
      /*!***********************************************************!*\
  !*** ./node_modules/user-library/dist/userPhoneNumber.js ***!
  \***********************************************************/
      /***/ (
        __unused_webpack_module,
        __webpack_exports__,
        __webpack_require__
      ) => {
        "use strict";
        /* harmony export */ __webpack_require__.d(__webpack_exports__, {
          /* harmony export */ userPhoneNumber: () =>
            /* binding */ userPhoneNumber,
          /* harmony export */
        });
        const userPhoneNumber = {
          number: "***********",
        };

        /***/
      },

    /***/ "./src/userService2.js":
      /*!*****************************!*\
  !*** ./src/userService2.js ***!
  \*****************************/
      /***/ (
        __unused_webpack_module,
        __webpack_exports__,
        __webpack_require__
      ) => {
        "use strict";
        __webpack_require__.r(__webpack_exports__);
        /* harmony export */ __webpack_require__.d(__webpack_exports__, {
          /* harmony export */ logUserPhoneNumber: () =>
            /* binding */ logUserPhoneNumber,
          /* harmony export */
        });
        /* harmony import */ var user_library__WEBPACK_IMPORTED_MODULE_0__ =
          __webpack_require__(
            /*! user-library */ "./node_modules/user-library/dist/userPhoneNumber.js"
          );

        const logUserPhoneNumber = () => {
          console.log(
            user_library__WEBPACK_IMPORTED_MODULE_0__.userPhoneNumber
          );
        };

        /***/
      },
  },
]);
```

`src_userService1_js.main.js` ä¹Ÿå’Œä¸Šé¢ç±»ä¼¼ï¼Œä»…ä»…åŒ…å«äº†æˆ‘ä»¬åº“é‡Œçš„ `userAccount` æ¨¡å—ã€‚

![ä¿ç•™æ¨¡å—æ ‘å¯ä»¥è®© Webpack ç‹¬ç«‹åœ°å¯¹åˆ†å‰²çš„ chunk è¿›è¡Œæ‘‡æ ‘ä¼˜åŒ–](https://picbed.kimyang.cn/202111060244091.jpeg)

åœ¨ä¸Šå›¾ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œ`userAccount` å’Œ `userPhoneNumber` ä»ç„¶è¢«è¯†åˆ«ä¸º**è¢«å¼•ç”¨çš„å¯¼å‡ºé¡¹**ï¼Œæ¯•ç«Ÿå®ƒä»¬éƒ½åœ¨åº”ç”¨é‡Œè¢«å¼•ç”¨äº†è‡³å°‘ä¸€æ¬¡ã€‚ä¸è¿‡ï¼Œè¿™ä¸€æ¬¡å‰¯ä½œç”¨ä¼˜åŒ–è®© Webpack å¾—ä»¥ç•¥è¿‡ `userAccount` æ¨¡å—ï¼Œå› ä¸ºå®ƒä»æœªè¢« `userService2` æ‰€å¯¼å…¥ã€‚åŒæ ·çš„äº‹æƒ…ä¹Ÿå‘ç”Ÿåœ¨äº† `userPhoneNumber` å’Œ `userService1` ä¹‹é—´ã€‚

æˆ‘ä»¬ç°åœ¨ç†è§£äº†ï¼šä¿ç•™åº“ä¸­åŸå§‹çš„æ¨¡å—ç»“æ„æ˜¯å¾ˆé‡è¦çš„ã€‚ä¸è¿‡ï¼Œå¦‚æœåŸå§‹æ¨¡å—ç»“æ„é‡Œåªæœ‰ä¸€ä¸ªæ¨¡å—ï¼Œæ¯”å¦‚ `index.js` æ–‡ä»¶ï¼Œå¹¶ä¸”å…¶ä¸­åŒ…å«ç€æ‰€æœ‰çš„ä»£ç çš„è¯ï¼Œé‚£ä¹ˆä¿ç•™è¿™ç§æ¨¡å—ç»“æ„æ˜¯æ¯«æ— ç”¨å¤„çš„ã€‚**è¦æ‰“é€ ä¸€ä¸ªå¯¹æ‘‡æ ‘ä¼˜åŒ–æœ‰ç€è‰¯å¥½é€‚é…çš„åº“ï¼Œæˆ‘ä»¬å¿…é¡»å°†åº“çš„ä»£ç åˆ’åˆ†åˆ°è‹¥å¹²ä¸ªå°çš„æ¨¡å—ä¸­ï¼ŒåŒæ—¶æ¯ä¸ªæ¨¡å—è´Ÿè´£æˆ‘ä»¬ä»£ç é€»è¾‘çš„ä¸€éƒ¨åˆ†ã€‚**

å¦‚æœè¦ä½¿ç”¨â€œæ ‘â€çš„æ¯”å–»ï¼Œæˆ‘ä»¬éœ€è¦å°†æ ‘ä¸Šæ¯ç‰‡å¶å­è§†ä¸ºä¸€ä¸ªæ¨¡å—ã€‚æ›´å°ã€æ›´å¼±çš„å¶å­åœ¨æ ‘è¢«æ‘‡åŠ¨çš„æ—¶å€™æ›´å®¹æ˜“æ‰è½ï¼å¦‚æœæ ‘ä¸Šçš„å¶å­æ›´å°‘ã€æ›´å¼ºï¼Œé‚£ä¹ˆæ‘‡æ ‘çš„ç»“æœå¯èƒ½å°±ä¸ä¸€æ ·äº†ã€‚

æœ¬éƒ¨åˆ†çš„æ€»ç»“å¦‚ä¸‹ï¼š

- ä¸ºäº†èƒ½å¤Ÿå……åˆ†åˆ©ç”¨å‰¯ä½œç”¨ä¼˜åŒ–ï¼Œ**æˆ‘ä»¬åº”è¯¥ä¿ç•™åº“çš„æ¨¡å—ç»“æ„**ã€‚
- **åº“åº”è¯¥è¢«åˆ’åˆ†ä¸ºå¤šä¸ªå°çš„æ¨¡å—**ï¼Œæ¯ä¸ªæ¨¡å—ä»…å¯¼å‡ºæ•´ä¸ªåº“çš„ä»£ç é€»è¾‘çš„ä¸€å°éƒ¨åˆ†ã€‚
- åªæœ‰åœ¨å‰¯ä½œç”¨ä¼˜åŒ–çš„å¸®åŠ©ä¸‹ï¼Œæˆ‘ä»¬åœ¨åº”ç”¨é‡Œæ‰èƒ½å¯¹å¼•ç”¨çš„åº“è¿›è¡Œæ‘‡æ ‘ä¼˜åŒ–ã€‚

## åœ¨è½¬è¯‘åº“ä»£ç æ—¶ä¸è¦ä¸¢å¤±æ¨¡å—æ ‘ä»¥åŠ ES æ¨¡å—çš„ç‰¹å¾

**æ‰“åŒ…å·¥å…·å¹¶ä¸æ˜¯å”¯ä¸€èƒ½å¤Ÿå½±å“ä½ çš„åº“è¢«æ‘‡æ ‘ä¼˜åŒ–çš„ä¸œè¥¿ã€‚**è½¬è¯‘å·¥å…·ä¹Ÿä¼šå¯¹æ‘‡æ ‘ä¼˜åŒ–é€ æˆè´Ÿé¢å½±å“ï¼Œå› ä¸ºå®ƒä»¬ä¼šç§»é™¤ ES æ¨¡å—ï¼Œæˆ–è€…ä¸¢å¤±æ¨¡å—æ ‘ã€‚

è½¬è¯‘å·¥å…·çš„ç›®çš„ä¹‹ä¸€æ˜¯è®©ä½ çš„ä»£ç èƒ½å¤Ÿåœ¨é‚£äº›ä¸æ”¯æŒ ES æ¨¡å—çš„æµè§ˆå™¨ä¸­å·¥ä½œã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦è®°ä½ï¼š**æˆ‘ä»¬çš„åº“å¹¶ä¸æ€»ä¼šç›´æ¥åœ°è¢«æµè§ˆå™¨æ‰€åŠ è½½**ï¼Œè€Œæ˜¯ä¼šè¢«åº”ç”¨æ‰€å¯¼å…¥ã€‚æ‰€ä»¥ï¼Œé‰´äºä»¥ä¸‹ä¸¤æ¡ç†ç”±ï¼Œæˆ‘ä»¬ä¸èƒ½é’ˆå¯¹ç‰¹å®šæµè§ˆå™¨æ¥è½¬è¯‘æˆ‘ä»¬çš„åº“ä»£ç ï¼š

- åœ¨ç¼–å†™åº“ä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“æˆ‘ä»¬çš„åº“ä¼šè¢«ç”¨åˆ°å“ªäº›æµè§ˆå™¨é‡Œï¼Œåªæœ‰ä½¿ç”¨åº“çš„åº”ç”¨æ‰çŸ¥é“ã€‚
- è½¬è¯‘æˆ‘ä»¬çš„åº“ä»£ç ä¼šè®©å®ƒä»¬å˜å¾—ä¸å¯è¢«æ‘‡æ ‘ä¼˜åŒ–ã€‚

å¦‚æœä½ çš„åº“ç”±äºæŸäº›åŸå› ç¡®å®éœ€è¦è¢«è½¬è¯‘ï¼Œé‚£ä¹ˆä½ éœ€è¦ä¿è¯è½¬è¯‘å·¥å…·ä¸ä¼šç§»é™¤ ES æ¨¡å—çš„è¯­æ³•ï¼Œä»¥åŠä¸ä¼šç§»é™¤åŸæœ¬çš„æ¨¡å—ç»“æ„ï¼ŒåŸå› æ­£å¦‚å‰æ–‡æ‰€è¿°ã€‚

æ®æˆ‘æ‰€çŸ¥ï¼Œæœ‰ä¸¤ä¸ªè½¬è¯‘å·¥å…·ä¼šç§»é™¤æ‰ä¸Šè¿°çš„ä¸¤ä¸ªå†…å®¹ã€‚

#### Babel

Babel èƒ½å¤Ÿä½¿ç”¨ [Babel preset-env](https://babeljs.io/docs/en/babel-preset-env) æ¥è®©ä½ çš„ä»£ç å…¼å®¹æŒ‡å®šçš„ç›®æ ‡æµè§ˆå™¨ï¼ˆtarget browsersï¼‰ã€‚è¿™ä¸ªæ’ä»¶é»˜è®¤ä¼šå°†åº“ä»£ç é‡Œçš„ ES æ¨¡å—ç§»é™¤ã€‚ä¸ºäº†é¿å…å®ƒçš„å‘ç”Ÿï¼Œæˆ‘ä»¬éœ€è¦æŠŠ [`modules` é€‰é¡¹](https://babeljs.io/docs/en/babel-preset-env#modules)è®¾ä¸º `false`ï¼š

```js
module.exports = {
  env: {
    esm: {
      presets: [
        [
          "@babel/preset-env",
          {
            modules: false,
          },
        ],
      ],
    },
  },
};
```

#### TypeScript

åœ¨ç¼–è¯‘ä½ çš„ä»£ç æ—¶ï¼ŒTypeScript ä¼šæ ¹æ® `tsconfig.json` æ–‡ä»¶é‡Œçš„ `target` å’Œ `module` é€‰é¡¹æ¥è½¬æ¢ä½ çš„æ¨¡å—ã€‚

ä¸ºäº†é¿å…å®ƒçš„å‘ç”Ÿï¼Œæˆ‘ä»¬è¦[å°† `target` å’Œ `module` é€‰é¡¹è®¾ç½®åˆ°è‡³å°‘ `ES2015` æˆ– `ES6`](https://www.typescriptlang.org/tsconfig#module)ã€‚

**æ­¤éƒ¨åˆ†çš„æ€»ç»“å¦‚ä¸‹ï¼š**

- **ç¡®ä¿ä½ çš„è½¬è¯‘å·¥å…·å’Œç¼–è¯‘å™¨ä¸ä¼šå°†åº“ä»£ç é‡Œçš„ ES æ¨¡å—è¯­æ³•ç§»é™¤ã€‚**
- å¦‚æœéœ€è¦æ£€æŸ¥ä¸Šè¿°é—®é¢˜æ˜¯å¦å­˜åœ¨ï¼Œå¯ä»¥æŸ¥çœ‹åº“çš„è½¬è¯‘/ç¼–è¯‘äº§ç‰©é‡Œæœ‰æ²¡æœ‰ ES æ¨¡å—çš„å¯¼å…¥è¯­æ³•ã€‚

## ä½¿ç”¨æœ€æ–°ç‰ˆçš„å¯è¿›è¡Œæ‘‡æ ‘ä¼˜åŒ–çš„æ‰“åŒ…å·¥å…·

JavaScript çš„æ‘‡æ ‘ä¼˜åŒ–åœ¨ [Rollup](https://rollupjs.org/guide/en/) çš„å¸¦åŠ¨ä¸‹æµè¡Œäº†èµ·æ¥ã€‚[Webpack è‡ªä» v2 ä»¥æ¥å°±æ”¯æŒäº†æ‘‡æ ‘ä¼˜åŒ–ã€‚](https://webpack.js.org/guides/tree-shaking/)å„æ‰“åŒ…å·¥å…·éƒ½åœ¨æ‘‡æ ‘ä¼˜åŒ–ä¸Šåšå¾—è¶Šæ¥è¶Šå¥½ã€‚

è¿˜è®°å¾—æˆ‘ä»¬åœ¨ä¸Šæ–‡è®²åˆ°çš„ `innerGraph` ä¼˜åŒ–å—ï¼Ÿå®ƒèƒ½å¤Ÿè®© Webpack å°†æ¨¡å—çš„å¯¼å‡ºé¡¹å’Œå…¶ä»–æ¨¡å—çš„å¯¼å…¥é¡¹å…³è”èµ·æ¥ã€‚è¿™é¡¹ä¼˜åŒ–æ˜¯åœ¨ Webpack 5 ä¸­è¢«å¼•å…¥çš„ã€‚æˆ‘ä»¬åœ¨æœ¬æ–‡é‡Œè™½ç„¶ä¸€ç›´åœ¨ä½¿ç”¨ Webpack 5ï¼Œä¸è¿‡è¿˜æ˜¯æœ‰å¿…è¦è®¤è¯†åˆ°è¿™é¡¹ä¼˜åŒ–æ”¹å˜äº†æ•´ä¸ªä¸šç•Œã€‚å®ƒèƒ½å¤Ÿè®© Webpack é€’å½’åœ°å¯»æ‰¾æœªè¢«ä½¿ç”¨çš„å¯¼å‡ºé¡¹ï¼

ä¸ºäº†å±•ç¤ºå®ƒåˆ°åº•æ˜¯æ€ä¹ˆåšçš„ï¼Œè€ƒè™‘ `user-library` ä¸­çš„ `index.js` æ–‡ä»¶ï¼š

```js
import { userAccount } from "./userAccount";

const getUserAccount = () => {
  return userAccount;
};

const getUserName = () => "John Doe";

export { getUserName, getUserAccount };
```

æˆ‘ä»¬çš„ `user-app` ä»…ä½¿ç”¨äº†å…¶ä¸­çš„ `getUserName`ï¼š

```js
import { getUserName } from "user-library";

console.log(getUserName());
```

ç°åœ¨ï¼Œæˆ‘ä»¬å¯¹æ¯”ä¸€ä¸‹åœ¨æœ‰å’Œæ²¡æœ‰ `innerGraph` ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œæ‰“åŒ…è¾“å‡ºæœ‰ä»€ä¹ˆä¸åŒã€‚æ³¨æ„ï¼Œè¿™é‡Œ `usedExports` å’Œ `sideEffects` ä¼˜åŒ–éƒ½æ˜¯å¼€å¯çš„ã€‚

æ²¡æœ‰ `innerGraph` ä¼˜åŒ–ï¼ˆæ¯”å¦‚ä½¿ç”¨ Webpack 4ï¼‰ï¼š

```js
/*!*************************************************!*\
  !*** ./node_modules/user-library/dist/index.js ***!
  \*************************************************/
/*! exports provided: userAccount, userPhoneNumber, getUserName, getUserAccount */
/*! exports used: getUserName */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return getUserName; });
/* unused harmony export getUserAccount */
/* harmony import */ var _userAccount_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./userAccount.js */ "./node_modules/user-library/dist/userAccount.js");

const getUserAccount = () => {
  return _userAccount_js__WEBPACK_IMPORTED_MODULE_0__[/* userAccount */ "a"]
};

const getUserName = () => 'John Doe';

/***/ }),

/***/ "./node_modules/user-library/dist/userAccount.js":
/*!*******************************************************!*\
  !*** ./node_modules/user-library/dist/userAccount.js ***!
  \*******************************************************/
/*! exports provided: userAccount */
/*! exports used: userAccount */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return userAccount; });
const userAccount = {
  name: 'user account'
};

/***/ }),
```

æœ‰ `innerGraph` ä¼˜åŒ–ï¼ˆæ¯”å¦‚ä½¿ç”¨ Webpack 5ï¼‰ï¼š

```js
/***/ "./node_modules/user-library/dist/index.js":
/*!*************************************************!*\
  !*** ./node_modules/user-library/dist/index.js ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "getUserName": () => (/* binding */ getUserName)
/* harmony export */ });
/* unused harmony export getUserAccount */

const getUserAccount = () => {
  return userAccount
};

const getUserName = () => 'John Doe';

/***/ })
```

![Webpackçš„ innerGraph ä¼˜åŒ–ç¤ºä¾‹](https://raw.githubusercontent.com/darkyzhou/blog/master/static/images/uploads/tree-shaking-8.svg)

Webpack 5 èƒ½å¤Ÿå®Œå…¨ç§»é™¤ `userAccount` æ¨¡å—ï¼Œä½†æ˜¯ Webpack 4 ä¸è¡Œï¼Œå³ä½¿ `getUserAccount` è¢«æ ‡è®°ä¸ºäº†æœªå¼•ç”¨ã€‚è¿™æ˜¯å› ä¸º `inngerGraph` ä¼˜åŒ–çš„ç®—æ³•èƒ½å¤Ÿè®© Webpack 5 å°†æ¨¡å—ä¸­æœªå¼•ç”¨çš„å¯¼å‡ºé¡¹å’Œå®ƒå¯¹åº”çš„å¯¼å…¥é¡¹é“¾æ¥èµ·æ¥ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­é‡Œï¼Œ`userAccount` æ¨¡å—ä»…è¢« `getUserAccount` å‡½æ•°æ‰€ä½¿ç”¨ï¼Œå› æ­¤å¯ä»¥è¢«ç›´æ¥ç•¥è¿‡ã€‚

Webpack 4 åˆ™æ²¡æœ‰è¿™é¡¹ä¼˜åŒ–ã€‚**å¼€å‘è€…åœ¨ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬çš„ Webpack çš„æ—¶å€™å› æ­¤åº”è¯¥æé«˜è­¦æƒ•ï¼Œé™åˆ¶å•ä¸ªæºæ–‡ä»¶é‡Œçš„å¯¼å‡ºé¡¹æ•°é‡ã€‚** å¦‚æœä¸€ä¸ªæºæ–‡ä»¶åŒ…å«å¤šä¸ªå¯¼å‡ºé¡¹ï¼ŒWebpack ä¼šåŒ…å«æ‰€æœ‰å¯¹åº”çš„å¯¼å…¥é¡¹ï¼Œå³ä½¿å¯¹äºçœŸæ­£è¢«éœ€è¦çš„å¯¼å‡ºé¡¹æ¥è¯´æœ‰äº›å¯¼å…¥é¡¹æ˜¯å¤šä½™çš„ã€‚

æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬åº”è¯¥ç¡®ä¿æ€»æ˜¯ä½¿ç”¨æœ€æ–°ç‰ˆçš„æ‰“åŒ…å·¥å…·ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½ä»æœ€æ–°çš„æ‘‡æ ‘ä¼˜åŒ–ä¸­è·ç›Šã€‚

## æ€»ç»“

å¯¹ä¸€ä¸ªåº“è¿›è¡Œçš„æ‘‡æ ‘ä¼˜åŒ–ï¼Œå¹¶ä¸æ˜¯åœ¨é…ç½®æ–‡ä»¶é‡Œéšä¾¿åŠ ä¸€è¡Œæ¥å¯ç”¨å°±èƒ½è·å¾—å¾ˆå¥½çš„æ•ˆæœã€‚å®ƒçš„ä¼˜åŒ–è´¨é‡å–å†³äºå¤šä¸ªå› ç´ ï¼Œæœ¬æ–‡ä»…ä»…åˆ—å‡ºäº†å…¶ä¸­çš„ä¸€å°éƒ¨åˆ†ã€‚ä¸è¿‡ï¼Œæ— è®ºæˆ‘ä»¬é‡åˆ°çš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Œæœ¬æ–‡é‡Œåšè¿‡çš„ä»¥ä¸‹ä¸¤ä»¶äº‹æƒ…æ˜¯å¯¹ä»»ä½•æƒ³è¦å¯¹åº“è¿›è¡Œæ‘‡æ ‘ä¼˜åŒ–çš„äººå¾ˆé‡è¦çš„ï¼š

- **ä¸ºäº†ç¡®å®šæˆ‘ä»¬åº“çš„æ‘‡æ ‘ä¼˜åŒ–æ•ˆæœç¨‹åº¦ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ªå—æ§çš„ç¯å¢ƒä¸‹ä½¿ç”¨æˆ‘ä»¬äº†è§£çš„æ‰“åŒ…å·¥å…·æ¥è¿›è¡Œæµ‹è¯•ã€‚**
- **ä¸ºäº†æ£€æŸ¥æˆ‘ä»¬åº“çš„é…ç½®æœ‰æ²¡æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬ä¸ä»…ä»…æ˜¯éœ€è¦æ£€æŸ¥å„ç§é…ç½®æ–‡ä»¶ï¼Œè¿˜è¦æ£€æŸ¥æ‰“åŒ…è¾“å‡ºã€‚** æˆ‘ä»¬åœ¨æœ¬æ–‡é‡Œä¸€ç›´éƒ½åœ¨å¯¹ `user-library` å’Œ `user-app` çš„ä¾‹å­åšè¿™ç§äº‹æƒ…ã€‚

æˆ‘çœŸåˆ‡åœ°å¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿä¸ºä½ æä¾›å¸®åŠ©ï¼Œè®©ä½ æ­£åœ¨è¿›è¡Œçš„æ„å»ºæ‹¥ä¼˜åŒ–ç¨‹åº¦æœ€é«˜çš„åº“çš„ä»»åŠ¡å˜å¾—å¯èƒ½ï¼

### å»¶ç”³é˜…è¯»

- [Tree-shaking versus dead code elimination](https://medium.com/@Rich_Harris/tree-shaking-versus-dead-code-elimination-d3765df85c80)
- [Webpack 5 release](https://webpack.js.org/blog/2020-10-10-webpack-5-release/)
- [Tree shaking in JavaScript](https://ageek.dev/tree-shaking)

---

- åŸæ–‡åœ°å€ï¼š[How To Make Tree Shakeable Libraries](https://blog.theodo.com/2021/04/library-tree-shaking/)
- åŸæ–‡ä½œè€…ï¼š[FranÃ§ois Hendriks](https://blog.theodo.com/fran%C3%A7ois-hendriks)
- è¯‘æ–‡å‡ºè‡ªï¼š[æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)
- æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼š[https://github.com/xitu/gold-miner/blob/master/article/2021/library-tree-shaking.md](https://github.com/xitu/gold-miner/blob/master/article/2021/library-tree-shaking.md)
- è¯‘è€…ï¼š[darkyzhou](https://github.com/darkyzhou)
- æ ¡å¯¹è€…ï¼š[Usualminds](https://github.com/Usualminds)ã€[Kim Yang](https://github.com/KimYangOfCat)
