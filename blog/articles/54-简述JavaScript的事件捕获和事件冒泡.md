---
title: "ç®€è¿° JavaScript çš„äº‹ä»¶æ•è·å’Œäº‹ä»¶å†’æ³¡"
date: 2021-09-8
tags: [JavaScript]
categories: [ğŸŒ ç¿»è¯‘æ ¡å¯¹]
publish: true
---

![](https://picbed.kimyang.cn/202109122345737.jpeg)<!-- more -->

JavaScript äº‹ä»¶å†’æ³¡æ˜¯ä¸ºäº†æ•æ‰å’Œå¤„ç† DOM å†…éƒ¨ä¼ æ’­çš„äº‹ä»¶ã€‚ä½†æ˜¯ä½ çŸ¥é“äº‹ä»¶å†’æ³¡å’Œäº‹ä»¶æ•è·ä¹‹é—´çš„åŒºåˆ«å—ï¼Ÿ

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†ç”¨ç›¸å…³çš„ç¤ºä¾‹æ¥è®¨è®ºå…³äºè¿™ä¸ªä¸»é¢˜ä½ æ‰€éœ€è¦äº†è§£çš„å…¨éƒ¨æƒ…å†µã€‚

## äº‹ä»¶æµçš„ä¼ æ’­

åœ¨ä»‹ç»äº‹ä»¶æ•è·å’Œäº‹ä»¶å†’æ³¡ä¹‹å‰ï¼Œå…ˆæ¥çœ‹ä¸‹ä¸€ä¸ªäº‹ä»¶æ˜¯å¦‚ä½•åœ¨ DOM å†…éƒ¨ä¼ æ’­çš„ã€‚

å¦‚æœæˆ‘ä»¬æœ‰å‡ ä¸ªåµŒå¥—çš„å…ƒç´ å¤„ç†åŒä¸€ä¸ªäº‹ä»¶ï¼Œæˆ‘ä»¬ä¼šå¯¹å“ªä¸ªäº‹ä»¶å¤„ç†ç¨‹åºä¼šå…ˆè§¦å‘çš„é—®é¢˜æ„Ÿåˆ°å›°æƒ‘ã€‚è¿™æ—¶ï¼Œç†è§£äº‹ä»¶ä¼ æ’­é¡ºåºå°±å˜å¾—å¾ˆæœ‰å¿…è¦ã€‚

> é€šå¸¸ï¼Œä¸€ä¸ªäº‹ä»¶ä¼šä»çˆ¶å…ƒç´ å¼€å§‹å‘ç›®æ ‡å…ƒç´ ä¼ æ’­ï¼Œç„¶åå®ƒå°†è¢«ä¼ æ’­å›çˆ¶å…ƒç´ ã€‚

JavaScript äº‹ä»¶åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š

- **æ•è·é˜¶æ®µ**ï¼šäº‹ä»¶ä»çˆ¶å…ƒç´ å¼€å§‹å‘ç›®æ ‡å…ƒç´ ä¼ æ’­ï¼Œä» `Window` å¯¹è±¡å¼€å§‹ä¼ æ’­ã€‚
- **ç›®æ ‡é˜¶æ®µ**ï¼šè¯¥äº‹ä»¶åˆ°è¾¾ç›®æ ‡å…ƒç´ æˆ–å¼€å§‹è¯¥äº‹ä»¶çš„å…ƒç´ ã€‚
- **å†’æ³¡é˜¶æ®µ**ï¼šè¿™æ—¶ä¸æ•è·é˜¶æ®µç›¸åï¼Œäº‹ä»¶å‘çˆ¶å…ƒç´ ä¼ æ’­ï¼Œç›´åˆ° `Window` å¯¹è±¡ã€‚

ä¸‹å›¾å°†è®©ä½ è¿›ä¸€æ­¥äº†è§£äº‹ä»¶ä¼ æ’­çš„ç”Ÿå‘½å‘¨æœŸï¼š

![DOM äº‹ä»¶æµ](https://picbed.kimyang.cn/202109122345912.jpeg)

ç°åœ¨ä½ å¤§æ¦‚äº†è§£äº† DOM å†…éƒ¨çš„äº‹ä»¶æµç¨‹ï¼Œè®©æˆ‘ä»¬å†æ¥çœ‹ä¸‹äº‹ä»¶æ•è·å’Œå†’æ³¡æ˜¯å¦‚ä½•å‡ºç°çš„ã€‚

## ä»€ä¹ˆæ˜¯äº‹ä»¶æ•è·

> äº‹ä»¶æ•è·æ˜¯äº‹ä»¶ä¼ æ’­çš„åˆå§‹åœºæ™¯ï¼Œä»åŒ…è£…å…ƒç´ å¼€å§‹ï¼Œä¸€ç›´åˆ°å¯åŠ¨äº‹ä»¶ç”Ÿå‘½å‘¨æœŸçš„ç›®æ ‡å…ƒç´ ã€‚

å¦‚æœä½ æœ‰ä¸€ä¸ªä¸æµè§ˆå™¨çš„ `Window` å¯¹è±¡ç»‘å®šçš„äº‹ä»¶ï¼Œå®ƒå°†æ˜¯ç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œçš„ã€‚æ‰€ä»¥ï¼Œåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œäº‹ä»¶å¤„ç†çš„é¡ºåºå°†æ˜¯ `Window`ã€`Document`ã€`DIV 2`ã€`DIV 1`ï¼Œæœ€åæ˜¯ `button`ã€‚

![äº‹ä»¶æ•è·ç¤ºä¾‹](https://picbed.kimyang.cn/202109122345281.gif)

è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œäº‹ä»¶æ•è·åªå‘ç”Ÿåœ¨è¢«ç‚¹å‡»çš„å…ƒç´ æˆ–ç›®æ ‡ä¸Šï¼Œè¯¥äº‹ä»¶ä¸ä¼šä¼ æ’­åˆ°å­å…ƒç´ ã€‚

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `addEventListener()` æ–¹æ³•çš„ `useCapture` å‚æ•°æ¥æ³¨å†Œæ•æ‰é˜¶æ®µçš„äº‹ä»¶ã€‚

```js
target.addEventListener(type, listener, useCapture);
```

ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç æ¥æµ‹è¯•ä¸Šè¿°ç¤ºä¾‹ï¼Œå¹¶è·å¾—äº‹ä»¶æ•è·çš„å®è·µç»éªŒã€‚

```JavaScript
window.addEventListener("click", () => {
    console.log('Window');
  },true);

document.addEventListener("click", () => {
    console.log('Document');
  },true);

document.querySelector(".div2").addEventListener("click", () => {
    console.log('DIV 2');
  },true);

document.querySelector(".div1").addEventListener("click", () => {
    console.log('DIV 1');
  },true);

document.querySelector("button").addEventListener("click", () => {
    console.log('CLICK ME!');
  },true);
```

## ä»€ä¹ˆæ˜¯äº‹ä»¶å†’æ³¡

å¦‚æœä½ çŸ¥é“äº‹ä»¶æ•è·ï¼Œäº‹ä»¶å†’æ³¡å°±å¾ˆå®¹æ˜“ç†è§£ï¼Œå®ƒä¸äº‹ä»¶æ•è·æ˜¯å®Œå…¨ç›¸åçš„ã€‚

> äº‹ä»¶å†’æ³¡å°†ä»ä¸€ä¸ªå­å…ƒç´ å¼€å§‹ï¼Œåœ¨ DOM æ ‘ä¸Šä¼ æ’­ï¼Œç›´åˆ°æœ€ä¸Šé¢çš„çˆ¶å…ƒç´ äº‹ä»¶è¢«å¤„ç†ã€‚

åœ¨ `addEventListener()` ä¸­çœç•¥æˆ–å°† `useCapture` å‚æ•°è®¾ç½®ä¸º `false`ï¼Œå°†æ³¨å†Œå†’æ³¡é˜¶æ®µçš„äº‹ä»¶ã€‚æ‰€ä»¥ï¼Œäº‹ä»¶ç›‘å¬å™¨é»˜è®¤ç›‘å¬å†’æ³¡äº‹ä»¶ã€‚

![äº‹ä»¶å†’æ³¡ç¤ºä¾‹](https://picbed.kimyang.cn/202109122345365.gif)

åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯¹æ‰€æœ‰çš„äº‹ä»¶ä½¿ç”¨äº†äº‹ä»¶æ•è·æˆ–äº‹ä»¶å†’æ³¡ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³åœ¨ä¸¤ä¸ªé˜¶æ®µå†…éƒ½å¤„ç†äº‹ä»¶å‘¢ï¼Ÿ

è®©æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨å†’æ³¡é˜¶æ®µå¤„ç† `Document` å’Œ `DIV 2` çš„ç‚¹å‡»äº‹ä»¶ï¼Œå…¶ä»–äº‹ä»¶åˆ™åœ¨æ•è·é˜¶æ®µå¤„ç†ã€‚

![æ³¨å†Œä¸¤ä¸ªé˜¶æ®µçš„äº‹ä»¶](https://picbed.kimyang.cn/202109122345112.gif)

è¿æ¥åˆ° `Window`ã€`DIV 1` å’Œ `button` çš„ç‚¹å‡»äº‹ä»¶å°†åœ¨æ•è·è¿‡ç¨‹ä¸­åˆ†åˆ«è§¦å‘ï¼Œè€Œ `DIV 2` å’Œ `Document` ç›‘å¬å™¨åˆ™åœ¨å†’æ³¡é˜¶æ®µä¾æ¬¡è§¦å‘ã€‚

```JavaScript
window.addEventListener("click", () => {
    console.log('Window');
  },true);

document.addEventListener("click", () => {
    console.log('Document');
  }); // å·²æ³¨å†Œä¸ºå†’æ³¡

document.querySelector(".div2").addEventListener("click", () => {
    console.log('DIV 2');
  }); // å·²æ³¨å†Œä¸ºå†’æ³¡

document.querySelector(".div1").addEventListener("click", () => {
    console.log('DIV 1');
  },true);

document.querySelector("button").addEventListener("click", () => {
    console.log('CLICK ME!');
  },true);
```

æˆ‘æƒ³ç°åœ¨ä½ å·²ç»å¯¹äº‹ä»¶æµã€äº‹ä»¶å†’æ³¡å’Œäº‹ä»¶æ•è·æœ‰äº†å¾ˆå¥½çš„ç†è§£ã€‚é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸‹ä»€ä¹ˆæ—¶å€™å¯ä»¥ä½¿ç”¨äº‹ä»¶å†’æ³¡å’Œäº‹ä»¶æ•è·ã€‚

## äº‹ä»¶æ•è·å’Œå†’æ³¡çš„åº”ç”¨

é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å…¨å±€èŒƒå›´å†…æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œå°±å¯ä»¥ä½¿ç”¨äº‹ä»¶ä¼ æ’­ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æ³¨å†Œæ–‡æ¡£èŒƒå›´å†…çš„ç›‘å¬å™¨ï¼Œå¦‚æœ `DOM` å†…æœ‰äº‹ä»¶å‘ç”Ÿï¼Œå®ƒå°±ä¼šè¿è¡Œã€‚

> åŒæ ·åœ°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨äº‹ä»¶æ•è·å’Œå†’æ³¡æ¥æ”¹å˜ç”¨æˆ·ç•Œé¢ã€‚

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå…è®¸ç”¨æˆ·é€‰æ‹©å•å…ƒæ ¼çš„è¡¨æ ¼ï¼Œæˆ‘ä»¬éœ€è¦å‘ç”¨æˆ·æ˜¾ç¤ºæ‰€é€‰å•å…ƒæ ¼ã€‚

![æ¼”ç¤º](https://picbed.kimyang.cn/202109122345682.gif)

> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºæ¯ä¸ªå•å…ƒæ ¼åˆ†é…äº‹ä»¶å¤„ç†ç¨‹åºå°†ä¸æ˜¯ä¸€ä¸ªå¥½çš„åšæ³•ã€‚å®ƒæœ€ç»ˆä¼šå¯¼è‡´ä»£ç çš„é‡å¤ã€‚

ä½œä¸ºä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„äº‹ä»¶ç›‘å¬å™¨ï¼Œå¹¶åˆ©ç”¨äº‹ä»¶å†’æ³¡å’Œæ•è·æ¥å¤„ç†è¿™äº›äº‹ä»¶ã€‚

å› æ­¤ï¼Œæˆ‘ä¸º `table` åˆ›å»ºäº†ä¸€ä¸ªå•ç‹¬çš„äº‹ä»¶ç›‘å¬å™¨ï¼Œå®ƒå°†è¢«ç”¨æ¥æ”¹å˜å•å…ƒæ ¼çš„æ ·å¼ã€‚

```js
document.querySelector("table").addEventListener("click", (event) => {
  if (event.target.nodeName == "TD")
    event.target.style.background = "rgb(230, 226, 40)";
});
```

åœ¨äº‹ä»¶ç›‘å¬å™¨ä¸­ï¼Œæˆ‘ä½¿ç”¨ `nodeName` æ¥åŒ¹é…è¢«ç‚¹å‡»çš„å•å…ƒæ ¼ï¼Œå¦‚æœåŒ¹é…ï¼Œå•å…ƒæ ¼çš„é¢œè‰²å°±ä¼šæ”¹å˜ã€‚

## å¦‚ä½•é˜²æ­¢äº‹ä»¶ä¼ æ’­

> æœ‰æ—¶ï¼Œå¦‚æœäº‹ä»¶å†’æ³¡å’Œæ•æ‰å¼€å§‹ä¸å—æˆ‘ä»¬æ§åˆ¶åœ°ä¼ æ’­æ—¶ï¼Œå°±ä¼šè®©äººæ„Ÿåˆ°åŒçƒ¦ã€‚

å¦‚æœä½ æœ‰ä¸€ä¸ªä¸¥é‡åµŒå¥—çš„å…ƒç´ ç»“æ„ï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œå› ä¸ºæ¯ä¸ªäº‹ä»¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶å‘¨æœŸã€‚

![å½“å†’æ³¡å˜å¾—çƒ¦äººæ—¶](https://picbed.kimyang.cn/202109122345687.gif)

åœ¨ä¸Šè¿°æƒ…å†µä¸‹ï¼Œå½“æˆ‘ç‚¹å‡»åˆ é™¤æŒ‰é’®æ—¶ï¼ŒåŒ…è£…å…ƒç´ çš„ç‚¹å‡»äº‹ä»¶ä¹Ÿè¢«è§¦å‘äº†ã€‚è¿™æ˜¯ç”±äºäº‹ä»¶å†’æ³¡å¯¼è‡´çš„ã€‚

> æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `stopPropagation()` æ–¹æ³•æ¥é¿å…è¿™ç§è¡Œä¸ºï¼Œå®ƒå°†é˜»æ­¢äº‹ä»¶æ²¿ç€ DOM æ ‘å‘ä¸Šæˆ–å‘ä¸‹è¿›ä¸€æ­¥ä¼ æ’­ã€‚

```js
document.querySelector(".card").addEventListener("click", () => {
  $("#detailsModal").modal();
});

document.querySelector("button").addEventListener("click", (event) => {
  event.stopPropagation(); // åœæ­¢å†’æ³¡
  $("#deleteModal").modal();
});
```

![ä½¿ç”¨ `stopPropagation()` å](https://picbed.kimyang.cn/202109122345202.gif)

## æœ¬æ–‡æ€»ç»“

JavaScript äº‹ä»¶æ•è·å’Œå†’æ³¡å¯ä»¥ç”¨æ¥æœ‰æ•ˆåœ°å¤„ç† Web åº”ç”¨ç¨‹åºä¸­çš„äº‹ä»¶ã€‚äº†è§£äº‹ä»¶æµä»¥åŠæ•è·å’Œå†’æ³¡æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œå°†æœ‰åŠ©äºä½ é€šè¿‡æ­£ç¡®çš„äº‹ä»¶å¤„ç†æ¥ä¼˜åŒ–ä½ çš„åº”ç”¨ç¨‹åºã€‚

ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„åº”ç”¨ç¨‹åºä¸­æœ‰ä»»ä½•æ„å¤–çš„äº‹ä»¶å¯åŠ¨ï¼Œäº†è§£äº‹ä»¶æ•è·å’Œå†’æ³¡å¯ä»¥èŠ‚çœä½ æ’æŸ¥é—®é¢˜çš„æ—¶é—´ã€‚

å› æ­¤ï¼Œæˆ‘å¸Œæœ›ä½ å°è¯•ä¸Šè¿°ç¤ºä¾‹å¹¶åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„ç»éªŒã€‚

æ„Ÿè°¢é˜…è¯»ï¼

---

- åŸæ–‡åœ°å€ï¼š[Event Bubbling and Capturing in JavaScript](https://blog.bitsrc.io/event-bubbling-and-capturing-in-javascript-6bc908321b22)
- åŸæ–‡ä½œè€…ï¼š[Dulanka Karunasena](https://medium.com/@dulanka)
- è¯‘æ–‡å‡ºè‡ªï¼š[æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)
- æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼š[https://github.com/xitu/gold-miner/blob/master/article/2021/event-bubbling-and-capturing-in-javascript.md](https://github.com/xitu/gold-miner/blob/master/article/2021/event-bubbling-and-capturing-in-javascript.md)
- è¯‘è€…ï¼š[Z æ‹›é”¦](https://github.com/zenblofe)
- æ ¡å¯¹è€…ï¼š[KimYangOfCat](https://github.com/KimYangOfCat)ã€[jaredliw](https://github.com/jaredliw)
