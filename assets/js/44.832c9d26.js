(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{640:function(t,s,n){"use strict";n.r(s);var a=n(6),r=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("p",[n("img",{attrs:{src:"https://picbed.kimyang.cn/202109050832970.jpeg",alt:""}})]),t._v(" "),n("h2",{attrs:{id:"简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),n("p",[t._v("每一个软件程序都有其最基础的构建模块。在面向对象的编程语言中， 我们使用类去构建复杂的体系架构。像建一幢大楼，我们把模块之间建立的联系称之为"),n("strong",[t._v("依赖")]),t._v("。其他的类为了支持我们类的需求，提供复杂的封装操作。")]),t._v(" "),n("p",[t._v("一个类可能有引用其他类的字段。因此，我们不得不问及这些问题：这些引用是怎么被创建的？是"),n("strong",[t._v("我们")]),t._v("去组合这些对象，还是"),n("strong",[t._v("其他类")]),t._v("负责实例化它们？如果要实例化的类"),n("strong",[t._v("太复杂")]),t._v("，并且我们想避免出现垃圾代码？所有这些问题都可以试图通过"),n("strong",[t._v("依赖注入原则")]),t._v("来解决。")]),t._v(" "),n("p",[t._v("在开始示例之前，我们必须要去理解关于依赖注入的一些相关概念。依赖注入原则告诉我们，一个类应该去"),n("strong",[t._v("接收")]),t._v("而非实例化它的依赖。通过委托方式来进行对象初始化，这可以处理较为复杂的操作，从而减少在类设计上的压力。你可以移除代码中复杂的模块，并通过其他方式重新引入依赖。如何处理"),n("strong",[t._v("移除")]),t._v("和"),n("strong",[t._v("重新引入依赖")]),t._v("，这是依赖管理的问题。你可以手动处理所有对象的初始化和注入，但是这将会使整个系统变得复杂，我们要尽量避免这种情况的发生。相反，你可以将构造的职责转移到 "),n("strong",[t._v("IoC 容器")]),t._v("。")]),t._v(" "),n("p",[n("strong",[t._v("控制反转")]),t._v("是通过反转整个程序的流程，以便容器对所有程序中涉及的依赖进行管理。你可以创建一个容器，整个容器负责构造对象。当一个类需要实例化对象时，IoC 容器可以提供它所需要的依赖。")]),t._v(" "),n("p",[t._v("IoC "),n("strong",[t._v("只")]),t._v("提供了一种方法而非具体的实现。为了使用依赖注入原则，你需要一个"),n("strong",[t._v("依赖注入框架")]),t._v("。举例如下：")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("Spring")]),t._v(" 和 "),n("strong",[t._v("Dagger")]),t._v("是 "),n("strong",[t._v("Java")]),t._v(" 的依赖注入框架")]),t._v(" "),n("li",[n("strong",[t._v("Hilt")]),t._v(" 是 "),n("strong",[t._v("Kotlin")]),t._v(" 的依赖注入框架")]),t._v(" "),n("li",[n("strong",[t._v("Unity")]),t._v(" 是 "),n("strong",[t._v("C#")]),t._v(" 的依赖注入框架")]),t._v(" "),n("li",[n("strong",[t._v("Inversify")]),t._v("、"),n("strong",[t._v("Nest.js")]),t._v(" 和 "),n("strong",[t._v("TypeDI")]),t._v(" 是 "),n("strong",[t._v("TypeScript")]),t._v(" 的依赖注入框架")])]),t._v(" "),n("h2",{attrs:{id:"概览和角色划分"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#概览和角色划分"}},[t._v("#")]),t._v(" 概览和角色划分")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://picbed.kimyang.cn/202109050833517.png",alt:"依赖注入概览"}})]),t._v(" "),n("p",[t._v("在依赖注入原则中，我们需要理解"),n("strong",[t._v("四")]),t._v("种不同的"),n("strong",[t._v("角色")]),t._v(":")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("客户端")])]),t._v(" "),n("li",[n("strong",[t._v("服务端")])]),t._v(" "),n("li",[n("strong",[t._v("接口")])]),t._v(" "),n("li",[n("strong",[t._v("注入器")])])]),t._v(" "),n("p",[n("strong",[t._v("服务端")]),t._v("是我们对外暴露服务使用的。这些类由 IoC 容器实例化和使用。一个"),n("strong",[t._v("客户端")]),t._v("通过 IoC 容器来使用这些服务。客户端不应该被具体细节所困扰，因此"),n("strong",[t._v("接口")]),t._v("需要确保客户端和服务端保持协调。客户端请求所需的依赖，"),n("strong",[t._v("注入器")]),t._v("提供实例化服务。")]),t._v(" "),n("h2",{attrs:{id:"依赖注入的类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#依赖注入的类型"}},[t._v("#")]),t._v(" 依赖注入的类型")]),t._v(" "),n("p",[t._v("当我们讨论如何在类中注入依赖时，可以通过"),n("strong",[t._v("三种不同方式")]),t._v("来实现：")]),t._v(" "),n("ul",[n("li",[t._v("我们可以通过"),n("strong",[t._v("属性")]),t._v("(字段)提供依赖关系。在类上定义属性，然后将具体的对象注入到该属性中，这就是属性注入。通过对外暴露这个属性，但这样做"),n("strong",[t._v("违背")]),t._v("了面向对象程序设计的"),n("strong",[t._v("封装")]),t._v("原则；因此，要尽量避免这种注入。")]),t._v(" "),n("li",[t._v("我们可以通过"),n("strong",[t._v("方法")]),t._v("提供依赖关系。对象的"),n("strong",[t._v("状态应该是私有的")]),t._v("，当外部想要改变该状态时，它应该调用类的 "),n("strong",[t._v("getter/setter 方法")]),t._v("。所以当你使用 setter 方法初始化类中的私有字段时，你可以使用"),n("strong",[t._v("方法注入")]),t._v("。")]),t._v(" "),n("li",[t._v("我们可以通过"),n("strong",[t._v("构造函数")]),t._v("提供依赖关系。构造函数方法因为其基本属性和对象构造高度融合在一起。我们通常"),n("strong",[t._v("支持通过构造函数")]),t._v("进行注入，因为我们的目标和构造函数的方法很类似。")])]),t._v(" "),n("h2",{attrs:{id:"使用-typedi-库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-typedi-库"}},[t._v("#")]),t._v(" 使用 TypeDI 库")]),t._v(" "),n("p",[t._v("一旦我们理解了依赖注入的基本原理，使用什么框架或者库差别并不大。这篇文章里，我选择了 TypeScript 语言和 TypeDI 库来展示这些基本概念。")]),t._v(" "),n("p",[t._v("初始化 Yarn 和添加 TypeScript 会花点时间。我不想使用有名气但没有足够注释的项目配置，因为这会让你感到无趣。所以我将给出初步的代码并做简要介绍。你可以从"),n("a",{attrs:{href:"https://github.com/mertturkmenoglu/typescript-dependency-injection",target:"_blank",rel:"noopener noreferrer"}},[t._v("这个 Github 仓库"),n("OutboundLink")],1),t._v("查看和下载代码。")]),t._v(" "),n("p",[t._v("任何 TypeScript 项目都可以作为依赖注入演示的例子。但这篇文章里我选择了一个 Node/Express 应用作为示例。我假设使用 TypeScript 的开发者要么直接使用 Node/Express 服务器，要么对它们有所了解。")]),t._v(" "),n("p",[t._v("当你查看 "),n("code",[t._v("package.json")]),t._v(" 文件时，你可以看到这些依赖项配置，让我简要介绍下它们：")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("express")]),t._v("：Express 是编写 Node.js RESTful 服务的流行框架。")]),t._v(" "),n("li",[n("strong",[t._v("reflect-metadata")]),t._v("：一个用于元数据反射 API 的库。它允许其他库通过装饰器使用元数据。")]),t._v(" "),n("li",[n("strong",[t._v("ts-node")]),t._v("：Node.js 无法运行 TypeScript 文件。在代码运行前，需要将 TypeScript 编译为 JavaScript。ts-node 帮你处理了这个过程。")]),t._v(" "),n("li",[n("strong",[t._v("typedi")]),t._v("：TypeDI 是一个 TypeScript 依赖注入库。我们很快会看到它的示例。")]),t._v(" "),n("li",[n("strong",[t._v("typescript")]),t._v("：我们在这个项目中使用了 TypeScript，因此需要将它也作为一个依赖。")]),t._v(" "),n("li",[n("strong",[t._v("@types/express")]),t._v("：Express 库的类型定义。")]),t._v(" "),n("li",[n("strong",[t._v("@types/node")]),t._v("：Node.js 的类型定义。")]),t._v(" "),n("li",[n("strong",[t._v("ts-node-dev")]),t._v("：这个库允许你运行 TypeScript，并观察某些文件的变化情况。")])]),t._v(" "),n("p",[t._v("你需要留意一些重要的编译器选项配置。如果你看下 "),n("strong",[t._v("tsconfig.json")]),t._v("，你可以看到编译过程的配置选项：")]),t._v(" "),n("ul",[n("li",[t._v("我们为 "),n("strong",[t._v("reflect-metadata")]),t._v(" 和 "),n("strong",[t._v("node")]),t._v(" 指定了类型。")]),t._v(" "),n("li",[t._v("我们必须将 "),n("strong",[t._v("mitDecoratorMetadata")]),t._v(" 和 "),n("strong",[t._v("experimentalDecorators")]),t._v(" 设置为 true。")])]),t._v(" "),n("p",[t._v("所有的源码都在 "),n("strong",[t._v("src")]),t._v(" 文件夹下。"),n("strong",[t._v("src/index.ts")]),t._v(" 是我们项目的入口文件。这个文件包含了服务器的所有引导步骤：")]),t._v(" "),n("div",{staticClass:"language-TypeScript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'reflect-metadata'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" express "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'express'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Container "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'typedi'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" UserController "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./controllers/UserController'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("main")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("express")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" userController "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Container"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UserController"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/users'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" userController"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAllUsers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("console")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Server started'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("catch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("console")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("这段代码是一个只有一个端口的小型 Express 服务器。当你向 "),n("strong",[t._v("/users")]),t._v(" 路由发送一个 "),n("strong",[t._v("GET")]),t._v(" 请求时，它会返回一个用户列表。"),n("strong",[t._v("main")]),t._v(" 函数的核心是 "),n("strong",[t._v("Container.get")]),t._v(" 方法。注意我们并没有使用 new 关键字或者实例化对象。我们只是调用 IoC 容器返回的一个 UserController 实例方法。然后绑定了路由和控制器方法。")]),t._v(" "),n("p",[t._v("我们的应用程序是一个虚拟的 RESTful 服务器，但我不想让它没有一点意义。我添加了四个不同的文件夹代表一个完备后端服务的基本部分。它们是 "),n("strong",[t._v("controllers")]),t._v("、"),n("strong",[t._v("models")]),t._v("、"),n("strong",[t._v("repositories")]),t._v(" 和 "),n("strong",[t._v("services")]),t._v("。现在让我一个个介绍下它们：")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("Controllers")]),t._v(" 文件夹包含我们的 "),n("strong",[t._v("REST 控制器")]),t._v("。它们负责协调客户端和服务器之间的通信。它们接收请求并返回响应。")]),t._v(" "),n("li",[n("strong",[t._v("Models")]),t._v(" 文件夹包含我们的"),n("strong",[t._v("数据库实体类")]),t._v("。我们没有数据库连接，也不需要，但建立一个合适的项目结构对于学习该项目有很大的帮助。我们假设它是真是的数据库实体并继续我们的项目。")]),t._v(" "),n("li",[n("strong",[t._v("Services")]),t._v(" 文件夹包含我们的"),n("strong",[t._v("服务")]),t._v("。它们通过访问不同的存储库，负责为 REST 控制器提供所需服务。")]),t._v(" "),n("li",[n("strong",[t._v("Repositories")]),t._v(" 文件夹包含我们"),n("strong",[t._v("数据库连接类")]),t._v("。我们使用 Data Mapper 模式来执行数据库操作。该模式中我们使用实体类来访问数据库并进行相关操作。")])]),t._v(" "),n("p",[t._v("我们不会把所有的东西都放到一个类中。请求和响应之间还有很多层级。这就是所谓的"),n("strong",[t._v("分层架构")]),t._v("。通过类之间的依赖共享，我们可以更容易地进行依赖注入。")]),t._v(" "),n("div",{staticClass:"language-TypeScript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Response "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"express"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Service "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"typedi"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" UserService "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"../services/UserService"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token decorator"}},[n("span",{pre:!0,attrs:{class:"token at operator"}},[t._v("@")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Service")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserController")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("readonly")]),t._v(" userService"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" UserService"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAllUsers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_req"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" result "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("userService"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAllUsers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("json")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" UserController"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("UserController 只有一个方法。"),n("code",[t._v("getAllUsers")]),t._v(" 方法负责从用户服务中获取结果并进行传输。我们给 UserController 添加类一个 "),n("strong",[t._v("Service")]),t._v(" 装饰器，因为我们希望这个类由 IoC 容器进行管理。在构造函数方法内部，我们可以看到这个类需要一个 UserService 实例。同样，我们不需要控制这个依赖关系。因为 TypeDI 容器为 UserService 创建了一个实例，当它生成 UserController 实例时，它将注入到 UserService 中。")]),t._v(" "),n("div",{staticClass:"language-TypeScript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Service "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"typedi"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" User "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"../models/User"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" UserRepository "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"../repositories/UserRepository"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token decorator"}},[n("span",{pre:!0,attrs:{class:"token at operator"}},[t._v("@")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Service")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserService")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("readonly")]),t._v(" userRepository"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" UserRepository"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAllUsers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Promise")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("User"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" result "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("userRepository"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAllUsers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" UserService"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("UserService 和 UserController 很类似。我们向类添加一个 Service 装饰器，并在构造函数方法中指定它们想要的依赖项。")]),t._v(" "),n("div",{staticClass:"language-TypeScript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Service "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"typedi"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" User "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"../models/User"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token decorator"}},[n("span",{pre:!0,attrs:{class:"token at operator"}},[t._v("@")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Service")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserRepository")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("readonly")]),t._v(" users"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" User"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Emily'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'John'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Jane'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAllUsers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Promise")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("User"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("users"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" UserRepository"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("UserRepository 是我们的最后一步。我们用 Service 来注解这个类，但是我们没有任何依赖关系。因为没有数据库连接，所以我只是将已硬编码过的用户列表作为私有属性添加到类中。")]),t._v(" "),n("h2",{attrs:{id:"结论"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#结论"}},[t._v("#")]),t._v(" 结论")]),t._v(" "),n("p",[t._v("依赖注入是管理复杂对象初始化的有力工具。手动进行依赖注入总比什么都不做要好，但是使用 TypeDI 更简单可行。当你要开始做一个新项目时，你应该明确地考虑下依赖注入原则并给予适当尝试。")]),t._v(" "),n("p",[t._v("你可以在"),n("a",{attrs:{href:"https://github.com/mertturkmenoglu/typescript-dependency-injection",target:"_blank",rel:"noopener noreferrer"}},[t._v("这个 GitHub 分支"),n("OutboundLink")],1),t._v("找到本文的代码。")]),t._v(" "),n("p",[t._v("你可以在 "),n("a",{attrs:{href:"https://github.com/mertturkmenoglu",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub"),n("OutboundLink")],1),t._v("、"),n("a",{attrs:{href:"https://www.linkedin.com/in/mert-turkmenoglu/",target:"_blank",rel:"noopener noreferrer"}},[t._v("LinkedIn"),n("OutboundLink")],1),t._v(" 和 "),n("a",{attrs:{href:"https://twitter.com/capreaee",target:"_blank",rel:"noopener noreferrer"}},[t._v("Twitter"),n("OutboundLink")],1),t._v(" 找到我。")]),t._v(" "),n("p",[t._v("感谢阅读，祝你快乐。")]),t._v(" "),n("h2",{attrs:{id:"引用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#引用"}},[t._v("#")]),t._v(" 引用")]),t._v(" "),n("ul",[n("li",[t._v("[1] "),n("a",{attrs:{href:"https://www.tutorialsteacher.com/ioc/dependency-injection",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.tutorialsteacher.com/ioc/dependency-injection"),n("OutboundLink")],1)]),t._v(" "),n("li",[t._v("[2] "),n("a",{attrs:{href:"https://en.wikipedia.org/wiki/Dependency_injection",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://en.wikipedia.org/wiki/Dependency_injection"),n("OutboundLink")],1)]),t._v(" "),n("li",[t._v("[3] "),n("a",{attrs:{href:"https://developer.android.com/training/dependency-injection",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://developer.android.com/training/dependency-injection"),n("OutboundLink")],1)]),t._v(" "),n("li",[t._v("[4] "),n("a",{attrs:{href:"https://stackoverflow.com/questions/21288/which-net-dependency-injection-frameworks-are-worth-looking-into",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://stackoverflow.com/questions/21288/which-net-dependency-injection-frameworks-are-worth-looking-into"),n("OutboundLink")],1)]),t._v(" "),n("li",[t._v("[5] "),n("a",{attrs:{href:"https://docs.typestack.community/typedi/v/develop/01-getting-started",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://docs.typestack.community/typedi/v/develop/01-getting-started"),n("OutboundLink")],1)])]),t._v(" "),n("hr"),t._v(" "),n("ul",[n("li",[t._v("原文地址："),n("a",{attrs:{href:"https://levelup.gitconnected.com/dependency-injection-in-typescript-2f66912d143c",target:"_blank",rel:"noopener noreferrer"}},[t._v("Dependency Injection in TypeScript"),n("OutboundLink")],1)]),t._v(" "),n("li",[t._v("原文作者："),n("a",{attrs:{href:"https://medium.com/@mertturkmenoglu",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mert Türkmenoğlu"),n("OutboundLink")],1)]),t._v(" "),n("li",[t._v("译文出自："),n("a",{attrs:{href:"https://github.com/xitu/gold-miner",target:"_blank",rel:"noopener noreferrer"}},[t._v("掘金翻译计划"),n("OutboundLink")],1)]),t._v(" "),n("li",[t._v("本文永久链接："),n("a",{attrs:{href:"https://github.com/xitu/gold-miner/blob/master/article/2021/dependency-injection-in-typescript.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/xitu/gold-miner/blob/master/article/2021/dependency-injection-in-typescript.md"),n("OutboundLink")],1)]),t._v(" "),n("li",[t._v("译者："),n("a",{attrs:{href:"https://github.com/Usualminds",target:"_blank",rel:"noopener noreferrer"}},[t._v("Usualminds"),n("OutboundLink")],1)]),t._v(" "),n("li",[t._v("校对者："),n("a",{attrs:{href:"https://github.com/KimYangOfCat",target:"_blank",rel:"noopener noreferrer"}},[t._v("Kim Yang"),n("OutboundLink")],1),t._v("、"),n("a",{attrs:{href:"https://github.com/PassionPenguin",target:"_blank",rel:"noopener noreferrer"}},[t._v("PassionPenguin"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=r.exports}}]);